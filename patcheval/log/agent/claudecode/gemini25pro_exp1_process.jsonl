{"cve":"CVE-2021-21384:0708", "fix_patch": ""}
{"cve":"CVE-2018-20834:0708", "fix_patch": ""}
{"cve":"CVE-2021-33420:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex b180286..f3c4897 100644\n--- a/index.js\n+++ b/index.js\n@@ -428,7 +428,12 @@ var builtInTransforms = [\n         },\n \n         fromSerializable: function (val) {\n-            return typeof GLOBAL[val.ctorName] === 'function' ? new GLOBAL[val.ctorName](val.arr) : val.arr;\n+            if (TYPED_ARRAY_CTORS.indexOf(val.ctorName) < 0)\n+                return val.arr;\n+\n+            var ctor = GLOBAL[val.ctorName];\n+\n+            return typeof ctor === 'function' ? new ctor(val.arr) : val.arr;\n         }\n     },\n \ndiff --git a/package.json b/package.json\nindex af42007..dee40d4 100644\n--- a/package.json\n+++ b/package.json\n@@ -1,6 +1,6 @@\n {\n   \"name\": \"replicator\",\n-  \"version\": \"1.0.3\",\n+  \"version\": \"1.0.4\",\n   \"description\": \"Advanced JavaScript objects serialization.\",\n   \"main\": \"index.js\",\n   \"scripts\": {\n"}
{"cve":"CVE-2020-7764:0708", "fix_patch": ""}
{"cve":"CVE-2017-1001004:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/typed-function.js b/typed-function.js\nindex 9b84eea..f2a2635 100644\n--- a/typed-function.js\n+++ b/typed-function.js\n@@ -1077,6 +1077,11 @@\n      * @private\n      */\n     function _typed(name, signatures) {\n+      // validate the function name\n+      if (name && !/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(name)) {\n+        throw new Error('Invalid function name \"' + name + '\"');\n+      }\n+\n       var refs = new Refs();\n \n       // parse signatures, expand them\n"}
{"cve":"CVE-2017-1000189:0708", "fix_patch": ""}
{"cve":"CVE-2017-1001003:0708", "fix_patch": ""}
{"cve":"CVE-2016-1000232:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/cookie.js b/lib/cookie.js\nindex 12da297..d3321da 100644\n--- a/lib/cookie.js\n+++ b/lib/cookie.js\n@@ -362,11 +362,11 @@ function parse(str, options) {\n   // S5.2.3 \"unparsed-attributes consist of the remainder of the set-cookie-string\n   // (including the %x3B (\";\") in question).\" plus later on in the same section\n   // \"discard the first \";\" and trim\".\n-  var unparsed = str.slice(firstSemi).replace(/^\\s*;\\s*/,'').trim();\n+  var unparsed = str.slice(firstSemi+1);\n \n   // \"If the unparsed-attributes string is empty, skip the rest of these\n   // steps.\"\n-  if (unparsed.length === 0) {\n+  if (unparsed.trim().length === 0) {\n     return c;\n   }\n \n@@ -378,9 +378,9 @@ function parse(str, options) {\n    * cookie-attribute-list\".  Therefore, in this implementation, we overwrite\n    * the previous value.\n    */\n-  var cookie_avs = unparsed.split(/\\s*;\\s*/);\n+  var cookie_avs = unparsed.split(';');\n   while (cookie_avs.length) {\n-    var av = cookie_avs.shift();\n+    var av = cookie_avs.shift().trim();\n     var av_sep = av.indexOf('=');\n     var av_key, av_value;\n \n@@ -392,7 +392,7 @@ function parse(str, options) {\n       av_value = av.substr(av_sep+1);\n     }\n \n-    av_key = av_key.trim().toLowerCase();\n+    av_key = av_key.toLowerCase();\n \n     if (av_value) {\n       av_value = av_value.trim();\n"}
{"cve":"CVE-2021-21321:0708", "fix_patch": ""}
{"cve":"CVE-2020-17479:0708", "fix_patch": ""}
{"cve":"CVE-2019-10792:0708", "fix_patch": ""}
{"cve":"CVE-2019-10795:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/undefsafe.js b/lib/undefsafe.js\nindex 60663b0..7330cae 100644\n--- a/lib/undefsafe.js\n+++ b/lib/undefsafe.js\n@@ -67,6 +67,10 @@ function undefsafe(obj, path, value, __res) {\n   var i = 0;\n   for (; i < parts.length; i++) {\n     key = parts[i];\n+    if (key === '__proto__' || key === 'constructor' || key === 'prototype') {\n+      obj = undefined;\n+      break;\n+    }\n     parent = obj;\n \n     if (key === '*') {\n"}
{"cve":"CVE-2021-32796:0708", "fix_patch": ""}
{"cve":"CVE-2020-26226:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/hide-sensitive.js b/lib/hide-sensitive.js\nindex 6098496..952d855 100644\n--- a/lib/hide-sensitive.js\n+++ b/lib/hide-sensitive.js\n@@ -11,7 +11,10 @@ module.exports = (env) => {\n     return /token|password|credential|secret|private/i.test(envVar) && size(env[envVar].trim()) >= SECRET_MIN_SIZE;\n   });\n \n-  const regexp = new RegExp(toReplace.map((envVar) => escapeRegExp(env[envVar])).join('|'), 'g');\n+  const regexp = new RegExp(\n+    toReplace.flatMap((envVar) => [escapeRegExp(env[envVar]), escapeRegExp(encodeURI(env[envVar]))]).join('|'),\n+    'g'\n+  );\n   return (output) =>\n     output && isString(output) && toReplace.length > 0 ? output.toString().replace(regexp, SECRET_REPLACEMENT) : output;\n };\n"}
{"cve":"CVE-2020-26237:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/highlight.js b/src/highlight.js\nindex 4f98f38e..7c236a19 100644\n--- a/src/highlight.js\n+++ b/src/highlight.js\n@@ -29,9 +29,9 @@ const HLJS = function(hljs) {\n \n   // Global internal variables used within the highlight.js library.\n   /** @type {Record<string, Language>} */\n-  var languages = {};\n+  var languages = Object.create(null);\n   /** @type {Record<string, string>} */\n-  var aliases = {};\n+  var aliases = Object.create(null);\n   /** @type {HLJSPlugin[]} */\n   var plugins = [];\n \n@@ -470,7 +470,7 @@ const HLJS = function(hljs) {\n     /** @type {CompiledMode} */\n     var top = continuation || md;\n     /** @type Record<string,Mode> */\n-    var continuations = {}; // keep continuations for sub-languages\n+    var continuations = Object.create(null); // keep continuations for sub-languages\n     var emitter = new options.__emitter(options);\n     processContinuations();\n     var mode_buffer = '';\n"}
{"cve":"CVE-2023-41039:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/RestrictedPython/Guards.py b/src/RestrictedPython/Guards.py\nindex 9b70ae3..93af77f 100644\n--- a/src/RestrictedPython/Guards.py\n+++ b/src/RestrictedPython/Guards.py\n@@ -246,9 +246,11 @@ def safer_getattr(object, name, default=None, getattr=getattr):\n     http://lucumr.pocoo.org/2016/12/29/careful-with-str-format/\n \n     \"\"\"\n-    if isinstance(object, str) and name == 'format':\n+    if isinstance(object, str) and name in ('format', 'format_map'):\n         raise NotImplementedError(\n-            'Using format() on a %s is not safe.' % object.__class__.__name__)\n+            'Using {0}() on a {1} is not safe.'.format(\n+                name,\n+                object.__class__.__name__))\n     if name.startswith('_'):\n         raise AttributeError(\n             '\"{name}\" is an invalid attribute name because it '\ndiff --git a/src/RestrictedPython/Utilities.py b/src/RestrictedPython/Utilities.py\nindex 4bc6677..f82704d 100644\n--- a/src/RestrictedPython/Utilities.py\n+++ b/src/RestrictedPython/Utilities.py\n@@ -18,7 +18,35 @@ import string\n \n utility_builtins = {}\n \n-utility_builtins['string'] = string\n+# A safe version of the 'string' module.\n+# Excludes 'Formatter' and 'Template'.\n+# We can't use 'types.SimpleNamespace' because it's not available in Python 2.\n+class _SafeString(object):\n+    pass\n+\n+\n+_safe_string_module = _SafeString()\n+for name in (\n+        'ascii_letters',\n+        'ascii_lowercase',\n+        'ascii_uppercase',\n+        'capwords',\n+        'digits',\n+        'hexdigits',\n+        'octdigits',\n+        'printable',\n+        'punctuation',\n+        'whitespace',\n+        # Deprecated string constants.\n+        'letters',\n+        'lowercase',\n+        'uppercase',\n+):\n+    if hasattr(string, name):\n+        setattr(_safe_string_module, name, getattr(string, name))\n+\n+\n+utility_builtins['string'] = _safe_string_module\n utility_builtins['math'] = math\n utility_builtins['random'] = random\n utility_builtins['whrandom'] = random\n"}
{"cve":"CVE-2023-34457:0708", "fix_patch": ""}
{"cve":"CVE-2018-7753:0708", "fix_patch": ""}
{"cve":"CVE-2015-1326:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/dbusmock/mockobject.py b/dbusmock/mockobject.py\nindex 29f790e..41d0f36 100644\n--- a/dbusmock/mockobject.py\n+++ b/dbusmock/mockobject.py\n@@ -39,7 +39,10 @@ if sys.version_info[0] >= 3:\n \n \n def load_module(name):\n-    if os.path.exists(name) and os.path.splitext(name)[1] == '.py':\n+    # only support loading of .py files, not .pyc\n+    if (os.path.exists(name) and\n+            os.path.splitext(name)[1] == '.py' and\n+            not os.path.exists(os.path.splitext(name)[0] + '.pyc')):\n         sys.path.insert(0, os.path.dirname(os.path.abspath(name)))\n         try:\n             m = os.path.splitext(os.path.basename(name))[0]\n"}
{"cve":"CVE-2025-43859:0708", "fix_patch": ""}
{"cve":"CVE-2024-49750:0708", "fix_patch": ""}
{"cve":"CVE-2023-45809:0708", "fix_patch": ""}
{"cve":"CVE-2022-29217:0708", "fix_patch": ""}
{"cve":"CVE-2019-16789:0708", "fix_patch": ""}
{"cve":"CVE-2025-48374:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/api/config/config.go b/pkg/api/config/config.go\nindex 39f86639..7d05e0a0 100644\n--- a/pkg/api/config/config.go\n+++ b/pkg/api/config/config.go\n@@ -331,6 +331,16 @@ func (c *Config) Sanitize() *Config {\n \t\tpanic(err)\n \t}\n \n+\tif c.HTTP.Auth != nil && c.HTTP.Auth.OpenID != nil {\n+\t\t// a map of providers by value, so no need to deep copy again\n+\t\tfor providerName, providerConfig := range sanitizedConfig.HTTP.Auth.OpenID.Providers {\n+\t\t\tif providerConfig.ClientSecret != \"\" {\n+\t\t\t\tproviderConfig.ClientSecret = \"******\"\n+\t\t\t\tsanitizedConfig.HTTP.Auth.OpenID.Providers[providerName] = providerConfig\n+\t\t\t}\n+\t\t}\n+\t}\n+\n \tif c.HTTP.Auth != nil && c.HTTP.Auth.LDAP != nil && c.HTTP.Auth.LDAP.bindPassword != \"\" {\n \t\tsanitizedConfig.HTTP.Auth.LDAP = &LDAPConfig{}\n \n"}
{"cve":"CVE-2025-24882:0708", "fix_patch": ""}
{"cve":"CVE-2025-24806:0708", "fix_patch": ""}
{"cve":"CVE-2024-56362:0708", "fix_patch": ""}
{"cve":"CVE-2024-52309:0708", "fix_patch": ""}
{"cve":"CVE-2024-22199:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/django.go b/django/django.go\nindex 030fbe2..c6e92a8 100644\n--- a/django/django.go\n+++ b/django/django.go\n@@ -101,7 +101,7 @@ func (e *Engine) Load() error {\n \tpongoset := pongo2.NewSet(\"default\", pongoloader)\n \t// Set template settings\n \tpongoset.Globals.Update(e.Funcmap)\n-\tpongo2.SetAutoescape(false)\n+\tpongo2.SetAutoescape(true)\n \n \t// Loop trough each Directory and register template files\n \twalkFn := func(path string, info os.FileInfo, err error) error {\n"}
{"cve":"CVE-2023-52081:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/catalog.go b/catalog.go\nindex 1fb4814..7b4df30 100644\n--- a/catalog.go\n+++ b/catalog.go\n@@ -42,7 +42,7 @@ func (store Catalog) Lookup(query string) (Theme, error) {\n // to search for something.\n // For example, it is used by (ThemeStore).Lookup\n func lookupPreprocess(s string) string {\n-\treturn strings.ToLower(norm.NFKD.String(regexp.MustCompile(`[-_ .]`).ReplaceAllString(s, \"\")))\n+\treturn strings.ToLower(regexp.MustCompile(`[-_ .]`).ReplaceAllString(norm.NFKD.String(s), \"\"))\n }\n \n // LoadCatalog loads a directory of theme manifests.\n"}
{"cve":"CVE-2023-45128:0708", "fix_patch": ""}
{"cve":"CVE-2023-40029:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/util/db/cluster.go b/util/db/cluster.go\nindex 9b405a9cac..e154713c92 100644\n--- a/util/db/cluster.go\n+++ b/util/db/cluster.go\n@@ -404,6 +404,7 @@ func SecretToCluster(s *apiv1.Secret) (*appv1.Cluster, error) {\n \tif s.Annotations != nil {\n \t\tannotations = collections.CopyStringMap(s.Annotations)\n \t\tdelete(annotations, common.AnnotationKeyManagedBy)\n+\t\tdelete(annotations, apiv1.LastAppliedConfigAnnotation)\n \t}\n \n \tcluster := appv1.Cluster{\n"}
{"cve":"CVE-2023-25168:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/server/filesystem/filesystem.go b/server/filesystem/filesystem.go\nindex 1d906f0..52ff360 100644\n--- a/server/filesystem/filesystem.go\n+++ b/server/filesystem/filesystem.go\n@@ -386,48 +386,62 @@ func (fs *Filesystem) TruncateRootDirectory() error {\n \n // Delete removes a file or folder from the system. Prevents the user from\n // accidentally (or maliciously) removing their root server data directory.\n+// Delete removes a file or folder from the system. Prevents the user from\n+// accidentally (or maliciously) removing their root server data directory.\n+//\n+// This is one of the few (only?) places in the codebase where we're explicitly\n+// not using the SafePath functionality when working with user provided input. If\n+// we did, you would not be able to delete a file that is a symlink pointing to\n+// a location outside of the data directory.\n+//\n+// We also want to avoid resolving a symlink that points _within_ the data\n+// directory and thus deleting the actual source file for the symlink rather\n+// than the symlink itself. For these purposes just resolve the actual file path\n+// using filepath.Join() and confirm that the path exists within the data\n+// directory.\n func (fs *Filesystem) Delete(p string) error {\n-\twg := sync.WaitGroup{}\n-\t// This is one of the few (only?) places in the codebase where we're explicitly not using\n-\t// the SafePath functionality when working with user provided input. If we did, you would\n-\t// not be able to delete a file that is a symlink pointing to a location outside of the data\n-\t// directory.\n-\t//\n-\t// We also want to avoid resolving a symlink that points _within_ the data directory and thus\n-\t// deleting the actual source file for the symlink rather than the symlink itself. For these\n-\t// purposes just resolve the actual file path using filepath.Join() and confirm that the path\n-\t// exists within the data directory.\n-\tresolved := fs.unsafeFilePath(p)\n-\tif !fs.unsafeIsInDataDirectory(resolved) {\n-\t\treturn NewBadPathResolution(p, resolved)\n-\t}\n-\n-\t// Block any whoopsies.\n-\tif resolved == fs.Path() {\n+\tcleaned, err := fs.SafePath(p)\n+\tif err != nil {\n+\t\t// If the error is that the file does not exist, we can just treat this as a success.\n+\t\t// Otherwise, we don't know what the hell is going on, so we should probably return\n+\t\t// that error.\n+\t\tif errors.Is(err, os.ErrNotExist) {\n+\t\t\treturn nil\n+\t\t}\n+\t\treturn err\n+\t}\n+\n+\t// Block any whoopsies. This should be checked in SafePath, but we'll be thorough.\n+\tif cleaned == fs.Path() {\n \t\treturn errors.New(\"cannot delete root server directory\")\n \t}\n \n-\tif st, err := os.Lstat(resolved); err != nil {\n-\t\tif !os.IsNotExist(err) {\n-\t\t\tfs.error(err).Warn(\"error while attempting to stat file before deletion\")\n+\tst, err := os.Lstat(cleaned)\n+\tif err != nil {\n+\t\t// If the error is that the file does not exist, we can just treat this as a success.\n+\t\t// Otherwise, we don't know what the hell is going on, so we should probably return\n+\t\t// that error.\n+\t\tif errors.Is(err, os.ErrNotExist) {\n+\t\t\treturn nil\n \t\t}\n+\t\treturn err\n+\t}\n+\n+\t// If the file is not a directory, we can just decrement the disk size by the\n+\t// size of the file.\n+\tif !st.IsDir() {\n+\t\tfs.addDisk(-st.Size())\n \t} else {\n-\t\tif !st.IsDir() {\n-\t\t\tfs.addDisk(-st.Size())\n-\t\t} else {\n-\t\t\twg.Add(1)\n-\t\t\tgo func(wg *sync.WaitGroup, st os.FileInfo, resolved string) {\n-\t\t\t\tdefer wg.Done()\n-\t\t\t\tif s, err := fs.DirectorySize(resolved); err == nil {\n-\t\t\t\t\tfs.addDisk(-s)\n-\t\t\t\t}\n-\t\t\t}(&wg, st, resolved)\n+\t\t// If it is a directory, we need to walk the directory and get the size of\n+\t\t// all the files in it.\n+\t\ts, err := fs.DirectorySize(cleaned)\n+\t\tif err != nil {\n+\t\t\treturn err\n \t\t}\n+\t\tfs.addDisk(-s)\n \t}\n \n-\twg.Wait()\n-\n-\treturn os.RemoveAll(resolved)\n+\treturn os.RemoveAll(cleaned)\n }\n \n type fileOpener struct {\n"}
{"cve":"CVE-2021-3583:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/ansible/template/__init__.py b/lib/ansible/template/__init__.py\nindex 52b9f71977..28841408e1 100644\n--- a/lib/ansible/template/__init__.py\n+++ b/lib/ansible/template/__init__.py\n@@ -833,9 +833,21 @@ class Templar:\n                 line = data[len(JINJA2_OVERRIDE):eol]\n                 data = data[eol + 1:]\n                 for pair in line.split(','):\n-                    (key, val) = pair.split(':')\n+                    (key, val) = pair.split(':', 1)\n                     key = key.strip()\n-                    setattr(myenv, key, ast.literal_eval(val.strip()))\n+                    # Do not use ast.literal_eval, as it can be unsafe with untrusted data.\n+                    # To be safe, we now limit ourselves to a few specific values.\n+                    value = val.strip()\n+                    if value.lower() in ('true', 'false'):\n+                        value = value.lower() == 'true'\n+                    elif value.isdigit():\n+                        value = int(value)\n+                    elif '.' in value and all(p.isdigit() for p in value.split('.', 1)):\n+                        value = float(value)\n+                    elif len(value) > 1 and value[0] in ('\"', \"'\") and value[0] == value[-1]:\n+                        # The string is quoted, so we unquote it\n+                        value = value[1:-1]\n+                    setattr(myenv, key, value)\n \n             # Adds Ansible custom filters and tests\n             myenv.filters.update(self._get_filters())\n"}
{"cve":"CVE-2023-30172:0708", "fix_patch": ""}
{"cve":"CVE-2020-10691:0708", "fix_patch": ""}
{"cve":"CVE-2024-42005:0708", "fix_patch": ""}
{"cve":"CVE-2022-28346:0708", "fix_patch": ""}
{"cve":"CVE-2021-31542:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/core/files/storage.py b/django/core/files/storage.py\nindex 1562614e50..05ec3ef60b 100644\n--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -66,6 +66,10 @@ class Storage:\n         available for new content to be written to.\n         \"\"\"\n         dir_name, file_name = os.path.split(name)\n+        if '..' in dir_name or '..' in file_name:\n+            raise SuspiciousFileOperation(\n+                'Detected path traversal attempt in \"%s\"' % name\n+            )\n         file_root, file_ext = os.path.splitext(file_name)\n         # If the filename already exists, add an underscore and a random 7\n         # character alphanumeric string (before the file extension, if one\n@@ -96,9 +100,7 @@ class Storage:\n         Validate the filename by calling get_valid_name() and return a filename\n         to be passed to the save() method.\n         \"\"\"\n-        # `filename` may include a path as returned by FileField.upload_to.\n-        dirname, filename = os.path.split(filename)\n-        return os.path.normpath(os.path.join(dirname, self.get_valid_name(filename)))\n+        return self.get_valid_name(filename)\n \n     def path(self, name):\n         \"\"\"\n"}
{"cve":"CVE-2024-10220:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/volume/git_repo/git_repo.go b/pkg/volume/git_repo/git_repo.go\nindex 995018d9007..c92f245ab83 100644\n--- a/pkg/volume/git_repo/git_repo.go\n+++ b/pkg/volume/git_repo/git_repo.go\n@@ -261,6 +261,9 @@ func validateVolume(src *v1.GitRepoVolumeSource) error {\n \tif err := validateNonFlagArgument(src.Directory, \"directory\"); err != nil {\n \t\treturn err\n \t}\n+\tif strings.Contains(src.Directory, \"..\") {\n+\t\treturn fmt.Errorf(\"directory %q is invalid, must not contain '..'\", src.Directory)\n+\t}\n \treturn nil\n }\n \n"}
{"cve":"CVE-2024-45043:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/receiver/awsfirehosereceiver/receiver.go b/receiver/awsfirehosereceiver/receiver.go\nindex 6211f61221..a862c89602 100644\n--- a/receiver/awsfirehosereceiver/receiver.go\n+++ b/receiver/awsfirehosereceiver/receiver.go\n@@ -233,7 +233,10 @@ func (fmr *firehoseReceiver) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n // validate checks the Firehose access key in the header against\n // the one passed into the Config\n func (fmr *firehoseReceiver) validate(r *http.Request) (int, error) {\n-\tif accessKey := r.Header.Get(headerFirehoseAccessKey); accessKey != \"\" && accessKey != string(fmr.config.AccessKey) {\n+\tif string(fmr.config.AccessKey) == \"\" {\n+\t\treturn http.StatusAccepted, nil\n+\t}\n+\tif accessKey := r.Header.Get(headerFirehoseAccessKey); accessKey != string(fmr.config.AccessKey) {\n \t\treturn http.StatusUnauthorized, errInvalidAccessKey\n \t}\n \treturn http.StatusAccepted, nil\n"}
{"cve":"CVE-2021-21432:0708", "fix_patch": ""}
{"cve":"CVE-2022-1992:0708", "fix_patch": ""}
{"cve":"CVE-2020-26294:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/template/native/render.go b/template/native/render.go\nindex 4683db6..fbdb33a 100644\n--- a/template/native/render.go\n+++ b/template/native/render.go\n@@ -25,7 +25,7 @@ func Render(tmpl string, s *types.Step) (types.StepSlice, error) {\n \t// parse the template with Masterminds/sprig functions\n \t//\n \t// https://pkg.go.dev/github.com/Masterminds/sprig?tab=doc#TxtFuncMap\n-\tt, err := template.New(s.Name).Funcs(sprig.TxtFuncMap()).Funcs(templateFuncMap).Parse(tmpl)\n+\tt, err := template.New(s.Name).Funcs(sprig.HermeticTxtFuncMap()).Funcs(templateFuncMap).Parse(tmpl)\n \tif err != nil {\n \t\treturn types.StepSlice{}, fmt.Errorf(\"unable to parse template %s: %v\", s.Template.Name, err)\n \t}\n"}
{"cve":"CVE-2022-1986:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/db/repo_editor.go b/internal/db/repo_editor.go\nindex 9d4664be..312a68bf 100644\n--- a/internal/db/repo_editor.go\n+++ b/internal/db/repo_editor.go\n@@ -466,11 +466,14 @@ type UploadRepoFileOptions struct {\n // isRepositoryGitPath returns true if given path is or resides inside \".git\"\n // path of the repository.\n func isRepositoryGitPath(path string) bool {\n-\treturn strings.HasSuffix(path, \".git\") ||\n-\t\tstrings.Contains(path, \".git\"+string(os.PathSeparator)) ||\n-\t\t// Windows treats \".git.\" the same as \".git\"\n-\t\tstrings.HasSuffix(path, \".git.\") ||\n-\t\tstrings.Contains(path, \".git.\"+string(os.PathSeparator))\n+\tpath = strings.ToLower(path)\n+\tpath = strings.ReplaceAll(path, \"\\\", \"/\")\n+\tfor _, part := range strings.Split(path, \"/\") {\n+\t\tif part == \".git\" || part == \".git.\" {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\treturn false\n }\n \n func (repo *Repository) UploadRepoFiles(doer *User, opts UploadRepoFileOptions) error {\n"}
{"cve":"CVE-2022-29188:0708", "fix_patch": ""}
{"cve":"CVE-2023-50726:0708", "fix_patch": ""}
{"cve":"CVE-2022-3920:0708", "fix_patch": ""}
{"cve":"CVE-2024-5138:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/overlord/hookstate/ctlcmd/ctlcmd.go b/overlord/hookstate/ctlcmd/ctlcmd.go\nindex b663420a3f..4ca2a91f2b 100644\n--- a/overlord/hookstate/ctlcmd/ctlcmd.go\n+++ b/overlord/hookstate/ctlcmd/ctlcmd.go\n@@ -184,10 +184,19 @@ func isAllowedToRun(uid uint32, args []string) bool {\n \t// A command can run if any of the following are true:\n \t//\t* It runs as root\n \t//\t* It's contained in nonRootAllowed\n-\t//\t* It's used with the -h or --help flags\n+\t//\t* It's used with the -h or --help flags, but not after `--`\n \t// note: commands still need valid context and snaps can only access own config.\n+\tisHelp := false\n+\tfor _, arg := range args {\n+\t\tif arg == \"--\" {\n+\t\t\tbreak\n+\t\t}\n+\t\tif arg == \"-h\" || arg == \"--help\" {\n+\t\t\tisHelp = true\n+\t\t\tbreak\n+\t\t}\n+\t}\n \treturn uid == 0 ||\n \t\tstrutil.ListContains(nonRootAllowed, args[0]) ||\n-\t\tstrutil.ListContains(args, \"-h\") ||\n-\t\tstrutil.ListContains(args, \"--help\")\n+\t\tisHelp\n }\n"}
{"cve":"CVE-2024-27302:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/rest/internal/cors/handlers.go b/rest/internal/cors/handlers.go\nindex e2a64b74..1952982f 100644\n--- a/rest/internal/cors/handlers.go\n+++ b/rest/internal/cors/handlers.go\n@@ -78,11 +78,13 @@ func checkAndSetHeaders(w http.ResponseWriter, r *http.Request, origins []string\n \n func isOriginAllowed(allows []string, origin string) bool {\n \tfor _, o := range allows {\n-\t\tif o == allOrigins {\n+\t\tif o == allOrigins || o == origin {\n \t\t\treturn true\n \t\t}\n \n-\t\tif strings.HasSuffix(origin, o) {\n+\t\t// allow all subdomains\n+\t\t// fix CVE-2024-27302\n+\t\tif strings.HasPrefix(o, \".\") && strings.HasSuffix(origin, o) {\n \t\t\treturn true\n \t\t}\n \t}\n"}
{"cve":"CVE-2021-21291:0708", "fix_patch": ""}
{"cve":"CVE-2021-43798:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/api/plugins.go b/pkg/api/plugins.go\nindex 6e01a3414fe..edb34a97555 100644\n--- a/pkg/api/plugins.go\n+++ b/pkg/api/plugins.go\n@@ -289,12 +289,18 @@ func (hs *HTTPServer) getPluginAssets(c *models.ReqContext) {\n \t\treturn\n \t}\n \n-\trequestedFile := filepath.Clean(web.Params(c.Req)[\"*\"])\n-\tpluginFilePath := filepath.Join(plugin.PluginDir, requestedFile)\n+\trequestedFile := web.Params(c.Req)[\"*\"]\n+\t// clean the path to remove any directory traversal attempts\n+\tcleanPath := filepath.Clean(requestedFile)\n+\tif strings.Contains(cleanPath, \"..\") {\n+\t\tc.JsonApiErr(404, \"Plugin file not found\", nil)\n+\t\treturn\n+\t}\n+\tpluginFilePath := filepath.Join(plugin.PluginDir, cleanPath)\n \n-\tif !plugin.IncludedInSignature(requestedFile) {\n+\tif !plugin.IncludedInSignature(cleanPath) {\n \t\ths.log.Warn(\"Access to requested plugin file will be forbidden in upcoming Grafana versions as the file \"+\n-\t\t\t\"is not included in the plugin signature\", \"file\", requestedFile)\n+\t\t\t\"is not included in the plugin signature\", \"file\", cleanPath)\n \t}\n \n \t// It's safe to ignore gosec warning G304 since we already clean the requested file path and subsequently\n"}
{"cve":"CVE-2020-11053:0708", "fix_patch": ""}
{"cve":"CVE-2020-4037:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/oauthproxy.go b/oauthproxy.go\nindex 8c303df8..7c04f5e0 100644\n--- a/oauthproxy.go\n+++ b/oauthproxy.go\n@@ -62,8 +62,8 @@ var (\n \tErrNeedsLogin = errors.New(\"redirect to login page\")\n \n \t// Used to check final redirects are not susceptible to open redirects.\n-\t// Matches //, /\\ and both of these with whitespace in between (eg / / or / \\).\n-\tinvalidRedirectRegex = regexp.MustCompile(`^/(\\s|\\v)?(/|\\\\)`)\n+\t// Matches //, /\\ and any of these with whitespace in between (eg / / or / \\).\n+\tinvalidRedirectRegex = regexp.MustCompile(`^/\\s*[/\\\\]`)\n )\n \n // OAuthProxy is the main authentication proxy\n"}
{"cve":"CVE-2024-25620:0708", "fix_patch": ""}
{"cve":"CVE-2022-2024:0708", "fix_patch": ""}
{"cve":"CVE-2022-39340:0708", "fix_patch": ""}
{"cve":"CVE-2018-12976:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/gosrc/gosrc.go b/gosrc/gosrc.go\nindex 9a9e44b..34e22d0 100644\n--- a/gosrc/gosrc.go\n+++ b/gosrc/gosrc.go\n@@ -356,6 +356,13 @@ func getDynamic(ctx context.Context, client *http.Client, importPath, etag strin\n \t\treturn nil, err\n \t}\n \n+\tif strings.Contains(im.projectRoot, \"..\") {\n+\t\treturn nil, NotFoundError{Message: \"invalid project root\"}\n+\t}\n+\tif strings.Contains(im.repo, \"..\") {\n+\t\treturn nil, NotFoundError{Message: \"invalid repo URL\"}\n+\t}\n+\n \tif im.projectRoot != importPath {\n \t\tvar imRoot *importMeta\n \t\tmetaProto, imRoot, _, redir, err = fetchMeta(ctx, client, im.projectRoot)\n"}
{"cve":"CVE-2024-54132:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/cmd/run/download/download.go b/pkg/cmd/run/download/download.go\nindex 99ec45bbe..9f6a535f6 100644\n--- a/pkg/cmd/run/download/download.go\n+++ b/pkg/cmd/run/download/download.go\n@@ -4,6 +4,7 @@ import (\n \t\"errors\"\n \t\"fmt\"\n \t\"path/filepath\"\n+\t\"strings\"\n \n \t\"github.com/MakeNowJust/heredoc\"\n \t\"github.com/cli/cli/v2/pkg/cmd/run/shared\"\n@@ -165,6 +166,11 @@ func runDownload(opts *DownloadOptions) error {\n \t\t\t\tcontinue\n \t\t\t}\n \t\t}\n+\n+\t\tif a.Name == \".\" || a.Name == \"..\" || strings.ContainsAny(a.Name, \"/\\\\\") {\n+\t\t\treturn fmt.Errorf(\"invalid artifact name: %q\", a.Name)\n+\t\t}\n+\n \t\tdestDir := opts.DestinationDir\n \t\tif len(wantPatterns) != 0 || len(wantNames) != 1 {\n \t\t\tdestDir = filepath.Join(destDir, a.Name)\n"}
{"cve":"CVE-2024-6257:0708", "fix_patch": ""}
{"cve":"CVE-2020-15233:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/authorize_helper.go b/authorize_helper.go\nindex ec286f5..bbc16b4 100644\n--- a/authorize_helper.go\n+++ b/authorize_helper.go\n@@ -126,27 +126,33 @@ func isMatchingRedirectURI(uri string, haystack []string) bool {\n }\n \n func isLoopbackURI(requested *url.URL, registeredURI string) bool {\n-\tregistered, err := url.Parse(registeredURI)\n+\tregistered, err := url.Parse(registeredURI) // e.g. http://127.0.0.1/cb or http://[::1]/cb\n \tif err != nil {\n \t\treturn false\n \t}\n \n-\tif registered.Scheme != \"http\" || !isLoopbackAddress(registered.Host) {\n+\tif registered.Scheme != \"http\" {\n \t\treturn false\n \t}\n \n-\tif requested.Scheme == \"http\" && isLoopbackAddress(requested.Host) && registered.Path == requested.Path {\n+\t// We can ignore the port as it is intended to be dynamic for loopback URIs\n+\tregisteredHostname := registered.Hostname()\n+\trequestedHostname := requested.Hostname()\n+\n+\t// Not a loopback URI\n+\tif !isLoopbackAddress(registeredHostname) {\n+\t\treturn false\n+\t}\n+\n+\tif requested.Scheme == \"http\" && isLoopbackAddress(requestedHostname) && registered.Path == requested.Path && registeredHostname == requestedHostname {\n \t\treturn true\n \t}\n \n \treturn false\n }\n \n-// Check if address is either an IPv4 loopback or an IPv6 loopback-\n-// An optional port is ignored\n func isLoopbackAddress(address string) bool {\n-\tmatch, _ := regexp.MatchString(\"^(127.0.0.1|\\\\[::1\\\\])(:?)(\\\\d*)$\", address)\n-\treturn match\n+\treturn address == \"127.0.0.1\" || address == \"[::1]\"\n }\n \n // IsValidRedirectURI validates a redirect_uri as specified in:\n"}
{"cve":"CVE-2021-36157:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/tenant/resolver.go b/pkg/tenant/resolver.go\nindex e5fbea252..c79f58c7e 100644\n--- a/pkg/tenant/resolver.go\n+++ b/pkg/tenant/resolver.go\n@@ -61,16 +61,24 @@ type SingleResolver struct {\n \n func (t *SingleResolver) TenantID(ctx context.Context) (string, error) {\n \t//lint:ignore faillint wrapper around upstream method\n-\treturn user.ExtractOrgID(ctx)\n+\torgID, err := user.ExtractOrgID(ctx)\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tif err := ValidTenantID(orgID); err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\treturn orgID, nil\n }\n \n func (t *SingleResolver) TenantIDs(ctx context.Context) ([]string, error) {\n-\t//lint:ignore faillint wrapper around upstream method\n-\torgID, err := user.ExtractOrgID(ctx)\n+\torgID, err := t.TenantID(ctx)\n \tif err != nil {\n \t\treturn nil, err\n \t}\n-\treturn []string{orgID}, err\n+\treturn []string{orgID}, nil\n }\n \n type MultiResolver struct {\ndiff --git a/pkg/tenant/tenant.go b/pkg/tenant/tenant.go\nindex fa8089890..625813e3c 100644\n--- a/pkg/tenant/tenant.go\n+++ b/pkg/tenant/tenant.go\n@@ -11,7 +11,8 @@ import (\n )\n \n var (\n-\terrTenantIDTooLong = errors.New(\"tenant ID is too long: max 150 characters\")\n+\terrTenantIDTooLong        = errors.New(\"tenant ID is too long: max 150 characters\")\n+\terrTenantIDContainsDotDot = errors.New(\"tenant ID cannot contain '..'\")\n )\n \n type errTenantIDUnsupportedCharacter struct {\n@@ -51,6 +52,10 @@ func NormalizeTenantIDs(tenantIDs []string) []string {\n \n // ValidTenantID\n func ValidTenantID(s string) error {\n+\tif strings.Contains(s, \"..\") {\n+\t\treturn errTenantIDContainsDotDot\n+\t}\n+\n \t// check if it contains invalid runes\n \tfor pos, r := range s {\n \t\tif !isSupported(r) {\n"}
{"cve":"CVE-2020-29529:0708", "fix_patch": ""}
{"cve":"CVE-2024-43405:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/templates/signer/tmpl_signer.go b/pkg/templates/signer/tmpl_signer.go\nindex c4378fd4..9a98d770 100644\n--- a/pkg/templates/signer/tmpl_signer.go\n+++ b/pkg/templates/signer/tmpl_signer.go\n@@ -21,18 +21,36 @@ import (\n )\n \n var (\n-\tReDigest            = regexp.MustCompile(`(?m)^#\\sdigest:\\s.+$`)\n+\tReDigest            = regexp.MustCompile(`(?m)^#\\s*digest:\\s*.+$`)\n \tErrUnknownAlgorithm = errors.New(\"unknown algorithm\")\n \tSignaturePattern    = \"# digest: \"\n \tSignatureFmt        = SignaturePattern + \"%x\" + \":%v\" // `#digest: <signature>:<fragment>`\n )\n \n+// RemoveSignatureFromData removes signature from data\n func RemoveSignatureFromData(data []byte) []byte {\n-\treturn bytes.Trim(ReDigest.ReplaceAll(data, []byte(\"\")), \"\\n\")\n+\t// we should only remove first occurence of digest because\n+\t// 1. there should be only one digest\n+\t// 2. this can be used to bypass signature check by adding another digest\n+\t// what happens is that ReDigest.ReplaceAll will remove all digests and their lines while\n+\t// `GetSignatureFromData` will only return the first valid digest\n+\t// which is used for verification this is a security issue and should be fixed\n+\tindices := ReDigest.FindAllIndex(data, -1)\n+\tif len(indices) > 0 {\n+\t\t// remove last signature\n+\t\tlast := indices[len(indices)-1]\n+\t\tdata = data[:last[0]]\n+\t}\n+\treturn bytes.TrimSpace(data)\n }\n \n func GetSignatureFromData(data []byte) []byte {\n-\treturn ReDigest.Find(data)\n+\t// return the last signature found in the data\n+\tall := ReDigest.FindAll(data, -1)\n+\tif len(all) > 0 {\n+\t\treturn all[len(all)-1]\n+\t}\n+\treturn nil\n }\n \n // SignableTemplate is a template that can be signed\n@@ -123,7 +141,7 @@ func (t *TemplateSigner) sign(data []byte) (string, error) {\n \n // Verify verifies the given template with the template signer\n func (t *TemplateSigner) Verify(data []byte, tmpl SignableTemplate) (bool, error) {\n-\tdigestData := ReDigest.Find(data)\n+\tdigestData := GetSignatureFromData(data)\n \tif len(digestData) == 0 {\n \t\treturn false, errors.New(\"digest not found\")\n \t}\n"}
{"cve":"CVE-2023-33967:0708", "fix_patch": ""}
{"cve":"CVE-2024-27289:0708", "fix_patch": ""}
{"cve":"CVE-2023-30625:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/router/failed-events-manager.go b/router/failed-events-manager.go\nindex b76908fb..56a40a2f 100644\n--- a/router/failed-events-manager.go\n+++ b/router/failed-events-manager.go\n@@ -94,7 +94,7 @@ func (fem *FailedEventsManagerT) DropFailedRecordIDs(taskRunID string) {\n \t}\n \n \t// Drop table\n-\ttable := fmt.Sprintf(`%s_%s`, failedKeysTablePrefix, taskRunID)\n+\ttable := `\"` + strings.ReplaceAll(fmt.Sprintf(`%s_%s`, failedKeysTablePrefix, taskRunID), `\"`, `\"\"`) + `\"`\n \tsqlStatement := fmt.Sprintf(`DROP TABLE IF EXISTS %s`, table)\n \t_, err := fem.dbHandle.Exec(sqlStatement)\n \tif err != nil {\n"}
{"cve":"CVE-2022-23857:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/model/criteria/criteria.go b/model/criteria/criteria.go\nindex 0d3c7295..9868d9f9 100644\n--- a/model/criteria/criteria.go\n+++ b/model/criteria/criteria.go\n@@ -29,7 +29,7 @@ func (c Criteria) OrderBy() string {\n \tvar mapped string\n \tif f == nil {\n \t\tlog.Error(\"Invalid field in 'sort' field\", \"field\", c.Sort)\n-\t\tmapped = c.Sort\n+\t\tmapped = \"title\"\n \t} else {\n \t\tif f.order == \"\" {\n \t\t\tmapped = f.field\n@@ -38,7 +38,10 @@ func (c Criteria) OrderBy() string {\n \t\t}\n \t}\n \tif c.Order != \"\" {\n-\t\tmapped = mapped + \" \" + c.Order\n+\t\torder := strings.ToUpper(c.Order)\n+\t\tif order == \"ASC\" || order == \"DESC\" {\n+\t\t\tmapped = mapped + \" \" + order\n+\t\t}\n \t}\n \treturn mapped\n }\n"}
{"cve":"CVE-2019-19499:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/tsdb/mysql/mysql.go b/pkg/tsdb/mysql/mysql.go\nindex fe41a9f38b5..84ef8ade083 100644\n--- a/pkg/tsdb/mysql/mysql.go\n+++ b/pkg/tsdb/mysql/mysql.go\n@@ -31,7 +31,7 @@ func newMysqlQueryEndpoint(datasource *models.DataSource) (tsdb.TsdbQueryEndpoin\n \tif strings.HasPrefix(datasource.Url, \"/\") {\n \t\tprotocol = \"unix\"\n \t}\n-\tcnnstr := fmt.Sprintf(\"%s:%s@%s(%s)/%s?collation=utf8mb4_unicode_ci&parseTime=true&loc=UTC&allowNativePasswords=true\",\n+\tcnnstr := fmt.Sprintf(\"%s:%s@%s(%s)/%s?collation=utf8mb4_unicode_ci&parseTime=true&loc=UTC&allowNativePasswords=true&allowAllFiles=false\",\n \t\tdatasource.User,\n \t\tdatasource.DecryptedPassword(),\n \t\tprotocol,\n"}
{"cve":"CVE-2022-1883:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/db/db.go b/db/db.go\nindex 88e5390..bc9e1b6 100644\n--- a/db/db.go\n+++ b/db/db.go\n@@ -370,11 +370,13 @@ func (db *Database) SearchAttribute(query url.Values) (results []types.SearchRes\n \t}\n \n \tif v := query.Get(\"tf_version\"); string(v) != \"\" {\n-\t\twhere = append(where, fmt.Sprintf(\"states.tf_version LIKE '%s'\", fmt.Sprintf(\"%%%s%%\", v)))\n+\t\twhere = append(where, \"states.tf_version LIKE ?\")\n+\t\tparams = append(params, fmt.Sprintf(\"%%%s%%\", v))\n \t}\n \n \tif v := query.Get(\"lineage_value\"); string(v) != \"\" {\n-\t\twhere = append(where, fmt.Sprintf(\"lineages.value LIKE '%s'\", fmt.Sprintf(\"%%%s%%\", v)))\n+\t\twhere = append(where, \"lineages.value LIKE ?\")\n+\t\tparams = append(params, fmt.Sprintf(\"%%%s%%\", v))\n \t}\n \n \tif len(where) > 0 {\n"}
{"cve":"CVE-2024-52010:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/mod/sshprox/sshprox.go b/src/mod/sshprox/sshprox.go\nindex ed1b92c..7369bd9 100644\n--- a/src/mod/sshprox/sshprox.go\n+++ b/src/mod/sshprox/sshprox.go\n@@ -174,8 +174,7 @@ func (i *Instance) CreateNewConnection(listenPort int, username string, remoteIp\n \t\ttitle = title + \":\" + strconv.Itoa(remotePort)\n \t}\n \n-\tsshCommand := []string{\"ssh\", \"-t\", connAddr, \"-p\", strconv.Itoa(remotePort)}\n-\tcmd := exec.Command(i.ExecPath, \"-w\", \"-p\", strconv.Itoa(listenPort), \"--once\", \"--config\", configPath, \"--title-format\", title, \"bash\", \"-c\", strings.Join(sshCommand, \" \"))\n+\tcmd := exec.Command(i.ExecPath, \"-w\", \"-p\", strconv.Itoa(listenPort), \"--once\", \"--config\", configPath, \"--title-format\", title, \"--\", \"ssh\", \"-t\", connAddr, \"-p\", strconv.Itoa(remotePort))\n \tcmd.Dir = filepath.Dir(i.ExecPath)\n \tcmd.Env = append(os.Environ(), \"TERM=xterm\")\n \tcmd.Stdout = os.Stdout\n"}
{"cve":"CVE-2023-41891:0708", "fix_patch": ""}
{"cve":"CVE-2022-23536:0708", "fix_patch": ""}
{"cve":"CVE-2024-24579:0708", "fix_patch": ""}
{"cve":"CVE-2020-4053:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/plugin/installer/http_installer.go b/pkg/plugin/installer/http_installer.go\nindex c07cad80a..889bc771d 100644\n--- a/pkg/plugin/installer/http_installer.go\n+++ b/pkg/plugin/installer/http_installer.go\n@@ -171,7 +171,11 @@ func (g *TarGzExtractor) Extract(buffer *bytes.Buffer, targetDir string) error {\n \t\t\treturn err\n \t\t}\n \n+\t\t// Check for path traversal attacks. See https://snyk.io/research/zip-slip-vulnerability\n \t\tpath := filepath.Join(targetDir, header.Name)\n+\t\tif !strings.HasPrefix(path, filepath.Clean(targetDir)+string(os.PathSeparator)) {\n+\t\t\treturn errors.Errorf(\"illegal path in archive: %s\", header.Name)\n+\t\t}\n \n \t\tswitch header.Typeflag {\n \t\tcase tar.TypeDir:\n"}
{"cve":"CVE-2025-24366:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/sftpd/ssh_cmd.go b/internal/sftpd/ssh_cmd.go\nindex 8a342e99..f8d14fb4 100644\n--- a/internal/sftpd/ssh_cmd.go\n+++ b/internal/sftpd/ssh_cmd.go\n@@ -425,6 +425,19 @@ func (c *sshCommand) getSystemCommand() (systemCommand, error) {\n \t\treturn command, errUnsupportedConfig\n \t}\n \tif c.command == \"rsync\" {\n+\t\t// check for dangerous arguments\n+\t\tfor _, arg := range args {\n+\t\t\t// these arguments allow to execute arbitrary commands\n+\t\t\tif arg == \"-e\" || strings.HasPrefix(arg, \"--rsh=\") || arg == \"--rsh\" {\n+\t\t\t\treturn command, errors.New(\"rsync command contains forbidden options\")\n+\t\t\t}\n+\t\t\t// these arguments allow to read/write arbitrary files\n+\t\t\tif strings.HasPrefix(arg, \"--files-from=\") || arg == \"--files-from\" ||\n+\t\t\t\tstrings.HasPrefix(arg, \"--include-from=\") || arg == \"--include-from\" ||\n+\t\t\t\tstrings.HasPrefix(arg, \"--exclude-from=\") || arg == \"--exclude-from\" {\n+\t\t\t\treturn command, errors.New(\"rsync command contains forbidden options\")\n+\t\t\t}\n+\t\t}\n \t\t// we cannot avoid that rsync creates symlinks so if the user has the permission\n \t\t// to create symlinks we add the option --safe-links to the received rsync command if\n \t\t// it is not already set. This should prevent to create symlinks that point outside\n"}
{"cve":"CVE-2022-4643:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pdf_ocr.go b/pdf_ocr.go\nindex 4d9d53a..58f5367 100644\n--- a/pdf_ocr.go\n+++ b/pdf_ocr.go\n@@ -110,16 +110,19 @@ func ConvertPDFImages(path string) (BodyResult, error) {\n \n // PdfHasImage verify if `path` (PDF) has images\n func PDFHasImage(path string) bool {\n-\tcmd := \"pdffonts -l 5 %s | tail -n +3 | cut -d' ' -f1 | sort | uniq\"\n-\tout, err := exec.Command(\"bash\", \"-c\", fmt.Sprintf(cmd, path)).Output()\n+\t// pdffonts returns a list of the fonts used in a PDF file.\n+\t// If it returns an empty list then we can assume that the PDF has no text.\n+\tout, err := exec.Command(\"pdffonts\", \"-l\", \"5\", path).Output()\n \tif err != nil {\n-\t\tlog.Println(err)\n+\t\t// If pdffonts returns an error, then we can assume that it's because the\n+\t\t// file is an image.\n+\t\tif _, ok := err.(*exec.ExitError); ok {\n+\t\t\treturn true\n+\t\t}\n+\t\tlog.Printf(\"checking for pdf images: %v, %v\", string(out), err)\n \t\treturn false\n \t}\n-\tif string(out) == \"\" {\n-\t\treturn true\n-\t}\n-\treturn false\n+\treturn len(strings.Split(string(out), \"\\n\")) <= 3\n }\n \n func ConvertPDF(r io.Reader) (string, map[string]string, error) {\n"}
{"cve":"CVE-2023-26125:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/gin.go b/gin.go\nindex 32dae24..02602a7 100644\n--- a/gin.go\n+++ b/gin.go\n@@ -668,12 +668,6 @@ func serveError(c *Context, code int, defaultMessage []byte) {\n func redirectTrailingSlash(c *Context) {\n \treq := c.Request\n \tp := req.URL.Path\n-\tif prefix := path.Clean(c.Request.Header.Get(\"X-Forwarded-Prefix\")); prefix != \".\" {\n-\t\tprefix = url.QueryEscape(prefix)\n-\t\tprefix = strings.ReplaceAll(prefix, \"%2F\", \"/\")\n-\n-\t\tp = prefix + \"/\" + req.URL.Path\n-\t}\n \treq.URL.Path = p + \"/\"\n \tif length := len(p); length > 1 && p[length-1] == '/' {\n \t\treq.URL.Path = p[:length-1]\n"}
{"cve":"CVE-2023-24623:0708", "fix_patch": ""}
{"cve":"CVE-2022-24825:0708", "fix_patch": ""}
{"cve":"CVE-2021-32783:0708", "fix_patch": ""}
{"cve":"CVE-2021-3155:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cmd/snap/cmd_run.go b/cmd/snap/cmd_run.go\nindex 2895a336ab..df9756b463 100644\n--- a/cmd/snap/cmd_run.go\n+++ b/cmd/snap/cmd_run.go\n@@ -379,7 +379,7 @@ func createUserDataDirs(info *snap.Info) error {\n \t// threads at will behind the scenes, the setting of umask applies to the\n \t// entire process so it doesn't need any special handling to lock the\n \t// executing goroutine to a single thread.\n-\toldUmask := syscall.Umask(0)\n+\toldUmask := syscall.Umask(0077)\n \tdefer syscall.Umask(oldUmask)\n \n \tusr, err := userCurrent()\n@@ -400,7 +400,7 @@ func createUserDataDirs(info *snap.Info) error {\n \t\tcreateDirs = append(createDirs, snapUserDir)\n \t}\n \tfor _, d := range createDirs {\n-\t\tif err := os.MkdirAll(d, 0755); err != nil {\n+\t\tif err := os.MkdirAll(d, 0775); err != nil {\n \t\t\t// TRANSLATORS: %q is the directory whose creation failed, %v the error message\n \t\t\treturn fmt.Errorf(i18n.G(\"cannot create %q: %v\"), d, err)\n \t\t}\n"}
{"cve":"CVE-2025-29778:0708", "fix_patch": ""}
{"cve":"CVE-2022-24450:0708", "fix_patch": ""}
{"cve":"CVE-2021-29417:0708", "fix_patch": "diff --git a/internal/pkg/gitjacker/retriever.go b/internal/pkg/gitjacker/retriever.go\nindex 3066e69..a192bfd 100644\n--- a/internal/pkg/gitjacker/retriever.go\n+++ b/internal/pkg/gitjacker/retriever.go\n@@ -162,6 +162,16 @@ func (r *retriever) downloadFile(path string) error {\n \n \tfilePath := filepath.Join(r.outputDir, \".git\", path)\n \n+\tif !strings.HasPrefix(func() string {\n+\t\tp, _ := filepath.Abs(filePath)\n+\t\treturn p\n+\t}(), func() string {\n+\t\tp, _ := filepath.Abs(filepath.Join(r.outputDir, \".git\"))\n+\t\treturn p\n+\t}()) {\n+\t\treturn fmt.Errorf(\"illegal path: %s\", path)\n+\t}\n+\n \tif r.downloaded[path] {\n \t\treturn nil\n \t}\n"}
{"cve":"CVE-2021-41803:0708", "fix_patch": ""}
{"cve":"CVE-2024-45388:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/core/hoverfly_funcs.go b/core/hoverfly_funcs.go\nindex 181d2f13..b174fbe5 100644\n--- a/core/hoverfly_funcs.go\n+++ b/core/hoverfly_funcs.go\n@@ -188,7 +188,21 @@ func (hf *Hoverfly) readResponseBodyFile(filePath string) (string, error) {\n \t\treturn \"\", fmt.Errorf(\"bodyFile contains absolute path (%s). only relative is supported\", filePath)\n \t}\n \n-\tfileContents, err := ioutil.ReadFile(filepath.Join(hf.Cfg.ResponsesBodyFilesPath, filePath))\n+\tcleanPath, err := filepath.Abs(filepath.Join(hf.Cfg.ResponsesBodyFilesPath, filePath))\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tbasePath, err := filepath.Abs(hf.Cfg.ResponsesBodyFilesPath)\n+\tif err != nil {\n+\t\treturn \"\", err\n+\t}\n+\n+\tif !strings.HasPrefix(cleanPath, basePath) {\n+\t\treturn \"\", fmt.Errorf(\"bodyFile path is not within the configured directory\")\n+\t}\n+\n+\tfileContents, err := ioutil.ReadFile(cleanPath)\n \tif err != nil {\n \t\treturn \"\", err\n \t}\n"}
{"cve":"CVE-2023-25165:0708", "fix_patch": ""}
{"cve":"CVE-2021-22538:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/rbac/rbac.go b/pkg/rbac/rbac.go\nindex 18c433bd..075b66ee 100644\n--- a/pkg/rbac/rbac.go\n+++ b/pkg/rbac/rbac.go\n@@ -63,19 +63,20 @@ func Can(given Permission, target Permission) bool {\n // provided permissions (to prevent privilege escalation).\n func CompileAndAuthorize(actorPermission Permission, toUpdate []Permission) (Permission, error) {\n \tvar permission Permission\n-\tfor _, update := range toUpdate {\n-\t\t// Verify that the user making changes has the permissions they are trying\n-\t\t// to grant. It is not valid for someone to grant permissions larger than\n-\t\t// they currently have.\n-\t\tif !Can(actorPermission, update) {\n-\t\t\treturn 0, fmt.Errorf(\"actor does not have all scopes which are being granted\")\n-\t\t}\n-\t\tpermission = permission | update\n+\tfor _, p := range toUpdate {\n+\t\tpermission = permission | p\n \t}\n \n \t// Ensure implied permissions. The actor must also have the implied\n \t// permissions by definition.\n \tpermission = AddImplied(permission)\n+\n+\t// Verify that the user making changes has all the permissions they are trying\n+\t// to grant. It is not valid for someone to grant permissions larger than they\n+\t// currently have.\n+\tif (actorPermission & permission) != permission {\n+\t\treturn 0, fmt.Errorf(\"actor does not have all scopes which are being granted\")\n+\t}\n \treturn permission, nil\n }\n \n"}
{"cve":"CVE-2023-23947:0708", "fix_patch": ""}
{"cve":"CVE-2023-25173:0708", "fix_patch": ""}
{"cve":"CVE-2022-36103:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/app/trustd/internal/reg/reg.go b/internal/app/trustd/internal/reg/reg.go\nindex ed5fd6960..c7cf98042 100644\n--- a/internal/app/trustd/internal/reg/reg.go\n+++ b/internal/app/trustd/internal/reg/reg.go\n@@ -10,8 +10,11 @@ import (\n \t\"github.com/cosi-project/runtime/pkg/resource\"\n \t\"github.com/cosi-project/runtime/pkg/safe\"\n \t\"github.com/cosi-project/runtime/pkg/state\"\n+\t\"github.com/siderolabs/crypto/csr\"\n \t\"github.com/siderolabs/crypto/x509\"\n \t\"google.golang.org/grpc\"\n+\t\"google.golang.org/grpc/codes\"\n+\t\"google.golang.org/grpc/status\"\n \n \tsecurityapi \"github.com/talos-systems/talos/pkg/machinery/api/security\"\n \t\"github.com/talos-systems/talos/pkg/machinery/resources/secrets\"\n@@ -39,6 +42,21 @@ func (r *Registrator) Certificate(ctx context.Context, in *securityapi.Certifica\n \t\treturn nil, err\n \t}\n \n+\treq, err := csr.FromPEM(in.Csr)\n+\tif err != nil {\n+\t\treturn nil, status.Errorf(codes.InvalidArgument, \"unable to parse CSR: %v\", err)\n+\t}\n+\n+\tif err := req.Validate(); err != nil {\n+\t\treturn nil, status.Errorf(codes.InvalidArgument, \"invalid CSR: %v\", err)\n+\t}\n+\n+\t// Only members of the `system:nodes` organization are allowed to request\n+\t// certificates.\n+\tif len(req.CertificateRequest.Subject.Organization) != 1 || req.CertificateRequest.Subject.Organization[0] != \"system:nodes\" {\n+\t\treturn nil, status.Errorf(codes.PermissionDenied, \"invalid organization: %v\", req.CertificateRequest.Subject.Organization)\n+\t}\n+\n \t// TODO: Verify that the request is coming from the IP addresss declared in\n \t// the CSR.\n \tsigned, err := x509.NewCertificateFromCSRBytes(osRoot.TypedSpec().CA.Crt, osRoot.TypedSpec().CA.Key, in.Csr)\n"}
{"cve":"CVE-2023-22480:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/router/v1/v1api.go b/pkg/router/v1/v1api.go\nindex 1a3b9cbc1..d159e9566 100644\n--- a/pkg/router/v1/v1api.go\n+++ b/pkg/router/v1/v1api.go\n@@ -66,8 +66,8 @@ func V1(parent iris.Party) {\n \tmvc.New(AuthScope.Party(\"/msg/subscribes\")).HandleError(ErrorHandler).Handle(controller.NewMessageSubscribeController())\n \tmvc.New(AuthScope.Party(\"/user/messages\")).HandleError(ErrorHandler).Handle(controller.NewUserMsgController())\n \tmvc.New(AuthScope.Party(\"/user/settings\")).HandleError(ErrorHandler).Handle(controller.NewUserSettingController())\n+\tAuthScope.Get(\"/clusters/kubeconfig/{name}\", downloadKubeconfig)\n \tWhiteScope = v1.Party(\"/\")\n-\tWhiteScope.Get(\"/clusters/kubeconfig/{name}\", downloadKubeconfig)\n \tWhiteScope.Get(\"/captcha\", generateCaptcha)\n \tmvc.New(WhiteScope.Party(\"/theme\")).HandleError(ErrorHandler).Handle(controller.NewThemeController())\n \n"}
{"cve":"CVE-2022-36009:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/eventcontent.go b/eventcontent.go\nindex 5f9ba63..a32a955 100644\n--- a/eventcontent.go\n+++ b/eventcontent.go\n@@ -431,7 +431,7 @@ func NewPowerLevelContentFromEvent(event *Event) (c PowerLevelContent, err error\n \t\t\tUsersDefaultLevel  levelJSONValue            `json:\"users_default\"`\n \t\t\tEventLevels        map[string]levelJSONValue `json:\"events\"`\n \t\t\tStateDefaultLevel  levelJSONValue            `json:\"state_default\"`\n-\t\t\tEventDefaultLevel  levelJSONValue            `json:\"event_default\"`\n+\t\t\tEventsDefaultLevel levelJSONValue            `json:\"events_default\"`\n \t\t\tNotificationLevels map[string]levelJSONValue `json:\"notifications\"`\n \t\t}\n \t\tif err = json.Unmarshal(event.Content(), &content); err != nil {\n@@ -446,7 +446,7 @@ func NewPowerLevelContentFromEvent(event *Event) (c PowerLevelContent, err error\n \t\tcontent.RedactLevel.assignIfExists(&c.Redact)\n \t\tcontent.UsersDefaultLevel.assignIfExists(&c.UsersDefault)\n \t\tcontent.StateDefaultLevel.assignIfExists(&c.StateDefault)\n-\t\tcontent.EventDefaultLevel.assignIfExists(&c.EventsDefault)\n+\t\tcontent.EventsDefaultLevel.assignIfExists(&c.EventsDefault)\n \n \t\tfor k, v := range content.UserLevels {\n \t\t\tif c.Users == nil {\n"}
{"cve":"CVE-2021-32701:0708", "fix_patch": ""}
{"cve":"CVE-2021-21411:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/providers/gitlab.go b/providers/gitlab.go\nindex eb7c2ffa..3d766e2f 100644\n--- a/providers/gitlab.go\n+++ b/providers/gitlab.go\n@@ -296,7 +296,7 @@ func (p *GitLabProvider) EnrichSession(ctx context.Context, s *sessions.SessionS\n \ts.User = userInfo.Username\n \ts.Email = userInfo.Email\n \n-\tp.addGroupsToSession(ctx, s)\n+\tp.addGroupsToSession(s, userInfo.Groups)\n \n \tp.addProjectsToSession(ctx, s)\n \n@@ -304,10 +304,10 @@ func (p *GitLabProvider) EnrichSession(ctx context.Context, s *sessions.SessionS\n \n }\n \n-// addGroupsToSession projects into session.Groups\n-func (p *GitLabProvider) addGroupsToSession(ctx context.Context, s *sessions.SessionState) {\n-\t// Iterate over projects, check if oauth2-proxy can get project information on behalf of the user\n-\tfor _, group := range p.Groups {\n+// addGroupsToSession adds the user's gitlab groups into the session state\n+// This method prefixes groups names with `group` to specify group kind\n+func (p *GitLabProvider) addGroupsToSession(s *sessions.SessionState, userGroups []string) {\n+\tfor _, group := range userGroups {\n \t\ts.Groups = append(s.Groups, fmt.Sprintf(\"group:%s\", group))\n \t}\n }\n"}
{"cve":"CVE-2022-35936:0708", "fix_patch": ""}
{"cve":"CVE-2022-23542:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/server/commands/check_utils.go b/server/commands/check_utils.go\nindex 2b1651e4..f534840d 100644\n--- a/server/commands/check_utils.go\n+++ b/server/commands/check_utils.go\n@@ -336,16 +336,23 @@ func (rc *resolutionContext) fork(tk *openfgapb.TupleKey, tracer resolutionTrace\n }\n \n func (rc *resolutionContext) readUserTuple(ctx context.Context, backend storage.TupleBackend) (*openfgapb.TupleKey, error) {\n-\ttk, ok := rc.contextualTuples.ReadUserTuple(rc.tk)\n-\tif ok {\n-\t\treturn tk, nil\n-\t}\n-\n \ttuple, err := backend.ReadUserTuple(ctx, rc.store, rc.tk)\n \tif err != nil {\n \t\treturn nil, err\n \t}\n-\treturn tuple.GetKey(), nil\n+\n+\tcontextualTuple, ok := rc.contextualTuples.ReadUserTuple(rc.tk)\n+\tif !ok {\n+\t\treturn tuple.GetKey(), nil\n+\t}\n+\n+\t// if there is a contextual tuple, we need to check that it is valid\n+\tif err := validation.ValidateTuple(rc.model, contextualTuple); err != nil {\n+\t\t// if the contextual tuple is invalid, we ignore it and return the database tuple\n+\t\treturn tuple.GetKey(), nil\n+\t}\n+\n+\treturn contextualTuple, nil\n }\n \n func (rc *resolutionContext) readUsersetTuples(ctx context.Context, backend storage.TupleBackend) (storage.TupleKeyIterator, error) {\n"}
{"cve":"CVE-2024-1724:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/interfaces/builtin/home.go b/interfaces/builtin/home.go\nindex 998ca254f0..86f297269c 100644\n--- a/interfaces/builtin/home.go\n+++ b/interfaces/builtin/home.go\n@@ -78,7 +78,7 @@ owner /run/user/[0-9]*/gvfs/*/**  w,\n \n # Disallow writes to the well-known directory included in\n # the user's PATH on several distributions\n-audit deny @{HOME}/bin/{,**} wl,\n+deny @{HOME}/bin/{,**} w,\n `\n \n const homeConnectedPlugAppArmorWithAllRead = `\n"}
{"cve":"CVE-2023-22736:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/controller/appcontroller.go b/controller/appcontroller.go\nindex a989c5a16..66068f80d 100644\n--- a/controller/appcontroller.go\n+++ b/controller/appcontroller.go\n@@ -1773,6 +1773,13 @@ func (ctrl *ApplicationController) canProcessApp(obj interface{}) bool {\n \tif !ok {\n \t\treturn false\n \t}\n+\n+\t// Only process given app if it exists in a watched namespace, or in the\n+\t// control plane's namespace.\n+\tif app.Namespace != ctrl.namespace && !glob.MatchStringInList(ctrl.applicationNamespaces, app.Namespace, false) {\n+\t\treturn false\n+\t}\n+\n \tif ctrl.clusterFilter != nil {\n \t\tcluster, err := ctrl.db.GetCluster(context.Background(), app.Spec.Destination.Server)\n \t\tif err != nil {\n@@ -1781,12 +1788,6 @@ func (ctrl *ApplicationController) canProcessApp(obj interface{}) bool {\n \t\treturn ctrl.clusterFilter(cluster)\n \t}\n \n-\t// Only process given app if it exists in a watched namespace, or in the\n-\t// control plane's namespace.\n-\tif app.Namespace != ctrl.namespace && !glob.MatchStringInList(ctrl.applicationNamespaces, app.Namespace, false) {\n-\t\treturn false\n-\t}\n-\n \treturn true\n }\n \n"}
{"cve":"CVE-2020-8559:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go b/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\nindex 17cbad90f74..5032e1bcb44 100644\n--- a/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\n+++ b/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\n@@ -273,15 +273,22 @@ func (h *UpgradeAwareHandler) tryUpgrade(w http.ResponseWriter, req *http.Reques\n \t\tlocation.Host = h.Location.Host\n \t}\n \n+\t// TODO: Check that the constructed URL is valid.\n+\tbackendConnIsSecure := location.Scheme == \"https\" || location.Scheme == \"unix\"\n+\n \tclone := utilnet.CloneRequest(req)\n \t// Only append X-Forwarded-For in the upgrade path, since httputil.NewSingleHostReverseProxy\n \t// handles this in the non-upgrade path.\n \tutilnet.AppendForwardedForHeader(clone)\n \tif h.InterceptRedirects {\n+\t\tif !backendConnIsSecure {\n+\t\t\t// when forwarding to a non-secure backend, scrub the authorization header from the request\n+\t\t\tclone.Header.Del(\"Authorization\")\n+\t\t}\n \t\tklog.V(6).Infof(\"Connecting to backend proxy (intercepting redirects) %s\\n  Headers: %v\", &location, clone.Header)\n \t\tbackendConn, rawResponse, err = utilnet.ConnectWithRedirects(req.Method, &location, clone.Header, req.Body, utilnet.DialerFunc(h.DialForUpgrade), h.RequireSameHostRedirects)\n \t} else {\n-\t\tklog.V(6).Infof(\"Connecting to backend proxy (direct dial) %s\\n  Headers: %v\", &location, clone.Header)\n+\t\tklog.V(6).Infof(\"Connecting to backend proxy (direct dial) %s, secure=%v\\n  Headers: %v\", &location, backendConnIsSecure, clone.Header)\n \t\tclone.URL = &location\n \t\tbackendConn, err = h.DialForUpgrade(clone)\n \t}\n"}
{"cve":"CVE-2023-5122:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/http_storage.go b/pkg/http_storage.go\nindex 1434126..2f860f7 100644\n--- a/pkg/http_storage.go\n+++ b/pkg/http_storage.go\n@@ -6,6 +6,7 @@ import (\n \t\"io\"\n \t\"net/http\"\n \t\"net/url\"\n+\t\"path\"\n \t\"strings\"\n \n \t\"github.com/grafana/grafana-plugin-sdk-go/backend\"\n@@ -81,7 +82,11 @@ func (c *httpStorage) Stat() error {\n }\n \n func newRequestFromQuery(settings *backend.DataSourceInstanceSettings, customSettings dataSourceSettings, query dataSourceQuery) (*http.Request, error) {\n-\tu, err := url.Parse(settings.URL + query.Path)\n+\tu, err := url.Parse(settings.URL)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tu.Path = path.Join(u.Path, query.Path)\n \tif err != nil {\n \t\treturn nil, err\n \t}\n"}
{"cve":"CVE-2022-46146:0708", "fix_patch": ""}
{"cve":"CVE-2022-31145:0708", "fix_patch": ""}
{"cve":"CVE-2021-26921:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/util/session/sessionmanager.go b/util/session/sessionmanager.go\nindex 2bd99f9fd..df4317eb2 100644\n--- a/util/session/sessionmanager.go\n+++ b/util/session/sessionmanager.go\n@@ -283,6 +283,10 @@ func (mgr *SessionManager) Parse(tokenString string) (jwt.Claims, error) {\n \t\treturn nil, err\n \t}\n \n+\tif !account.Enabled {\n+\t\treturn nil, status.Errorf(codes.Unauthenticated, accountDisabled, subject)\n+\t}\n+\n \tif id := jwtutil.StringField(claims, \"jti\"); id != \"\" && account.TokenIndex(id) == -1 {\n \t\treturn nil, fmt.Errorf(\"account %s does not have token with id %s\", subject, id)\n \t}\n"}
{"cve":"CVE-2025-46331:0708", "fix_patch": "diff --git a/internal/graph/cached_resolver.go b/internal/graph/cached_resolver.go\nindex 2e7e02cc..d69c0494 100644\n--- a/internal/graph/cached_resolver.go\n+++ b/internal/graph/cached_resolver.go\n@@ -3,6 +3,7 @@ package graph\n import (\n \t\"context\"\n \t\"strconv\"\n+\t\"sync\"\n \t\"time\"\n \n \t\"github.com/cespare/xxhash/v2\"\n"}
{"cve":"CVE-2025-24976:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/registry/auth/token/token.go b/registry/auth/token/token.go\nindex 55d0b7f6..d5096785 100644\n--- a/registry/auth/token/token.go\n+++ b/registry/auth/token/token.go\n@@ -219,7 +219,11 @@ func verifyJWK(header jose.Header, verifyOpts VerifyOptions) (signingKey crypto.\n \t// Check to see if the key includes a certificate chain.\n \tif len(jwk.Certificates) == 0 {\n \t\t// The JWK should be one of the trusted root keys.\n-\t\tif _, trusted := verifyOpts.TrustedKeys[jwk.KeyID]; !trusted {\n+\t\ttrustedKey, trusted := verifyOpts.TrustedKeys[jwk.KeyID]\n+\t\tif !trusted {\n+\t\t\treturn nil, errors.New(\"untrusted JWK with no certificate chain\")\n+\t\t}\n+\t\tif !isEqual(jwk.Key, trustedKey) {\n \t\t\treturn nil, errors.New(\"untrusted JWK with no certificate chain\")\n \t\t}\n \t\t// The JWK is one of the trusted keys.\n@@ -250,6 +254,20 @@ func verifyJWK(header jose.Header, verifyOpts VerifyOptions) (signingKey crypto.\n \treturn\n }\n \n+func isEqual(a, b crypto.PublicKey) bool {\n+\taTyped, aOK := a.(jose.OpaqueSigner)\n+\tbTyped, bOK := b.(jose.OpaqueSigner)\n+\tif aOK && bOK {\n+\t\treturn jose.IsSameKey(aTyped.Public(), bTyped.Public())\n+\t}\n+\n+\t// NOTE(milosgajdos): this is not great but crypto.PublicKey\n+\t// does not implement comparison, so we try to do our best\n+\t// and see if we can \"downcast\" to the known types\n+\t// This is also what the underlying go-jose library does\n+\treturn jose.IsSameKey(a, b)\n+}\n+\n func getCertPubKey(chains [][]*x509.Certificate) crypto.PublicKey {\n \t// NOTE(milosgajdos): if there are no certificates\n \t// header.Certificates call above returns error, so we are\n"}
{"cve":"CVE-2022-24738:0708", "fix_patch": ""}
{"cve":"CVE-2022-31130:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/util/proxyutil/reverse_proxy.go b/pkg/util/proxyutil/reverse_proxy.go\nindex 3ce5d3b4011..f88a5fd80df 100644\n--- a/pkg/util/proxyutil/reverse_proxy.go\n+++ b/pkg/util/proxyutil/reverse_proxy.go\n@@ -69,6 +69,10 @@ func wrapDirector(d func(*http.Request)) func(req *http.Request) {\n \t\td(req)\n \t\tPrepareProxyRequest(req)\n \n+\t\t// We don't want to proxy the authentication token to the plugin\n+\t\treq.Header.Del(\"Authorization\")\n+\t\treq.Header.Del(\"X-Grafana-User\")\n+\n \t\t// Clear Origin and Referer to avoid CORS issues\n \t\treq.Header.Del(\"Origin\")\n \t\treq.Header.Del(\"Referer\")\n"}
{"cve":"CVE-2022-23538:0708", "fix_patch": ""}
{"cve":"CVE-2024-47616:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/grpcutil/options.go b/pkg/grpcutil/options.go\nindex d3329251..1844cb48 100644\n--- a/pkg/grpcutil/options.go\n+++ b/pkg/grpcutil/options.go\n@@ -92,21 +92,22 @@ func RequireSignedJWT(ctx context.Context, key []byte) error {\n \t\t\treturn status.Error(codes.Unauthenticated, \"unauthenticated\")\n \t\t}\n \n-\t\ttok, err := jwt.ParseSigned(rawjwt)\n+\t\ttok, err := jwt.ParseSigned(rawjwt, []jose.SignatureAlgorithm{jose.HS256})\n \t\tif err != nil {\n \t\t\treturn status.Errorf(codes.Unauthenticated, \"invalid JWT: %v\", err)\n \t\t}\n \n-\t\tvar claims struct {\n-\t\t\tExpiry *jwt.NumericDate `json:\"exp,omitempty\"`\n-\t\t}\n+\t\tvar claims jwt.Claims\n \t\terr = tok.Claims(key, &claims)\n \t\tif err != nil {\n \t\t\treturn status.Errorf(codes.Unauthenticated, \"invalid JWT: %v\", err)\n \t\t}\n \n-\t\tif claims.Expiry == nil || time.Now().After(claims.Expiry.Time()) {\n-\t\t\treturn status.Errorf(codes.Unauthenticated, \"expired JWT: %v\", err)\n+\t\terr = claims.ValidateWithLeeway(jwt.Expected{\n+\t\t\tTime: time.Now(),\n+\t\t}, 0)\n+\t\tif err != nil {\n+\t\t\treturn status.Errorf(codes.Unauthenticated, \"invalid JWT claims: %v\", err)\n \t\t}\n \t}\n \treturn nil\n"}
{"cve":"CVE-2024-24747:0708", "fix_patch": ""}
{"cve":"CVE-2024-39330:0708", "fix_patch": ""}
{"cve":"CVE-2021-35042:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 7a16d4889a..cbcd8b8e89 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1897,26 +1897,20 @@ class Query(BaseExpression):\n         errors = []\n         for item in ordering:\n             if isinstance(item, str):\n-                if '.' in item:\n-                    warnings.warn(\n-                        'Passing column raw column aliases to order_by() is '\n-                        'deprecated. Wrap %r in a RawSQL expression before '\n-                        'passing it to order_by().' % item,\n-                        category=RemovedInDjango40Warning,\n-                        stacklevel=3,\n-                    )\n-                    continue\n                 if item == '?':\n                     continue\n-                if item.startswith('-'):\n-                    item = item[1:]\n-                if item in self.annotations:\n-                    continue\n-                if self.extra and item in self.extra:\n+                _, _, order_by_field = item.rpartition('-')\n+                if order_by_field in self.annotations:\n                     continue\n-                # names_to_path() validates the lookup. A descriptive\n-                # FieldError will be raise if it's not.\n-                self.names_to_path(item.split(LOOKUP_SEP), self.model._meta)\n+                # QuerySet.order_by() is untrusted input but field names are\n+                # trusted parts of the query. Wrap in RawSQL to protect from\n+                # injection via column aliasing.\n+                if '.' in order_by_field:\n+                    raise FieldError(\n+                        'Passing column aliases to order_by() is not allowed. '\n+                        'Wrap %r in a RawSQL expression to use it.' % order_by_field\n+                    )\n+                self.names_to_path(order_by_field.split(LOOKUP_SEP), self.model._meta)\n             elif not hasattr(item, 'resolve_expression'):\n                 errors.append(item)\n             if getattr(item, 'contains_aggregate', False):\n"}
{"cve":"CVE-2021-33203:0708", "fix_patch": ""}
{"cve":"CVE-2022-28347:0708", "fix_patch": ""}
{"cve":"CVE-2017-7233:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/utils/http.py b/django/utils/http.py\nindex c053185a8a..1ce62215b8 100644\n--- a/django/utils/http.py\n+++ b/django/utils/http.py\n@@ -312,6 +312,9 @@ def _is_safe_url(url, host):\n     # allow this syntax.\n     if not url_info.netloc and url_info.scheme:\n         return False\n+    # Forbid numeric domains.\n+    if url_info.netloc and re.match(r'^\\d+$', url_info.netloc):\n+        return False\n     # Forbid URLs that start with control characters. Some browsers (like\n     # Chrome) ignore quite a few control characters at the start of a\n     # URL and might consider the URL as scheme relative.\n"}
{"cve":"CVE-2021-3281:0708", "fix_patch": ""}
{"cve":"CVE-2018-14574:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/middleware/common.py b/django/middleware/common.py\nindex d8cfb9a8b0..aac82414eb 100644\n--- a/django/middleware/common.py\n+++ b/django/middleware/common.py\n@@ -96,7 +96,7 @@ class CommonMiddleware(MiddlewareMixin):\n                 \"Change your form to point to %(url)s (note the trailing \"\n                 \"slash), or set APPEND_SLASH=False in your Django settings.\" % {\n                     'method': request.method,\n-                    'url': request.get_host() + new_path,\n+                    'url': new_path,\n                 }\n             )\n         return new_path\ndiff --git a/django/urls/resolvers.py b/django/urls/resolvers.py\nindex c5b0811136..290071a77c 100644\n--- a/django/urls/resolvers.py\n+++ b/django/urls/resolvers.py\n@@ -604,8 +604,8 @@ class URLResolver:\n                     # safe characters from `pchar` definition of RFC 3986\n                     url = quote(candidate_pat % text_candidate_subs, safe=RFC3986_SUBDELIMS + '/~:@')\n                     # Don't allow construction of scheme relative urls.\n-                    if url.startswith('//'):\n-                        url = '/%%2F%s' % url[2:]\n+                    if url.startswith('//') or url.startswith('/\\\\'):\n+                        url = '/%%2F%s' % url.lstrip('/')\n                     return url\n         # lookup_view can be URL name or callable, but callables are not\n         # friendly in error messages.\n"}
{"cve":"CVE-2021-45452:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/core/files/storage.py b/django/core/files/storage.py\nindex 89faa626e6..85165628c6 100644\n--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -47,6 +47,10 @@ class Storage:\n         if name is None:\n             name = content.name\n \n+        # Validate the name before calling get_available_name(), to prevent\n+        # directory traversal attacks.\n+        validate_file_name(name)\n+\n         if not hasattr(content, 'chunks'):\n             content = File(content, name)\n \n@@ -68,9 +72,6 @@ class Storage:\n         available for new content to be written to.\n         \"\"\"\n         dir_name, file_name = os.path.split(name)\n-        if '..' in pathlib.PurePath(dir_name).parts:\n-            raise SuspiciousFileOperation(\"Detected path traversal attempt in '%s'\" % dir_name)\n-        validate_file_name(file_name)\n         file_root, file_ext = os.path.splitext(file_name)\n         # If the filename already exists, add an underscore and a random 7\n         # character alphanumeric string (before the file extension, if one\n@@ -102,9 +103,8 @@ class Storage:\n         to be passed to the save() method.\n         \"\"\"\n         # `filename` may include a path as returned by FileField.upload_to.\n+        validate_file_name(filename)\n         dirname, filename = os.path.split(filename)\n-        if '..' in pathlib.PurePath(dirname).parts:\n-            raise SuspiciousFileOperation(\"Detected path traversal attempt in '%s'\" % dirname)\n         return os.path.normpath(os.path.join(dirname, self.get_valid_name(filename)))\n \n     def path(self, name):\n"}
{"cve":"CVE-2015-8213:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/utils/formats.py b/django/utils/formats.py\nindex d2bdda458e..c08a0ad021 100644\n--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -91,6 +91,16 @@ def get_format(format_type, lang=None, use_l10n=None):\n     If use_l10n is provided and is not None, that will force the value to\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n+    # A non-setting format string may be passed in, so see if it's a defined\n+    # setting before trying to look up a format from settings.\n+    if format_type not in {\n+        'DATE_FORMAT', 'DATETIME_FORMAT', 'TIME_FORMAT', 'YEAR_MONTH_FORMAT',\n+        'MONTH_DAY_FORMAT', 'SHORT_DATE_FORMAT', 'SHORT_DATETIME_FORMAT',\n+        'FIRST_DAY_OF_WEEK', 'DECIMAL_SEPARATOR', 'THOUSAND_SEPARATOR',\n+        'NUMBER_GROUPING', 'DATE_INPUT_FORMATS', 'TIME_INPUT_FORMATS',\n+        'DATETIME_INPUT_FORMATS',\n+    }:\n+        return format_type\n     format_type = force_str(format_type)\n     if use_l10n or (use_l10n is None and settings.USE_L10N):\n         if lang is None:\n"}
{"cve":"CVE-2022-21699:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/IPython/core/application.py b/IPython/core/application.py\nindex e93a10647..2b389a686 100644\n--- a/IPython/core/application.py\n+++ b/IPython/core/application.py\n@@ -157,7 +157,7 @@ def _config_file_name_changed(self, change):\n     config_file_paths = List(Unicode())\n     @default('config_file_paths')\n     def _config_file_paths_default(self):\n-        return [os.getcwd()]\n+        return []\n \n     extra_config_file = Unicode(\n     help=\"\"\"Path to an extra config file to load.\ndiff --git a/IPython/core/profileapp.py b/IPython/core/profileapp.py\nindex 97434e3d0..4591dc04c 100644\n--- a/IPython/core/profileapp.py\n+++ b/IPython/core/profileapp.py\n@@ -178,11 +178,6 @@ def list_profile_dirs(self):\n             print(\"Available profiles in %s:\" % self.ipython_dir)\n             self._print_profiles(profiles)\n         \n-        profiles = list_profiles_in(os.getcwd())\n-        if profiles:\n-            print()\n-            print(\"Available profiles in current directory (%s):\" % os.getcwd())\n-            self._print_profiles(profiles)\n         \n         print()\n         print(\"To use any of the above profiles, start IPython with:\")\ndiff --git a/IPython/core/profiledir.py b/IPython/core/profiledir.py\nindex 756595adb..71ef75aee 100644\n--- a/IPython/core/profiledir.py\n+++ b/IPython/core/profiledir.py\n@@ -187,9 +187,7 @@ def find_profile_dir_by_name(cls, ipython_dir, name=u'default', config=None):\n         This searches through a sequence of paths for a profile dir.  If it\n         is not found, a :class:`ProfileDirError` exception will be raised.\n \n-        The search path algorithm is:\n-        1. ``os.getcwd()``\n-        2. ``ipython_dir``\n+        The search path is: ``ipython_dir``\n \n         Parameters\n         ----------\n@@ -200,7 +198,7 @@ def find_profile_dir_by_name(cls, ipython_dir, name=u'default', config=None):\n             will be \"profile_<profile>\".\n         \"\"\"\n         dirname = u'profile_' + name\n-        paths = [os.getcwd(), ipython_dir]\n+        paths = [ipython_dir]\n         for p in paths:\n             profile_dir = os.path.join(p, dirname)\n             if os.path.isdir(profile_dir):\n"}
{"cve":"CVE-2023-34233:0708", "fix_patch": ""}
{"cve":"CVE-2022-21683:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/wagtail/admin/views/pages/edit.py b/wagtail/admin/views/pages/edit.py\nindex 2edf11b450..2cf0252f65 100644\n--- a/wagtail/admin/views/pages/edit.py\n+++ b/wagtail/admin/views/pages/edit.py\n@@ -141,11 +141,15 @@ class EditView(TemplateResponseMixin, ContextMixin, HookResponseMixin, View):\n         # Get subscribers to individual threads\n         replies = CommentReply.objects.filter(comment_id__in=relevant_comment_ids)\n         comments = Comment.objects.filter(id__in=relevant_comment_ids)\n-        thread_users = get_user_model().objects.exclude(pk=self.request.user.pk).exclude(pk__in=subscribers.values_list('user_id', flat=True)).prefetch_related(\n+        thread_users = get_user_model().objects.filter(\n+            Q(**{f'{COMMENTS_RELATION_NAME}__in': comments}) | Q(comment_replies__in=replies)\n+        ).distinct().exclude(\n+            pk=self.request.user.pk\n+        ).exclude(\n+            pk__in=subscribers.values_list('user_id', flat=True)\n+        ).prefetch_related(\n             Prefetch('comment_replies', queryset=replies),\n             Prefetch(COMMENTS_RELATION_NAME, queryset=comments)\n-        ).exclude(\n-            Q(comment_replies__isnull=True) & Q(**{('%s__isnull' % COMMENTS_RELATION_NAME): True})\n         )\n \n         # Skip if no recipients\n"}
{"cve":"CVE-2024-23334:0708", "fix_patch": "diff --git a/vendor/llhttp b/vendor/llhttp\n--- a/vendor/llhttp\n+++ b/vendor/llhttp\n@@ -1 +1 @@\n-Subproject commit 9ab2afc85b2880d96a94d38afaee301c6a314049\n+Subproject commit 9ab2afc85b2880d96a94d38afaee301c6a314049-dirty\n"}
{"cve":"CVE-2022-37109:0708", "fix_patch": ""}
{"cve":"CVE-2023-49736:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/superset/jinja_context.py b/superset/jinja_context.py\nindex 4bb0b91a4e..98d8cf1c80 100644\n--- a/superset/jinja_context.py\n+++ b/superset/jinja_context.py\n@@ -397,22 +397,21 @@ def validate_template_context(\n     return validate_context_types(context)\n \n \n-def where_in(values: list[Any], mark: str = \"'\") -> str:\n+def where_in(values: list[Any], quote: str = \"'\") -> str:\n     \"\"\"\n     Given a list of values, build a parenthesis list suitable for an IN expression.\n-\n         >>> where_in([1, \"b\", 3])\n         (1, 'b', 3)\n-\n     \"\"\"\n+    if quote not in (\"'\", '\"'):\n+        raise SupersetTemplateException(f\"Unsupported quote value: {quote}\")\n \n-    def quote(value: Any) -> str:\n+    def do_quote(value: Any) -> str:\n         if isinstance(value, str):\n-            value = value.replace(mark, mark * 2)\n-            return f\"{mark}{value}{mark}\"\n+            return f\"{quote}{value.replace(quote, quote * 2)}{quote}\"\n         return str(value)\n \n-    joined_values = \", \".join(quote(value) for value in values)\n+    joined_values = \", \".join(do_quote(value) for value in values)\n     return f\"({joined_values})\"\n \n \n"}
{"cve":"CVE-2024-39877:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/airflow/models/dag.py b/airflow/models/dag.py\nindex 560d05b548..b55449fc1b 100644\n--- a/airflow/models/dag.py\n+++ b/airflow/models/dag.py\n@@ -775,7 +775,7 @@ class DAG(LoggingMixin):\n         env = self.get_template_env(force_sandboxed=True)\n \n         if not doc_md.endswith(\".md\"):\n-            template = jinja2.Template(doc_md)\n+            template = env.from_string(doc_md)\n         else:\n             try:\n                 template = env.get_template(doc_md)\n"}
{"cve":"CVE-2023-33977:0708", "fix_patch": ""}
{"cve":"CVE-2022-31506:0708", "fix_patch": ""}
{"cve":"CVE-2019-7539:0708", "fix_patch": ""}
{"cve":"CVE-2025-23042:0708", "fix_patch": ""}
{"cve":"CVE-2022-3298:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/rdiffweb/controller/pref_sshkeys.py b/rdiffweb/controller/pref_sshkeys.py\nindex 4fc3555..d2a643a 100644\n--- a/rdiffweb/controller/pref_sshkeys.py\n+++ b/rdiffweb/controller/pref_sshkeys.py\n@@ -50,7 +50,7 @@ class SshForm(CherryForm):\n     title = StringField(\n         _('Title'),\n         description=_('The title is an optional description to identify the key. e.g.: bob@thinkpad-t530'),\n-        validators=[validators.data_required()],\n+        validators=[validators.data_required(), validators.Length(max=255)],\n     )\n     key = StringField(\n         _('Key'),\n@@ -58,7 +58,7 @@ class SshForm(CherryForm):\n         description=_(\n             \"Enter a SSH public key. It should start with 'ssh-dss', 'ssh-ed25519', 'ssh-rsa', 'ecdsa-sha2-nistp256', 'ecdsa-sha2-nistp384' or 'ecdsa-sha2-nistp521'.\"\n         ),\n-        validators=[validators.data_required(), validate_key],\n+        validators=[validators.data_required(), validate_key, validators.Length(max=8192)],\n     )\n     fingerprint = StringField('Fingerprint')\n \n"}
{"cve":"CVE-2022-41672:0708", "fix_patch": ""}
{"cve":"CVE-2024-3571:0708", "fix_patch": ""}
{"cve":"CVE-2024-0243:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/libs/core/langchain_core/utils/html.py b/libs/core/langchain_core/utils/html.py\nindex 95e1c3c2f..c66cdd5fe 100644\n--- a/libs/core/langchain_core/utils/html.py\n+++ b/libs/core/langchain_core/utils/html.py\n@@ -83,7 +83,7 @@ def extract_sub_links(\n     for path in absolute_paths:\n         if any(path.startswith(exclude) for exclude in exclude_prefixes):\n             continue\n-        if prevent_outside and not path.startswith(base_url):\n+        if prevent_outside and urlparse(path).netloc != urlparse(base_url).netloc:\n             continue\n         res.append(path)\n     return res\n"}
{"cve":"CVE-2023-6831:0708", "fix_patch": ""}
{"cve":"CVE-2024-3848:0708", "fix_patch": ""}
{"cve":"CVE-2021-21354:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pollbot/middlewares.py b/pollbot/middlewares.py\nindex 1c5d381..9c9effa 100644\n--- a/pollbot/middlewares.py\n+++ b/pollbot/middlewares.py\n@@ -61,7 +61,11 @@ async def handle_any(request, response):\n async def handle_404(request, response):\n     if 'json' not in response.headers['Content-Type']:\n         if request.path.endswith('/'):\n-            return web.HTTPFound(request.path.rstrip('/'))\n+            from urllib.parse import urlparse\n+            location = request.path.rstrip('/')\n+            parsed = urlparse(location)\n+            if not parsed.scheme and not parsed.netloc:\n+                return web.HTTPFound(location)\n         return web.json_response({\n             \"status\": 404,\n             \"message\": \"Page '{}' not found\".format(request.path)\n"}
{"cve":"CVE-2021-4315:0708", "fix_patch": ""}
{"cve":"CVE-2023-39631:0708", "fix_patch": ""}
{"cve":"CVE-2024-21542:0708", "fix_patch": ""}
{"cve":"CVE-2017-0360:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/trytond/tools/misc.py b/trytond/tools/misc.py\nindex 2b9a7f8f..ec27bb91 100644\n--- a/trytond/tools/misc.py\n+++ b/trytond/tools/misc.py\n@@ -30,9 +30,9 @@ def file_open(name, mode=\"r\", subdir='modules', encoding=None):\n \n     def secure_join(root, *paths):\n         \"Join paths and ensure it still below root\"\n-        path = os.path.join(root, *paths)\n-        path = os.path.normpath(path)\n-        if not path.startswith(root):\n+        path = os.path.realpath(os.path.join(root, *paths))\n+        root = os.path.realpath(root)\n+        if path != root and not path.startswith(os.path.join(root, '')):\n             raise IOError(\"Permission denied: %s\" % name)\n         return path\n \n"}
{"cve":"CVE-2018-18074:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/requests/sessions.py b/requests/sessions.py\nindex dd525e2a..a75b13db 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -242,7 +242,9 @@ class SessionRedirectMixin(object):\n             original_parsed = urlparse(response.request.url)\n             redirect_parsed = urlparse(url)\n \n-            if (original_parsed.hostname != redirect_parsed.hostname):\n+            if (original_parsed.hostname != redirect_parsed.hostname or\n+               (original_parsed.scheme == 'https' and\n+                redirect_parsed.scheme != 'https')):\n                 del headers['Authorization']\n \n         # .netrc might have more auth for us on our new host.\n"}
{"cve":"CVE-2021-3987:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cps/shelf.py b/cps/shelf.py\nindex 2c6a17a2..4e343b4b 100644\n--- a/cps/shelf.py\n+++ b/cps/shelf.py\n@@ -245,6 +245,9 @@ def create_edit_shelf(shelf, page_title, page, shelf_id=False):\n     if request.method == \"POST\":\n         to_save = request.form.to_dict()\n         shelf.is_public = 1 if to_save.get(\"is_public\") else 0\n+        if shelf.is_public and not current_user.role_edit_shelfs():\n+            flash(_(u'Sorry you are not allowed to create public shelfs'), category=\"error\")\n+            return redirect(url_for('web.index'))\n         if config.config_kobo_sync:\n             shelf.kobo_sync = True if to_save.get(\"kobo_sync\") else False\n         shelf_title = to_save.get(\"title\", \"\")\n"}
{"cve":"CVE-2023-40267:0708", "fix_patch": ""}
{"cve":"CVE-2021-23727:0708", "fix_patch": ""}
{"cve":"CVE-2022-24065:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cookiecutter/vcs.py b/cookiecutter/vcs.py\nindex 08cb2eb..c57fbcb 100644\n--- a/cookiecutter/vcs.py\n+++ b/cookiecutter/vcs.py\n@@ -92,17 +92,27 @@ def clone(repo_url, checkout=None, clone_to_dir='.', no_input=False):\n \n     if clone:\n         try:\n-            subprocess.check_output(  # nosec\n-                [repo_type, 'clone', repo_url],\n-                cwd=clone_to_dir,\n-                stderr=subprocess.STDOUT,\n-            )\n-            if checkout is not None:\n+            if repo_type == 'git':\n+                if checkout is not None:\n+                    subprocess.check_output(  # nosec\n+                        ['git', 'clone', repo_url, '-b', checkout, '--', repo_dir],\n+                        stderr=subprocess.STDOUT,\n+                    )\n+                else:\n+                    subprocess.check_output(  # nosec\n+                        ['git', 'clone', repo_url, '--', repo_dir],\n+                        stderr=subprocess.STDOUT,\n+                    )\n+            elif repo_type == 'hg':\n                 subprocess.check_output(  # nosec\n-                    [repo_type, 'checkout', checkout],\n-                    cwd=repo_dir,\n+                    ['hg', 'clone', repo_url, repo_dir],\n                     stderr=subprocess.STDOUT,\n                 )\n+                if checkout is not None:\n+                    subprocess.check_output(  # nosec\n+                        ['hg', '--repository', repo_dir, 'update', '--rev', checkout],\n+                        stderr=subprocess.STDOUT,\n+                    )\n         except subprocess.CalledProcessError as clone_error:\n             output = clone_error.output.decode('utf-8')\n             if 'not found' in output.lower():\n"}
{"cve":"CVE-2023-26145:0708", "fix_patch": ""}
{"cve":"CVE-2020-25459:0708", "fix_patch": ""}
{"cve":"CVE-2022-39286:0708", "fix_patch": ""}
{"cve":"CVE-2019-10856:0708", "fix_patch": ""}
{"cve":"CVE-2020-26215:0708", "fix_patch": ""}
{"cve":"CVE-2021-39163:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/synapse/groups/groups_server.py b/synapse/groups/groups_server.py\nindex 3dc55ab86..9bd7c90b5 100644\n--- a/synapse/groups/groups_server.py\n+++ b/synapse/groups/groups_server.py\n@@ -332,6 +332,13 @@ class GroupsServerWorkerHandler:\n             requester_user_id, group_id\n         )\n \n+        # We don't want to leak rooms in groups to users who are not in the\n+        # group.\n+        if not is_user_in_group:\n+            # We return a static list so that we don't leak whether the group\n+            # exists or not.\n+            return {\"chunk\": [], \"total_room_count_estimate\": 0}\n+\n         room_results = await self.store.get_rooms_in_group(\n             group_id, include_private=is_user_in_group\n         )\n@@ -342,7 +349,12 @@ class GroupsServerWorkerHandler:\n \n             joined_users = await self.store.get_users_in_room(room_id)\n             entry = await self.room_list_handler.generate_room_entry(\n-                room_id, len(joined_users), with_alias=False, allow_private=True\n+                room_id,\n+                len(joined_users),\n+                with_alias=False,\n+                # We can allow private since we've already checked whether the\n+                # user is in the group.\n+                allow_private=True,\n             )\n \n             if not entry:\n"}
{"cve":"CVE-2022-0577:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/scrapy/downloadermiddlewares/redirect.py b/scrapy/downloadermiddlewares/redirect.py\nindex 4053fecc5..94d0858f2 100644\n--- a/scrapy/downloadermiddlewares/redirect.py\n+++ b/scrapy/downloadermiddlewares/redirect.py\n@@ -30,6 +30,13 @@ class BaseRedirectMiddleware:\n         ttl = request.meta.setdefault('redirect_ttl', self.max_redirect_times)\n         redirects = request.meta.get('redirect_times', 0) + 1\n \n+        if urlparse(request.url).netloc != urlparse(redirected.url).netloc:\n+            redirected.headers.pop('Authorization', None)\n+            logger.debug(\n+                \"Redirecting to a different domain, stripping the Authorization header\"\n+                \" from request to %(redirected)s\",\n+                {'redirected': redirected}, extra={'spider': spider})\n+\n         if ttl and redirects <= self.max_redirect_times:\n             redirected.meta['redirect_times'] = redirects\n             redirected.meta['redirect_ttl'] = ttl - 1\n"}
{"cve":"CVE-2021-41125:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/scrapy/downloadermiddlewares/httpauth.py b/scrapy/downloadermiddlewares/httpauth.py\nindex 7aa7a62bc..e6567d1df 100644\n--- a/scrapy/downloadermiddlewares/httpauth.py\n+++ b/scrapy/downloadermiddlewares/httpauth.py\n@@ -4,6 +4,8 @@ HTTP basic auth downloader middleware\n See documentation in docs/topics/downloader-middleware.rst\n \"\"\"\n \n+from six.moves.urllib.parse import urlparse\n+\n from w3lib.http import basic_auth_header\n \n from scrapy import signals\n@@ -13,6 +15,10 @@ class HttpAuthMiddleware(object):\n     \"\"\"Set Basic HTTP Authorization header\n     (http_user and http_pass spider class attributes)\"\"\"\n \n+    def __init__(self):\n+        self.auth = b''\n+        self.auth_domain = None\n+\n     @classmethod\n     def from_crawler(cls, crawler):\n         o = cls()\n@@ -24,8 +30,15 @@ class HttpAuthMiddleware(object):\n         pwd = getattr(spider, 'http_pass', '')\n         if usr or pwd:\n             self.auth = basic_auth_header(usr, pwd)\n+        self.auth_domain = getattr(spider, 'http_auth_domain', None)\n \n     def process_request(self, request, spider):\n-        auth = getattr(self, 'auth', None)\n-        if auth and b'Authorization' not in request.headers:\n-            request.headers[b'Authorization'] = auth\n+        if not self.auth or b'Authorization' in request.headers:\n+            return\n+\n+        if self.auth_domain:\n+            domain = urlparse(request.url).hostname\n+            if domain != self.auth_domain:\n+                return\n+\n+        request.headers[b'Authorization'] = self.auth\n"}
{"cve":"CVE-2021-21360:0708", "fix_patch": "diff --git a/src/Products/GenericSetup/context.py b/src/Products/GenericSetup/context.py\nindex 1c8ba1d..25a8ad4 100644\n--- a/src/Products/GenericSetup/context.py\n+++ b/src/Products/GenericSetup/context.py\n@@ -557,8 +557,12 @@ class SnapshotExportContext(BaseContext):\n         for element in path:\n \n             if element not in current.objectIds():\n+                folder = Folder(element)\n                 # No Unicode IDs!\n-                current._setObject(str(element), Folder(element))\n+                current._setObject(str(element), folder)\n+                # Protect the folder\n+                folder = current._getOb(element)\n+                folder.manage_permission('View', roles=['Manager'], acquire=0)\n \n             current = current._getOb(element)\n \n"}
{"cve":"CVE-2023-32303:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/planet/auth.py b/planet/auth.py\nindex e50f1af..521d793 100644\n--- a/planet/auth.py\n+++ b/planet/auth.py\n@@ -240,7 +240,11 @@ class _SecretFile:\n \n     def _write(self, contents: dict):\n         LOGGER.debug(f'Writing to {self.path}')\n-        with open(self.path, 'w') as fp:\n+        # Create the file with restrictive permissions 0o600\n+        flags = os.O_WRONLY | os.O_CREAT | os.O_TRUNC\n+        mode = 0o600\n+        fd = os.open(self.path, flags, mode)\n+        with os.fdopen(fd, 'w') as fp:\n             fp.write(json.dumps(contents))\n \n     def read(self) -> dict:\n"}
{"cve":"CVE-2022-21712:0708", "fix_patch": ""}
{"cve":"CVE-2022-4724:0708", "fix_patch": ""}
{"cve":"CVE-2023-32309:0708", "fix_patch": ""}
{"cve":"CVE-2024-5823:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/modules/utils.py b/modules/utils.py\nindex f2baefa..10694f5 100644\n--- a/modules/utils.py\n+++ b/modules/utils.py\n@@ -743,6 +743,14 @@ def transfer_input(inputs):\n \n def update_chuanhu():\n     from .repo import background_update\n+    from i18n import i18n\n+\n+    if os.path.exists(\"config.json\"):\n+        return gr.Markdown(\n+            value=i18n(\n+                \"\u68c0\u6d4b\u5230 config.json\uff0c\u4e3a\u9632\u6b62\u66f4\u65b0\u8fc7\u7a0b\u4e2d\u914d\u7f6e\u6587\u4ef6\u88ab\u8986\u76d6\uff0c\u8bf7\u624b\u52a8\u5907\u4efd config.json \u5e76\u5220\u9664\u8be5\u6587\u4ef6\u540e\u518d\u6267\u884c\u66f4\u65b0\u3002\"\n+            )\n+        )\n \n     print(\"[Updater] Trying to update...\")\n     update_status = background_update()\n"}
{"cve":"CVE-2022-36087:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/oauthlib/uri_validate.py b/oauthlib/uri_validate.py\nindex 8a6d9c2..4a5515b 100644\n--- a/oauthlib/uri_validate.py\n+++ b/oauthlib/uri_validate.py\n@@ -66,7 +66,7 @@ IPv4address = r\"%(dec_octet)s \\. %(dec_octet)s \\. %(dec_octet)s \\. %(dec_octet)s\n )\n \n #   IPv6address\n-IPv6address = r\"([A-Fa-f0-9:]+:+)+[A-Fa-f0-9]+\"\n+IPv6address = r\"([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\"\n \n #   IPvFuture     = \"v\" 1*HEXDIG \".\" 1*( unreserved / sub-delims / \":\" )\n IPvFuture = r\"v %(HEXDIG)s+ \\. (?: %(unreserved)s | %(sub_delims)s | : )+\" % locals()\n"}
{"cve":"CVE-2023-29159:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/starlette/staticfiles.py b/starlette/staticfiles.py\nindex 4d075b3..2ef19ef 100644\n--- a/starlette/staticfiles.py\n+++ b/starlette/staticfiles.py\n@@ -163,15 +163,18 @@ class StaticFiles:\n         self, path: str\n     ) -> typing.Tuple[str, typing.Optional[os.stat_result]]:\n         for directory in self.all_directories:\n+            directory = os.path.abspath(os.path.realpath(directory))\n             joined_path = os.path.join(directory, path)\n             if self.follow_symlink:\n                 full_path = os.path.abspath(joined_path)\n             else:\n                 full_path = os.path.realpath(joined_path)\n-            directory = os.path.realpath(directory)\n-            if os.path.commonprefix([full_path, directory]) != directory:\n-                # Don't allow misbehaving clients to break out of the static files\n-                # directory.\n+            try:\n+                if os.path.commonpath([full_path, directory]) != directory:\n+                    # Don't allow misbehaving clients to break out of the static files\n+                    # directory.\n+                    continue\n+            except ValueError:\n                 continue\n             try:\n                 return full_path, os.stat(full_path)\n"}
{"cve":"CVE-2023-41040:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/git/refs/symbolic.py b/git/refs/symbolic.py\nindex 734bf32d..406550e9 100644\n--- a/git/refs/symbolic.py\n+++ b/git/refs/symbolic.py\n@@ -168,12 +168,12 @@ class SymbolicReference(object):\n         \"\"\"Return: (str(sha), str(target_ref_path)) if available, the sha the file at\n         rela_path points to, or None. target_ref_path is the reference we\n         point to, or None\"\"\"\n-        if \"..\" in str(ref_path):\n-            raise ValueError(f\"Invalid reference '{ref_path}'\")\n+        if \"..\" in str(ref_path) or os.path.isabs(str(ref_path)):\n+            raise ValueError(f\"Invalid reference: {ref_path!r}\")\n         tokens: Union[None, List[str], Tuple[str, str]] = None\n         repodir = _git_dir(repo, ref_path)\n         try:\n-            with open(os.path.join(repodir, str(ref_path)), \"rt\", encoding=\"UTF-8\") as fp:\n+            with open(join_path_native(repodir, str(ref_path)), \"rt\", encoding=\"UTF-8\") as fp:\n                 value = fp.read().rstrip()\n             # Don't only split on spaces, but on whitespace, which allows to parse lines like\n             # 60b64ef992065e2600bfef6187a97f92398a9144                branch 'master' of git-server:/path/to/repo\n"}
{"cve":"CVE-2023-39660:0708", "fix_patch": ""}
{"cve":"CVE-2025-27154:0708", "fix_patch": "diff --git a/spotipy/cache_handler.py b/spotipy/cache_handler.py\nindex 936e81b..511503e 100644\n--- a/spotipy/cache_handler.py\n+++ b/spotipy/cache_handler.py\n@@ -92,7 +92,10 @@ class CacheFileHandler(CacheHandler):\n \n     def save_token_to_cache(self, token_info):\n         try:\n-            with open(self.cache_path, \"w\", encoding='utf-8') as f:\n+            fd = os.open(self.cache_path,\n+                        os.O_WRONLY | os.O_CREAT | os.O_TRUNC,\n+                        0o600)\n+            with os.fdopen(fd, \"w\", encoding='utf-8') as f:\n                 f.write(json.dumps(token_info, cls=self.encoder_cls))\n         except OSError:\n             logger.warning(f\"Couldn't write token to cache at: {self.cache_path}\")\n"}
{"cve":"CVE-2020-15278:0708", "fix_patch": ""}
{"cve":"CVE-2024-48911:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/opencanary/config.py b/opencanary/config.py\nindex 4886783..2dabae6 100644\n--- a/opencanary/config.py\n+++ b/opencanary/config.py\n@@ -72,9 +72,6 @@ class Config:\n                 print(\"[-] Failed to open %s for reading (%s)\" % (fname, e))\n             except ValueError as e:\n                 print(\"[-] Failed to decode json from %s (%s)\" % (fname, e))\n-                subprocess.call(\n-                    \"cp -r %s /var/tmp/config-err-$(date +%%s)\" % fname, shell=True\n-                )\n             except Exception as e:\n                 print(\"[-] An error occurred loading %s (%s)\" % (fname, e))\n         if self.__config is None:\ndiff --git a/opencanary/modules/portscan.py b/opencanary/modules/portscan.py\nindex 730ce68..8d62613 100644\n--- a/opencanary/modules/portscan.py\n+++ b/opencanary/modules/portscan.py\n@@ -68,7 +68,11 @@ class SynLogWatcher(FileSystemWatcher):\n \n \n def detectNFTables():\n-    return b\"nf_tables\" in subprocess.check_output([\"iptables\", \"--version\"])\n+    try:\n+        with open(\"/proc/modules\", \"r\") as f:\n+            return \"nf_tables\" in f.read()\n+    except (FileNotFoundError, IOError):\n+        return shutil.which(\"nft\") is not None\n \n \n class CanaryPortscan(CanaryService):\n"}
{"cve":"CVE-2020-28360:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/index.js b/src/index.js\nindex 0dc1033..b23bf1a 100644\n--- a/src/index.js\n+++ b/src/index.js\n@@ -1,9 +1,9 @@\n export default (ip) => (\n-  /^(::f{4}:)?10\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?192\\.168\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?172\\.(1[6-9]|2\\d|30|31)\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?127\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?169\\.254\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n+  /^(::ffff:)?10\\.((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$/i.test(ip) ||\n+  /^(::ffff:)?192\\.168\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$/i.test(ip) ||\n+  /^(::ffff:)?172\\.(1[6-9]|2[0-9]|3[0-1])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$/i.test(ip) ||\n+  /^(::ffff:)?127\\.((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$/i.test(ip) ||\n+  /^(::ffff:)?169\\.254\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])\\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])$/i.test(ip) ||\n   /^f[cd][0-9a-f]{2}:/i.test(ip) ||\n   /^fe80:/i.test(ip) ||\n   /^::1$/.test(ip) ||\n"}
{"cve":"CVE-2017-16100:0708", "fix_patch": ""}
{"cve":"CVE-2021-23384:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 0102e84..bfad94e 100644\n--- a/index.js\n+++ b/index.js\n@@ -38,7 +38,8 @@ function removeTrailingSlashes(opts) {\n         }\n \n         if (path && haveSlash(path)) {\n-            path = path.slice(0, -1);\n+            path = path.slice(0, -1) || '/';\n+            path = path.replace(/^\\/{2,}/, '/');\n             const query = querystring.length ? '?' + querystring : '';\n \n             ctx.status = 301;\ndiff --git a/test/index.js b/test/index.js\nindex 28f1a53..22bcf2d 100644\n--- a/test/index.js\n+++ b/test/index.js\n@@ -16,6 +16,16 @@ describe('koa-remove-trailing-slashes', () => {\n                 .expect('Location', '/foo')\n                 .expect(301, done);\n         });\n+\n+        it('should not allow open redirect', (done) => {\n+            const app = new Koa();\n+            app.use(removeTrailingSlashes());\n+\n+            request(app.listen())\n+                .get('//example.com/')\n+                .expect('Location', '/example.com')\n+                .expect(301, done);\n+        });\n     });\n \n     describe('defer = false', () => {\n"}
{"cve":"CVE-2024-53900:0708", "fix_patch": ""}
{"cve":"CVE-2022-35949:0708", "fix_patch": ""}
{"cve":"CVE-2022-0691:0708", "fix_patch": ""}
{"cve":"CVE-2019-10787:0708", "fix_patch": ""}
{"cve":"CVE-2020-7687:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 2100676..6b72662 100644\n--- a/index.js\n+++ b/index.js\n@@ -13,6 +13,15 @@ module.exports = function (port, root, wordy) {\n         var uri = url.parse(req.url).pathname,\n             filename = path.join(root, uri);\n \n+        filename = path.resolve(filename);\n+\n+        if (filename.indexOf(path.resolve(root)) !== 0) {\n+            if (wordy) console.log('Forbidden path: ' + filename);\n+            res.writeHead(403, {'Content-Type': 'text/plain'});\n+            res.end('403 Forbidden');\n+            return;\n+        }\n+\n         if (uri.charAt(uri.length - 1) === '/') {\n             filename += 'index.html';\n         }\n"}
{"cve":"CVE-2018-16482:0708", "fix_patch": ""}
{"cve":"CVE-2021-23363:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex a827f37..fca6714 100644\n--- a/index.js\n+++ b/index.js\n@@ -3,6 +3,10 @@\n const exec = require('child_process').execSync\n \n exports.killByPort = function (port) {\n+  if (!/^\\d+$/.test(port)) {\n+    return\n+  }\n+\n   var processId = null\n   try {\n     processId = exec(`lsof -t -i:${port}`)\ndiff --git a/test.js b/test.js\nnew file mode 100644\nindex 0000000..e9268d4\n--- /dev/null\n+++ b/test.js\n@@ -0,0 +1,19 @@\n+\n+const { killByPort } = require('./index');\n+const fs = require('fs');\n+\n+const payload = '; touch /tmp/pwned';\n+\n+try {\n+  killByPort(payload);\n+} catch (e) {\n+  // Ignore errors, we just want to see if the command was executed\n+}\n+\n+if (fs.existsSync('/tmp/pwned')) {\n+  console.error('Vulnerability exploited!');\n+  process.exit(1);\n+} else {\n+  console.log('Test passed, vulnerability not exploited.');\n+  process.exit(0);\n+}\n"}
{"cve":"CVE-2019-10788:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex d85f5ff..07aff2f 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,7 +1,8 @@\n /*jshint laxbreak:true */\n \n var sizeParser = require('filesize-parser');\n-var exec = require('child_process').exec, child;\n+var execFile = require('child_process').execFile,\n+    child;\n \n module.exports = function(path, opts, cb) {\n   if (!cb) {\n@@ -9,10 +10,10 @@ module.exports = function(path, opts, cb) {\n     opts = {};\n   }\n \n-  var cmd = module.exports.cmd(path, opts);\n+  var format = module.exports.format(opts);\n   opts.timeout = opts.timeout || 5000;\n \n-  exec(cmd, opts, function(e, stdout, stderr) {\n+  execFile('identify', ['-format', format, path], opts, function(e, stdout, stderr) {\n     if (e) { return cb(e); }\n     if (stderr) { return cb(new Error(stderr)); }\n \n@@ -20,9 +21,9 @@ module.exports = function(path, opts, cb) {\n   });\n };\n \n-module.exports.cmd = function(path, opts) {\n+module.exports.format = function(opts) {\n   opts = opts || {};\n-  var format = [\n+  return [\n     'name=',\n     'size=%[size]',\n     'format=%m',\n@@ -32,8 +33,6 @@ module.exports.cmd = function(path, opts) {\n     'orientation=%[orientation]',\n     (opts.exif ? '%[exif:*]' : '')\n   ].join(\"\\n\");\n-\n-  return 'identify -format \"' + format + '\" ' + path;\n };\n \n module.exports.parse = function(path, stdout, opts) {\n"}
{"cve":"CVE-2020-7675:0708", "fix_patch": ""}
{"cve":"CVE-2019-15597:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex 767584b..11370c5 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -1,4 +1,4 @@\n-var exec = require('child_process').exec\n+var execFile = require('child_process').execFile\n var parse = require('./parse')\n \n module.exports = function df(aOptions, aCallback) {\n@@ -33,12 +33,12 @@ module.exports = function df(aOptions, aCallback) {\n \n     // TODO: should fail if unit is not a string\n \n-    var command = 'df -kP'\n+    var args = ['-kP'];\n     if (options.file) {\n-        command += ' ' + options.file\n+        args.push(options.file);\n     }\n \n-    exec(command, function(err, stdout, stderr) {\n+    execFile('df', args, function(err, stdout, stderr) {\n         if (err) {\n             callback(err)\n             return\n"}
{"cve":"CVE-2020-7627:0708", "fix_patch": ""}
{"cve":"CVE-2020-7631:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/posix.js b/lib/posix.js\nindex 76b4b98..e842251 100644\n--- a/lib/posix.js\n+++ b/lib/posix.js\n@@ -1,14 +1,10 @@\n 'use strict';\n \n-var exec = require('child_process').exec;\n+var execFile = require('child_process').execFile;\n var isDigits = require('./utils').isDigits;\n \n function diskusage(path, cb) {\n-    if (path.indexOf('\"') !== -1) {\n-        return cb(new Error('Paths with double quotes are not supported yet'));\n-    }\n-\n-    exec('df -k \"' + path + '\"', function(err, stdout) {\n+    execFile('df', ['-k', path], function(err, stdout) {\n         if (err) {\n             return cb(err);\n         }\n"}
{"cve":"CVE-2020-7795:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex a207f28..57cf556 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,3 +1,5 @@\n+const path = require('path');\n+\n module.exports = function (packageName, { registry = '', timeout = null } = {}) {\n     try {\n         let version;\n@@ -11,9 +13,13 @@ module.exports = function (packageName, { registry = '', timeout = null } = {})\n         }\n \n         if (registry) {\n-            version = require('child_process').execSync(`npm view ${packageName} version --registry ${registry}`, config);\n+            version = require('child_process').execFileSync(\n+                'npm',\n+                ['view', packageName, 'version', '--registry', registry],\n+                config\n+            );\n         } else {\n-            version = require('child_process').execSync(`npm view ${packageName} version`, config);\n+            version = require('child_process').execFileSync('npm', ['view', packageName, 'version'], config);\n         }\n \n         if (version) {\n"}
{"cve":"CVE-2018-3772:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 88a62e9..77951ba 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,31 +1,10 @@\n-var cp = require('child_process');\n+var which = require('which');\n \n module.exports = function whereis(name, cb) {\n-  cp.exec('which ' + name, function(error, stdout, stderr) {\n-    stdout = stdout.split('\\n')[0];\n-    if (error || stderr || stdout === '' || stdout.charAt(0) !== '/') {\n-      stdout = stdout.split('\\n')[0];\n-      cp.exec('whereis ' + name, function(error, stdout, stderr) {\n-        if (error || stderr || stdout === '' || stdout.indexOf( '/' ) === -1) {\n-          cp.exec('where ' + name, function (error, stdout, stderr) { //windows\n-            if (error || stderr || stdout === '' || stdout.indexOf('\\\\') === -1) {\n-              cp.exec('for %i in (' + name + '.exe) do @echo. %~$PATH:i', function (error, stdout, stderr) { //windows xp\n-                if (error || stderr || stdout === '' || stdout.indexOf('\\\\') === -1) {\n-                  return cb(new Error('Could not find ' + name + ' on your system'));\n-                }\n-                return cb(null, stdout);\n-              });\n-            } else {\n-              return cb(null, stdout);\n-            }\n-          });\n-        }\n-        else {\n-          return cb(null, stdout.split(' ')[1]);\n-        }\n-      });\n-    } else {\n-      return cb(null, stdout);\n+  which(name, function (err, path) {\n+    if (err) {\n+      return cb(new Error('Could not find ' + name + ' on your system'));\n     }\n+    cb(null, path);\n   });\n };\ndiff --git a/package.json b/package.json\nindex 92ad9a5..0390cae 100644\n--- a/package.json\n+++ b/package.json\n@@ -13,6 +13,9 @@\n   ],\n   \"license\": \"MIT\",\n   \"repository\": \"git://github.com/vvo/node-whereis.git\",\n+  \"dependencies\": {\n+    \"which\": \"^2.0.2\"\n+  },\n   \"devDependencies\": {\n     \"tap\": \"0.6.0\"\n   },\ndiff --git a/test.js b/test.js\nindex 3ae6172..f2b97a2 100644\n--- a/test.js\n+++ b/test.js\n@@ -1,60 +1,18 @@\n-var\n-  cp = require('child_process'),\n-  test = require('tap').test,\n-  whereis = require('./');\n+var test = require('tap').test,\n+    whereis = require('./');\n \n-test(\"when which found our program\", function(t) {\n-  cp.exec = function(name, cb) {\n-    cb(null, '/etc/bin');\n-  };\n-\n-  whereis('bin', function(err, path) {\n-    t.equal(path, '/etc/bin', 'bin was found');\n-    t.end();\n-  });\n-});\n-\n-test(\"when which did not found, whereis found it\", function(t) {\n-  var callcount = 0;\n-  cp.exec = function(name, cb) {\n-    if (callcount === 0) {\n-      callcount++;\n-      cb(null, 'not found bin');\n-    } else {\n-      cb(null, 'bin: /etc/bin');\n-    }\n-  };\n-\n-  whereis('bin', function(err, path) {\n-    t.equal(path, '/etc/bin', 'bin was found');\n-    t.end();\n-  });\n-});\n-\n-test(\"when which did not found, whereis did not found, where will find\", function(t) {\n-  var callcount = 0;\n-  cp.exec = function(name, cb) {\n-    if (callcount < 2) {\n-      callcount++;\n-      cb(null, 'not found bin');\n-    } else {\n-      cb(null, 'C:\\\\etc\\\\bin');\n-    }\n-  };\n-\n-  whereis('bin', function(err, path) {\n-    t.equal(path, 'C:\\\\etc\\\\bin', 'bin was found');\n+test(\"find node\", function(t) {\n+  whereis('node', function(err, path) {\n+    t.error(err, 'node should be found');\n+    t.ok(path, 'path should be returned');\n     t.end();\n   });\n });\n \n-test(\"when which found it and output has linebreak\", function(t) {\n-  cp.exec = function(name, cb) {\n-    cb(null, '/etc/bin\\n');\n-  };\n-\n-  whereis('bin', function(err, path) {\n-    t.equal(path, '/etc/bin', 'bin was found');\n-    t.end();\n+test(\"not found\", function(t) {\n+    whereis('adgadgadgadg', function(err, path) {\n+      t.ok(err, 'should return an error');\n+      t.notOk(path, 'path should be empty');\n+      t.end();\n+    });\n   });\n-});\n"}
{"cve":"CVE-2020-7640:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/class.js b/class.js\nindex 28476eb..ed79873 100644\n--- a/class.js\n+++ b/class.js\n@@ -20,10 +20,9 @@ exports.create = function create(members) {\n \t\t}\n \t\telse {\n \t\t\t// inherit parent's constructor\n-\t\t\tvar code = members.__parent.toString();\n-\t\t\tvar args = code.substring( code.indexOf(\"(\")+1, code.indexOf(\")\") );\n-\t\t\tvar inner_code = code.substring( code.indexOf(\"{\")+1, code.lastIndexOf(\"}\") );\n-\t\t\teval('constructor = function ('+args+') {'+inner_code+'};');\n+\t\t\tconstructor = function() {\n+\t\t\t\tmembers.__parent.apply(this, arguments);\n+\t\t\t};\n \t\t}\n \t\t\n \t\t// inherit rest of parent members\n"}
{"cve":"CVE-2017-16198:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex cad0b67..174c3db 100644\n--- a/index.js\n+++ b/index.js\n@@ -38,7 +38,14 @@ var main = function(req, res) {\n         }\n \n         //\u4f7f\u7528\u8def\u5f84\u89e3\u6790\u6a21\u5757,\u7ec4\u88c5\u5b9e\u9645\u6587\u4ef6\u8def\u5f84 \n-        var filePath = path.join(argvs.getPath(), pathName);\n+        var root = path.resolve(argvs.getPath());\n+        var filePath = path.resolve(path.join(root, pathName));\n+\n+        if (filePath.indexOf(root) !== 0) {\n+            res.writeHead(403, {\"Content-Type\": \"text/html\"});\n+            res.end('<h1>403 Forbidden</h1>');\n+            return;\n+        }\n \n         //\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728 \n         fs.exists(filePath, function(exists) {\n"}
{"cve":"CVE-2020-7674:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/encode.js b/lib/encode.js\nindex 6756d1e..012399a 100644\n--- a/lib/encode.js\n+++ b/lib/encode.js\n@@ -1,11 +1,43 @@\n 'use strict';\n \n-function template(literal, data) {\n-  var tmpl = literal.replace(/(\\$\\{)/gm, '$1data.');\n+function get(obj, path) {\n+  return path.split('.').reduce(function (prev, curr) {\n+    return prev ? prev[curr] : undefined;\n+  }, obj);\n+}\n \n-  return eval('`' + tmpl + '`');\n+function tpl(str, data) {\n+  return str.replace(/\\$\\{([^}]+)\\}/g, function (match, path) {\n+    var value = get(data, path);\n+    return value === undefined ? match : value;\n+  });\n }\n \n+function walk(item, data) {\n+    if (typeof item === 'string') {\n+        return tpl(item, data);\n+    }\n+\n+    if (Array.isArray(item)) {\n+        return item.map(function(element) {\n+            return walk(element, data);\n+        });\n+    }\n+\n+    if (item !== null && typeof item === 'object') {\n+        var newItem = {};\n+        for (var key in item) {\n+            if (Object.prototype.hasOwnProperty.call(item, key)) {\n+                newItem[key] = walk(item[key], data);\n+            }\n+        }\n+        return newItem;\n+    }\n+\n+    return item;\n+}\n+\n+\n function encodeStatements(statements, data) {\n   if (!statements) {\n     throw new SyntaxError('Must include statements to encode');\n@@ -15,8 +47,7 @@ function encodeStatements(statements, data) {\n     return statements;\n   }\n \n-  var output = template(JSON.stringify(statements), data);\n-  output = JSON.parse(output);\n+  var output = walk(statements, data);\n \n   Object.defineProperty(output, 'encoded', {\n     __proto__: null,\n"}
{"cve":"CVE-2021-23376:0708", "fix_patch": ""}
{"cve":"CVE-2020-28494:0708", "fix_patch": ""}
{"cve":"CVE-2020-7613:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 7cdbddf..6a1f613 100755\n--- a/index.js\n+++ b/index.js\n@@ -484,15 +484,10 @@ class NodeClam {\n             return false;\n         }\n \n-        const version_cmds = {\n-            clamdscan: `${path} --version`,\n-            clamscan: `${path} --version`,\n-        };\n-\n         try {\n             await fs_access(path, fs.constants.R_OK);\n \n-            const {stdout} = await cp_exec(version_cmds[scanner]);\n+            const {stdout} = await cp_execfile(path, ['--version']);\n             if (stdout.toString().match(/ClamAV/) === null) {\n                 if (this.settings.debug_mode) console.log(`${this.debug_label}: Could not verify the ${scanner} binary.`);\n                 return false;\n"}
{"cve":"CVE-2020-28437:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/get.js b/lib/get.js\nindex 25abee9..1ff3856 100644\n--- a/lib/get.js\n+++ b/lib/get.js\n@@ -1,6 +1,6 @@\n-var exec = require('child_process').exec\n+var execFile = require('child_process').execFile\n module.exports = function(app, cb) {\n-  exec('heroku config --app ' + app, function(err, stdout) {\n+  execFile('heroku', ['config', '--app', app], function(err, stdout) {\n     if(err) return cb(err);\n     var config = {}\n     var lines = stdout.split('\\n')\n"}
{"cve":"CVE-2017-16083:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/router.js b/lib/router.js\nindex be232b9..fae5894 100644\n--- a/lib/router.js\n+++ b/lib/router.js\n@@ -730,7 +730,10 @@\n     };\n     dispatch[\"static\"] = function(pathname, req, res) {\n       var full_path;\n-      full_path = \"\" + dispatch.static_route + (unescape(pathname));\n+      full_path = path_tools.normalize(path_tools.join(dispatch.static_route, unescape(pathname)));\n+      if (full_path.indexOf(dispatch.static_route) !== 0) {\n+        return dispatch._404(null, res, pathname);\n+      }\n       return fs.exists(full_path, function(exists) {\n         var e, error;\n         if (exists) {\n"}
{"cve":"CVE-2016-10548:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 74ea51b..01e63a9 100755\n--- a/index.js\n+++ b/index.js\n@@ -69,10 +69,14 @@ function reduceCSSCalc(value, decimalPrecision) {\n \n     // Remove units in expression:\n     var toEvaluate = expression.replace(new RegExp(unit, \"gi\"), \"\")\n-    var result\n+    // It's not safe to use 'eval' here, so we are checking the string.\n+    if (/[^\\s\\d\\.\\+\\-\\*\\/\\(\\)]/.test(toEvaluate)) {\n+      return functionIdentifier + \"(\" + expression + \")\"\n+    }\n \n+    var result\n     try {\n-      result = eval(toEvaluate)\n+      result = (new Function(\"return \" + toEvaluate))()\n     }\n     catch (e) {\n       return functionIdentifier + \"(\" + expression + \")\"\n"}
{"cve":"CVE-2018-3733:0708", "fix_patch": "diff --git a/crud-file-server.js b/crud-file-server.js\nindex e598241..829daad 100644\n--- a/crud-file-server.js\n+++ b/crud-file-server.js\n@@ -3,7 +3,7 @@ var fs = require('fs');\n // don't let users crawl up the folder structure by using a/../../../c/d\n var cleanUrl = function(url) { \n \turl = decodeURIComponent(url);\n-\twhile(url.indexOf('..').length > 0) { url = url.replace('..', ''); }\n+\twhile(url.indexOf('..') > -1) { url = url.replace('..', ''); }\n \treturn url;\n };\n \n"}
{"cve":"CVE-2020-7781:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 614a6d6..b77708b 100644\n--- a/index.js\n+++ b/index.js\n@@ -10,9 +10,7 @@ let SOCKET_TIMEOUT = 1000;   //Setting 1s as max acceptable timeout\n function testSync(host, port, connectTimeout) {\n     const nodeBinary = process.execPath;\n     const scriptPath = path.join(__dirname, \"./scripts/connection-tester\");\n-    const cmd = util.format('\"%s\" \"%s\" %s %s %s', nodeBinary, scriptPath, host, port, connectTimeout);\n-\n-    const shellOut = shell.execSync(cmd).toString();\n+    const shellOut = shell.execFileSync(nodeBinary, [scriptPath, host, port, connectTimeout]).toString();\n \n     const output = {\n         success: false,\n"}
{"cve":"CVE-2020-15084:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex f5da77f..40becc5 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -21,6 +21,10 @@ module.exports = function(options) {\n \n   var secretCallback = options.secret;\n \n+  if (isFunction(secretCallback) && !options.algorithms) {\n+    throw new Error('Algorithms must be specified when secret is a function');\n+  }\n+\n   if (!isFunction(secretCallback)){\n     secretCallback = wrapStaticSecretInCallback(secretCallback);\n   }\n"}
{"cve":"CVE-2022-2421:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/binary.js b/binary.js\nindex 3e2347d..49f7964 100644\n--- a/binary.js\n+++ b/binary.js\n@@ -71,6 +71,9 @@ function _reconstructPacket(data, buffers) {\n   if (!data) return data;\n \n   if (data && data._placeholder) {\n+    if (typeof data.num !== 'number' || data.num < 0 || data.num >= buffers.length) {\n+      return data;\n+    }\n     return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n   } else if (isArray(data)) {\n     for (var i = 0; i < data.length; i++) {\n"}
{"cve":"CVE-2022-29822:0708", "fix_patch": ""}
{"cve":"CVE-2023-28155:0708", "fix_patch": ""}
{"cve":"CVE-2022-2900:0708", "fix_patch": ""}
{"cve":"CVE-2018-3778:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/client.js b/lib/client.js\nindex 644589d..4e0583f 100644\n--- a/lib/client.js\n+++ b/lib/client.js\n@@ -242,15 +242,23 @@ Client.prototype.close = function (done) {\n \n   function finish () {\n     if (!that.disconnected && that.will) {\n-      that.broker.publish(that.will, that, function (err) {\n-        if (!err) {\n-          that.broker.persistence.delWill({\n-            id: that.id,\n-            brokerId: that.broker.id\n-          }, nop)\n+      var will = that.will\n+      that.will = null // we need to clear it now to avoid double send\n+      that.broker.authorizePublish(that, will, function (err, authorized) {\n+        if (err) { return } // aedes-logging will log it\n+        if (authorized === false) {\n+          that.broker.emit('clientError', that, new Error('unauthorized will topic'))\n+        } else {\n+          that.broker.publish(will, that, function (err) {\n+            if (!err) {\n+              that.broker.persistence.delWill({\n+                id: that.id,\n+                brokerId: that.broker.id\n+              }, nop)\n+            }\n+          })\n         }\n       })\n-      that.will = null // this function might be called twice\n     }\n \n     conn.removeAllListeners('error')\n"}
{"cve":"CVE-2022-0686:0708", "fix_patch": ""}
{"cve":"CVE-2024-30260:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/handler/redirect-handler.js b/lib/handler/redirect-handler.js\nindex 368ef520..1531f5ae 100644\n--- a/lib/handler/redirect-handler.js\n+++ b/lib/handler/redirect-handler.js\n@@ -198,13 +198,21 @@ function shouldRemoveHeader (header, removeContent, unknownOrigin) {\n   if (header.length === 4) {\n     return util.headerNameToString(header) === 'host'\n   }\n+\n   if (removeContent && util.headerNameToString(header).startsWith('content-')) {\n     return true\n   }\n-  if (unknownOrigin && (header.length === 13 || header.length === 6)) {\n+\n+  if (unknownOrigin) {\n     const name = util.headerNameToString(header)\n-    return name === 'authorization' || name === 'cookie'\n+    switch (name) {\n+      case 'authorization':\n+      case 'proxy-authorization':\n+      case 'cookie':\n+        return true\n+    }\n   }\n+\n   return false\n }\n \n"}
{"cve":"CVE-2025-23221:0708", "fix_patch": ""}
{"cve":"CVE-2022-0512:0708", "fix_patch": ""}
{"cve":"CVE-2022-0639:0708", "fix_patch": ""}
{"cve":"CVE-2021-23387:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex e7ea1ab..51cfe83 100644\n--- a/index.js\n+++ b/index.js\n@@ -19,7 +19,7 @@ function createTrailing (_options, _next) {\n     var length = url.pathname.length\n     var hasSlash = url.pathname.charAt(length - 1) === '/'\n \n-    if (hasSlash === slash) {\n+    if (url.host || hasSlash === slash) {\n       if (middleware) {\n         return done()\n       }\n"}
{"cve":"CVE-2018-3734:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 5fcd266..f3bb697 100644\n--- a/index.js\n+++ b/index.js\n@@ -56,6 +56,12 @@ module.exports.listen = function (port, cb) {\n             localPath = path.join(localPath, \"./\" + path.basename(options.index));\n         }\n \n+        // prevent path traversal\n+        let relative = path.relative(options.folder, localPath);\n+        if (relative.startsWith('..') || path.isAbsolute(relative)) {\n+            return errorPage(res, 403, \"Forbidden.\");\n+        }\n+\n         //Reponse finish event\n         res.on(\"finish\", function () {\n             console.log(\"\" + res.statusCode + \"  \" + pathname + \"  \" + (Date.now() - timeStart) + \" ms\");\n"}
{"cve":"CVE-2020-8132:0708", "fix_patch": "diff --git a/index.js b/index.js\nindex 4fa6231..19b1214 100644\n--- a/index.js\n+++ b/index.js\n@@ -6,6 +6,7 @@ var path = require(\"path\");\n var fs   = require(\"fs\");\n var util = require(\"util\");\n var exec = require(\"child_process\").exec;\n+var execFile = require(\"child_process\").execFile;\n \n function PDFImage(pdfFilePath, options) {\n   if (!options) options = {};\n@@ -22,12 +23,6 @@ function PDFImage(pdfFilePath, options) {\n }\n \n PDFImage.prototype = {\n-  constructGetInfoCommand: function () {\n-    return util.format(\n-      \"pdfinfo \\\"%s\\\"\",\n-      this.pdfFilePath\n-    );\n-  },\n   parseGetInfoCommandOutput: function (output) {\n     var info = {};\n     output.split(\"\\n\").forEach(function (line) {\n"}
{"cve":"CVE-2018-3785:0708", "fix_patch": "diff --git a/index.js b/index.js\nindex 38d70b1..7418788 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,40 +1,51 @@\n-'use strict';\n-var shell = require('shelljs');\n+const {execFileSync} = require('node:child_process');\n+const process = require('node:process');\n \n-var defaultMsg = 'Test commit';\n+const defaultMessage = 'Test commit';\n \n-function makeDefault(str) {\n-\tif ((typeof str === 'string' && !str.trim()) || str === undefined) {\n-\t\treturn defaultMsg;\n+function makeDefault(string_) {\n+\tif ((typeof string_ === 'string' && !string_.trim()) || string_ === undefined) {\n+\t\treturn defaultMessage;\n \t}\n \n-\treturn str;\n+\treturn string_;\n }\n \n-module.exports = function (msg, silent) {\n-\tvar arg = '';\n-\n-\tmsg = makeDefault(msg);\n+module.exports = function (message, silent) {\n+\tconst args = ['commit'];\n \n \tif (silent === undefined) {\n \t\tsilent = true;\n \t}\n \n-\tif (Array.isArray(msg)) {\n-\t\tif (msg.length) {\n-\t\t\tmsg.forEach(function (m) {\n-\t\t\t\tm = makeDefault(m);\n-\n-\t\t\t\targ += '-m\"' + m + '\" ';\n-\t\t\t});\n+\tif (Array.isArray(message)) {\n+\t\tif (message.length > 0) {\n+\t\t\tfor (const m of message) {\n+\t\t\t\targs.push('-m', makeDefault(m));\n+\t\t\t}\n \t\t} else {\n-\t\t\targ = '-m\"' + defaultMsg + '\"';\n+\t\t\targs.push('-m', defaultMessage);\n \t\t}\n \t} else {\n-\t\targ = '-m\"' + msg + '\"';\n+\t\targs.push('-m', makeDefault(message));\n \t}\n \n-\tshell.exec('git commit ' + arg + ' --allow-empty --no-gpg-sign', {\n-\t\tsilent: silent\n-\t});\n+\targs.push('--allow-empty', '--no-gpg-sign');\n+\n+\ttry {\n+\t\tconst output = execFileSync('git', args, {encoding: 'utf8', stdio: 'pipe'});\n+\t\tif (!silent && output && typeof output === 'string') {\n+\t\t\tprocess.stdout.write(output);\n+\t\t}\n+\t} catch (error) {\n+\t\tif (!silent) {\n+\t\t\tif (error.stderr) {\n+\t\t\t\tprocess.stderr.write(error.stderr);\n+\t\t\t}\n+\n+\t\t\tif (error.stdout) {\n+\t\t\t\tprocess.stdout.write(error.stdout);\n+\t\t\t}\n+\t\t}\n+\t}\n };\n"}
{"cve":"CVE-2017-16042:0708", "fix_patch": ""}
{"cve":"CVE-2022-24794:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/context.js b/lib/context.js\nindex c95e363..146a87b 100644\n--- a/lib/context.js\n+++ b/lib/context.js\n@@ -191,6 +191,13 @@ class ResponseContext {\n       debug('req.oidc.login() without returnTo, using: %s', returnTo);\n     }\n \n+    // It's not a valid returnTo url if it has a protocol or host.\n+    // See https://github.com/auth0/express-openid-connect/issues/242\n+    if (url.parse(returnTo).host) {\n+      debug('returnTo has a host, falling back to baseURL. returnTo: %s', returnTo);\n+      returnTo = config.baseURL;\n+    }\n+\n     options = {\n       authorizationParams: {},\n       returnTo,\n"}
{"cve":"CVE-2022-0436:0708", "fix_patch": "diff --git a/lib/grunt/file.js b/lib/grunt/file.js\nindex 7e0e2fb..3ad3116 100644\n--- a/lib/grunt/file.js\n+++ b/lib/grunt/file.js\n@@ -333,6 +333,10 @@ file._copy = function(srcpath, destpath, options) {\n   if (contents === false) {\n     grunt.verbose.writeln('Write aborted.');\n   } else {\n+    if (!options.force && file.isPathInCwd(destpath) === false) {\n+      grunt.fail.warn('Cannot write files outside of the current working directory.');\n+      return false;\n+    }\n     file.write(destpath, contents, readWriteOptions);\n   }\n };\n"}
{"cve":"CVE-2021-32803:0708", "fix_patch": ""}
{"cve":"CVE-2022-0235:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/index.js b/src/index.js\nindex 7175467..b0a8190 100644\n--- a/src/index.js\n+++ b/src/index.js\n@@ -188,6 +188,14 @@ export default async function fetch(url, options_) {\n \t\t\t\t\t\t\treferrerPolicy: request.referrerPolicy\n \t\t\t\t\t\t};\n \n+\t\t\t\t\t\t// HTTP-redirect fetch step 7\n+\t\t\t\t\t\tif (new URL(request.url).origin !== locationURL.origin) {\n+\t\t\t\t\t\t\trequestOptions.headers.delete('authorization');\n+\t\t\t\t\t\t\trequestOptions.headers.delete('www-authenticate');\n+\t\t\t\t\t\t\trequestOptions.headers.delete('cookie');\n+\t\t\t\t\t\t\trequestOptions.headers.delete('cookie2');\n+\t\t\t\t\t\t}\n+\n \t\t\t\t\t\t// HTTP-redirect fetch step 9\n \t\t\t\t\t\tif (response_.statusCode !== 303 && request.body && options_.body instanceof Stream.Readable) {\n \t\t\t\t\t\t\treject(new FetchError('Cannot follow redirect with body being a readable stream', 'unsupported-redirect'));\n"}
{"cve":"CVE-2024-29041:0708", "fix_patch": ""}
{"cve":"CVE-2021-3664:0708", "fix_patch": ""}
{"cve":"CVE-2022-0155:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 6f0c238..27eea2f 100644\n--- a/index.js\n+++ b/index.js\n@@ -392,9 +392,10 @@ RedirectableRequest.prototype._processResponse = function (response) {\n     var redirectUrlParts = url.parse(redirectUrl);\n     Object.assign(this._options, redirectUrlParts);\n \n-    // Drop the Authorization header if redirecting to another domain\n-    if (!(redirectUrlParts.host === currentHost || isSubdomainOf(redirectUrlParts.host, currentHost))) {\n+    // Drop the Authorization and Cookie headers if redirecting to a different host\n+    if (redirectUrlParts.host !== currentHost) {\n       removeMatchingHeaders(/^authorization$/i, this._options.headers);\n+      removeMatchingHeaders(/^cookie$/i, this._options.headers);\n     }\n \n     // Evaluate the beforeRedirect callback\n"}
{"cve":"CVE-2021-46561:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/controller/org.controller/org.controller.js b/src/controller/org.controller/org.controller.js\nindex 0673f06b..d857f400 100644\n--- a/src/controller/org.controller/org.controller.js\n+++ b/src/controller/org.controller/org.controller.js\n@@ -531,6 +531,12 @@ async function updateUser (req, res, next) {\n       }\n     })\n \n+    // Org admins cannot move users to other orgs, only secretariat can.\n+    if (newOrgShortName && newOrgShortName !== shortName && !isSecretariat) {\n+      logger.info({ uuid: req.ctx.uuid, message: 'The user could not be updated because only Secretariat can transfer a user to another organization.' })\n+      return res.status(403).json(error.notOrgAdminOrSecretariat())\n+    }\n+\n     // updating user's roles and org_uuid is only allowed for secretariats and org admins\n     if (changesRequirePrivilegedRole && !(isAdmin || isSecretariat)) {\n       logger.info({ uuid: req.ctx.uuid, message: 'The user could not be updated because ' + requesterUsername + ' user is not Org Admin or Secretariat to modify these fields.' })\n"}
{"cve":"CVE-2022-0722:0708", "fix_patch": ""}
{"cve":"CVE-2020-7649:0708", "fix_patch": ""}
{"cve":"CVE-2020-26299:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/fs.js b/src/fs.js\nindex 3226d2e..110d61c 100644\n--- a/src/fs.js\n+++ b/src/fs.js\n@@ -10,7 +10,7 @@ class FileSystem {\n   constructor(connection, {root, cwd} = {}) {\n     this.connection = connection;\n     this.cwd = nodePath.normalize(cwd ? nodePath.join(nodePath.sep, cwd) : nodePath.sep);\n-    this._root = nodePath.resolve(root || process.cwd());\n+    this._root = nodePath.resolve((root || process.cwd()).replace(/\\\\/g, '/'));\n   }\n \n   get root() {\n@@ -19,18 +19,22 @@ class FileSystem {\n \n   _resolvePath(path = '.') {\n     const clientPath = (() => {\n-      path = nodePath.normalize(path);\n-      if (nodePath.isAbsolute(path)) {\n-        return nodePath.join(path);\n+      const newPath = nodePath.normalize(path.toString().replace(/\\\\/g, '/'));\n+      if (nodePath.isAbsolute(newPath)) {\n+        return newPath;\n       } else {\n-        return nodePath.join(this.cwd, path);\n+        return nodePath.join(this.cwd, newPath);\n       }\n     })();\n \n-    const fsPath = (() => {\n-      const resolvedPath = nodePath.join(this.root, clientPath);\n-      return nodePath.resolve(nodePath.normalize(nodePath.join(resolvedPath)));\n-    })();\n+    const fsPath = nodePath.join(this.root, clientPath);\n+\n+    if (fsPath.indexOf(this.root) !== 0) {\n+      return {\n+        clientPath: this.cwd,\n+        fsPath: this.root\n+      };\n+    }\n \n     return {\n       clientPath,\n"}
{"cve":"CVE-2021-37712:0708", "fix_patch": ""}
{"cve":"CVE-2021-37713:0708", "fix_patch": ""}
{"cve":"CVE-2021-32804:0708", "fix_patch": ""}
{"cve":"CVE-2017-16025:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/socket.js b/lib/socket.js\nindex 261156e..b476ba4 100755\n--- a/lib/socket.js\n+++ b/lib/socket.js\n@@ -537,13 +537,18 @@ internals.Socket.prototype._authenticate = function () {\n         return;\n     }\n \n-    this._listener._connection.states.parse(cookies, (ignoreErr, state, failed) => {\n+    // Prevent crashes when an invalid cookie header is passed\n \n-        const auth = state[config.cookie];\n-        if (auth) {\n-            this.auth._error = this._setCredentials(auth.credentials, auth.artifacts);\n-        }\n-    });\n+    try {\n+        this._listener._connection.states.parse(cookies, (ignoreErr, state, failed) => {\n+\n+            const auth = state[config.cookie];\n+            if (auth) {\n+                this.auth._error = this._setCredentials(auth.credentials, auth.artifacts);\n+            }\n+        });\n+    }\n+    catch (err) { }\n };\n \n \n"}
{"cve":"CVE-2021-41246:0708", "fix_patch": ""}
{"cve":"CVE-2015-3295:0708", "fix_patch": "diff --git a/lib/index.js b/lib/index.js\nindex abc1525..8743ba4 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -21,7 +21,7 @@ var config = {\n };\n \n \n-var BAD_PROTOCOLS    = [ 'vbscript', 'javascript', 'file' ];\n+var BAD_PROTOCOLS    = [ 'vbscript', 'javascript', 'file', 'data' ];\n \n function validateLink(url) {\n   // url should be normalized at this point, and existing entities are decoded\n"}
