{"cve":"CVE-2021-21384:0708", "fix_patch": "diff --git a/src/unix.js b/src/unix.js\nindex 89fc3bd..8dd3e4a 100644\n--- a/src/unix.js\n+++ b/src/unix.js\n@@ -11,7 +11,7 @@\n  * @returns {string} The escaped argument.\n  */\n function escapeShellArg(arg) {\n-  return arg.replace(/'/g, `'\\\\''`);\n+  return `'${arg.replace(/'/g, `'\\\\''`)}'`;\n }\n \n module.exports.escapeShellArg = escapeShellArg;\n"}
{"cve":"CVE-2018-20834:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/parse.js b/lib/parse.js\nindex e8d007b..220d164 100644\n--- a/lib/parse.js\n+++ b/lib/parse.js\n@@ -258,7 +258,7 @@ Parse.prototype._startEntry = function (c) {\n   this._entry = entry\n \n   if (entry.type === \"Link\") {\n-    this._hardLinks[entry.path] = entry\n+    this._hardLinks[entry.linkpath] = entry\n   }\n \n   var me = this\n"}
{"cve":"CVE-2021-33420:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex b180286..69c280b 100644\n--- a/index.js\n+++ b/index.js\n@@ -428,7 +428,8 @@ var builtInTransforms = [\n         },\n \n         fromSerializable: function (val) {\n-            return typeof GLOBAL[val.ctorName] === 'function' ? new GLOBAL[val.ctorName](val.arr) : val.arr;\n+            if (!TYPED_ARRAY_CTORS.includes(val.ctorName)) throw new Error('Invalid TypedArray constructor: ' + val.ctorName);\n+            return new GLOBAL[val.ctorName](val.arr);\n         }\n     },\n \n"}
{"cve":"CVE-2020-7764:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 6941dc9..cd4e06c 100644\n--- a/index.js\n+++ b/index.js\n@@ -51,7 +51,7 @@ function Router (opts) {\n   this.ignoreTrailingSlash = opts.ignoreTrailingSlash || false\n   this.maxParamLength = opts.maxParamLength || 100\n   this.allowUnsafeRegex = opts.allowUnsafeRegex || false\n-  this.versioning = opts.versioning || acceptVersionStrategy\n+  this.versioning = opts.versioning || null\n   this.trees = {}\n   this.routes = []\n }\n@@ -358,7 +358,8 @@ Router.prototype.off = function off (method, path) {\n }\n \n Router.prototype.lookup = function lookup (req, res, ctx) {\n-  var handle = this.find(req.method, sanitizeUrl(req.url), this.versioning.deriveVersion(req, ctx))\n+  var version = this.versioning ? this.versioning.deriveVersion(req, ctx) : undefined;\n+  var handle = this.find(req.method, sanitizeUrl(req.url), version)\n   if (handle === null) return this._defaultRoute(req, res, ctx)\n   return ctx === undefined\n     ? handle.handler(req, res, handle.params, handle.store)\n"}
{"cve":"CVE-2017-1001004:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/typed-function.js b/typed-function.js\nindex 9b84eea..4e553a2 100644\n--- a/typed-function.js\n+++ b/typed-function.js\n@@ -1098,8 +1098,9 @@\n       // generate code for the typed function\n       var code = [];\n       var _name = name || '';\n+      var sanitizedName = _name.replace(/[^a-zA-Z0-9_$]/g, '_');\n       var _args = getArgs(maxParams(_signatures));\n-      code.push('function ' + _name + '(' + _args.join(', ') + ') {');\n+      code.push('function ' + sanitizedName + '(' + _args.join(', ') + ') {');\n       code.push('  \"use strict\";');\n       code.push('  var name = \\'' + _name + '\\';');\n       code.push(node.toCode(refs, '  ', false));\n"}
{"cve":"CVE-2017-1000189:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/ejs.js b/lib/ejs.js\nindex 98e5991c..50bae485 100644\n--- a/lib/ejs.js\n+++ b/lib/ejs.js\n@@ -273,7 +273,7 @@ function cpOptsInData(data, opts) {\n       // include directory to be reset, opening up the possibility of\n       // remote code execution\n       if (p == 'root') {\n-        return;\n+        continue;\n       }\n       opts[p] = data[p];\n     }\n"}
{"cve":"CVE-2017-1001003:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/expression/node/ObjectNode.js b/lib/expression/node/ObjectNode.js\nindex 22681adae..e7199d36a 100644\n--- a/lib/expression/node/ObjectNode.js\n+++ b/lib/expression/node/ObjectNode.js\n@@ -60,7 +60,7 @@ function factory (type, config, load, typed) {\n     var entries = [];\n     for (var key in node.properties) {\n       if (hasOwnProperty(node.properties, key)) {\n-        if (!isSafeProperty(node.properties, key)) {\n+        if (!isSafeProperty(node.properties, key) || !/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(key)) {\n           throw new Error('No access to property \"' + key + '\"');\n         }\n \n"}
{"cve":"CVE-2016-1000232:0708", "fix_patch": ""}
{"cve":"CVE-2021-21321:0708", "fix_patch": ""}
{"cve":"CVE-2020-17479:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex c710e6a..148753c 100644\n--- a/index.js\n+++ b/index.js\n@@ -270,7 +270,19 @@ const compare = (value, pattern, options) => {\n \n     // pattern = object\n     if (typeof pattern === 'object') {\n-        if (value !== null) {\n+        if (value !== null && pattern !== null && value.constructor === Array && pattern.constructor === Array) {\n+            // Validate array elements against pattern's first element\n+            if (pattern.length === 0) {\n+                return res(value.length === 0);\n+            }\n+            const elementPattern = pattern[0];\n+            for (let i = 0; i < value.length; i++) {\n+                if (!compare(value[i], elementPattern, options)) {\n+                    return res(false);\n+                }\n+            }\n+            return res(true);\n+        } else if (value !== null) {\n             return res(value.constructor === pattern.constructor);\n         }\n         return res(value === pattern);\n"}
{"cve":"CVE-2019-10792:0708", "fix_patch": "diff --git a/src/index.js b/src/index.js\nindex c57cc60..cffb220 100644\n--- a/src/index.js\n+++ b/src/index.js\n@@ -19,6 +19,7 @@ export const handlers = {\n  */\n export function handler (type, name, fn) {\n   if (arguments.length > 2) {\n+    if (name === '__proto__') throw new Error('Invalid handler name');\n     handlers[type][name] = fn\n   }\n \n"}
{"cve":"CVE-2019-10795:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/undefsafe.js b/lib/undefsafe.js\nindex 60663b0..42557a4 100644\n--- a/lib/undefsafe.js\n+++ b/lib/undefsafe.js\n@@ -111,7 +111,7 @@ function undefsafe(obj, path, value, __res) {\n     obj = undefined;\n   } else if (!star && value) {\n     key = path.split('.').pop();\n-    parent[key] = value;\n+    if (key !== '__proto__') parent[key] = value;\n   }\n   return obj;\n }\n"}
{"cve":"CVE-2021-32796:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/dom.js b/lib/dom.js\nindex de9f606..0f5187c 100644\n--- a/lib/dom.js\n+++ b/lib/dom.js\n@@ -1271,7 +1271,7 @@ function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){\n \t\t * @see https://www.w3.org/TR/xml/#NT-CharData\n \t\t */\n \t\treturn buf.push(node.data\n-\t\t\t.replace(/[<&]/g,_xmlEncoder)\n+\t\t\t.replace(/[<&>]/g,_xmlEncoder)\n \t\t\t.replace(/]]>/g, ']]&gt;')\n \t\t);\n \tcase CDATA_SECTION_NODE:\n"}
{"cve":"CVE-2020-26226:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/hide-sensitive.js b/lib/hide-sensitive.js\nindex 6098496..2e30027 100644\n--- a/lib/hide-sensitive.js\n+++ b/lib/hide-sensitive.js\n@@ -11,7 +11,7 @@ module.exports = (env) => {\n     return /token|password|credential|secret|private/i.test(envVar) && size(env[envVar].trim()) >= SECRET_MIN_SIZE;\n   });\n \n-  const regexp = new RegExp(toReplace.map((envVar) => escapeRegExp(env[envVar])).join('|'), 'g');\n+  const regexp = new RegExp(toReplace.map((envVar) => { const secret = env[envVar]; const encodedSecret = encodeURIComponent(secret); return `${escapeRegExp(secret)}|${escapeRegExp(encodedSecret)}`; }).join('|'), 'g');\n   return (output) =>\n     output && isString(output) && toReplace.length > 0 ? output.toString().replace(regexp, SECRET_REPLACEMENT) : output;\n };\n"}
{"cve":"CVE-2020-26237:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/highlight.js b/src/highlight.js\nindex 4f98f38e..1c80d7a8 100644\n--- a/src/highlight.js\n+++ b/src/highlight.js\n@@ -797,7 +797,7 @@ const HLJS = function(hljs) {\n     if (typeof aliasList === 'string') {\n       aliasList = [aliasList];\n     }\n-    aliasList.forEach(alias => { aliases[alias] = languageName; });\n+    aliasList.forEach(alias => { if (!['__proto__', 'constructor', 'prototype'].includes(alias)) { aliases[alias] = languageName; } });\n   }\n \n   /**\n"}
{"cve":"CVE-2023-41039:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/RestrictedPython/Guards.py b/src/RestrictedPython/Guards.py\nindex 9b70ae3..f8f2a5f 100644\n--- a/src/RestrictedPython/Guards.py\n+++ b/src/RestrictedPython/Guards.py\n@@ -246,7 +246,7 @@ def safer_getattr(object, name, default=None, getattr=getattr):\n     http://lucumr.pocoo.org/2016/12/29/careful-with-str-format/\n \n     \"\"\"\n-    if isinstance(object, str) and name == 'format':\n+    if isinstance(object, str) and name in ('format', 'format_map'):\n         raise NotImplementedError(\n             'Using format() on a %s is not safe.' % object.__class__.__name__)\n     if name.startswith('_'):\ndiff --git a/src/RestrictedPython/Utilities.py b/src/RestrictedPython/Utilities.py\nindex 4bc6677..6cc96a1 100644\n--- a/src/RestrictedPython/Utilities.py\n+++ b/src/RestrictedPython/Utilities.py\n@@ -18,7 +18,6 @@ import string\n \n utility_builtins = {}\n \n-utility_builtins['string'] = string\n utility_builtins['math'] = math\n utility_builtins['random'] = random\n utility_builtins['whrandom'] = random\n"}
{"cve":"CVE-2023-34457:0708", "fix_patch": ""}
{"cve":"CVE-2018-7753:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/bleach/sanitizer.py b/bleach/sanitizer.py\nindex 81df765..c44f34e 100644\n--- a/bleach/sanitizer.py\n+++ b/bleach/sanitizer.py\n@@ -24,7 +24,7 @@ from html5lib.serializer import HTMLSerializer\n from html5lib._tokenizer import HTMLTokenizer\n from html5lib._trie import Trie\n \n-from bleach.utils import alphabetize_attributes, force_unicode\n+from bleach.utils import alphabetize_attributes, force_unicode, decode_entities\n \n \n #: Trie of html entity string -> character representation\n@@ -513,7 +513,7 @@ class BleachSanitizerFilter(sanitizer.Filter):\n                     val_unescaped = re.sub(\n                         \"[`\\000-\\040\\177-\\240\\s]+\",\n                         '',\n-                        unescape(val)).lower()\n+                        decode_entities(val)).lower()\n \n                     # Remove replacement characters from unescaped characters.\n                     val_unescaped = val_unescaped.replace(\"\\ufffd\", \"\")\n"}
{"cve":"CVE-2015-1326:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/dbusmock/mockobject.py b/dbusmock/mockobject.py\nindex 29f790e..b117fa2 100644\n--- a/dbusmock/mockobject.py\n+++ b/dbusmock/mockobject.py\n@@ -39,16 +39,29 @@ if sys.version_info[0] >= 3:\n \n \n def load_module(name):\n-    if os.path.exists(name) and os.path.splitext(name)[1] == '.py':\n-        sys.path.insert(0, os.path.dirname(os.path.abspath(name)))\n+    # Validate template file path and extension\n+    if os.path.exists(name) and os.path.isfile(name):\n+        ext = os.path.splitext(name)[1].lower()\n+        if ext != '.py':\n+            raise ImportError(f\"Unsupported file type: {ext}. Only .py files are allowed.\")\n+\n+        abs_path = os.path.abspath(name)\n+        # Prevent path traversal attacks\n+        if not abs_path.startswith(os.getcwd()):\n+            raise ImportError(\"Template files must be in the current working directory\")\n+\n+        sys.path.insert(0, os.path.dirname(abs_path))\n         try:\n-            m = os.path.splitext(os.path.basename(name))[0]\n-            module = importlib.import_module(m)\n+            module_name = os.path.splitext(os.path.basename(abs_path))[0]\n+            module = importlib.import_module(module_name)\n         finally:\n             sys.path.pop(0)\n-\n         return module\n \n+    # Block path separators in template names\n+    if os.sep in name or (os.altsep and os.altsep in name):\n+        raise ImportError(\"Template names cannot contain path separators\")\n+\n     return importlib.import_module('dbusmock.templates.' + name)\n \n \n"}
{"cve":"CVE-2025-43859:0708", "fix_patch": ""}
{"cve":"CVE-2024-49750:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/snowflake/connector/auth/_auth.py b/src/snowflake/connector/auth/_auth.py\nindex b8aa8f48..d6ee2fdb 100644\n--- a/src/snowflake/connector/auth/_auth.py\n+++ b/src/snowflake/connector/auth/_auth.py\n@@ -205,7 +205,6 @@ class Auth:\n \n         body = copy.deepcopy(body_template)\n         # updating request body\n-        logger.debug(\"assertion content: %s\", auth_instance.assertion_content)\n         auth_instance.update_body(body)\n \n         logger.debug(\ndiff --git a/src/snowflake/connector/secret_detector.py b/src/snowflake/connector/secret_detector.py\nindex 6633cda6..75afa694 100644\n--- a/src/snowflake/connector/secret_detector.py\n+++ b/src/snowflake/connector/secret_detector.py\n@@ -29,13 +29,19 @@ class SecretDetector(logging.Formatter):\n         flags=re.IGNORECASE,\n     )\n     SAS_TOKEN_PATTERN = re.compile(\n-        r\"(sig|signature|AWSAccessKeyId|password|passcode)=(?P<secret>[a-z0-9%/+]{16,})\",\n+        r\"(sig|signature|AWSAccessKeyId|password|passcode|sas|token|access_token|session_token)=(?P<secret>[a-z0-9%/+]{16,})\",\n         flags=re.IGNORECASE,\n     )\n     PRIVATE_KEY_PATTERN = re.compile(\n-        r\"-----BEGIN PRIVATE KEY-----\\\\n([a-z0-9/+=\\\\n]{32,})\\\\n-----END PRIVATE KEY-----\",\n+        r\"-----BEGIN (?:RSA|EC|DSA|OPENSSH)? PRIVATE KEY-----(?:\\\\n|\\\\r\\\\n)([a-z0-9/+=\\\\n\\\\r]{32,})(?:\\\\n|\\\\r\\\\n)-----END (?:RSA|EC|DSA|OPENSSH)? PRIVATE KEY-----\",\n         flags=re.MULTILINE | re.IGNORECASE,\n     )\n+    JWT_TOKEN_PATTERN = re.compile(r\"[a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]+\\.[a-zA-Z0-9_-]+\", flags=re.IGNORECASE)\n+\n+    @staticmethod\n+    def mask_jwt(text: str) -> str:\n+        return SecretDetector.JWT_TOKEN_PATTERN.sub(\"****\", text)\n+\n     PRIVATE_KEY_DATA_PATTERN = re.compile(\n         r'\"privateKeyData\": \"([a-z0-9/+=\\\\n]{10,})\"', flags=re.MULTILINE | re.IGNORECASE\n     )\n@@ -46,7 +52,8 @@ class SecretDetector(logging.Formatter):\n \n     PASSWORD_PATTERN = re.compile(\n         r\"(password\"\n-        r\"|pwd)\"\n+        r\"|pwd\"\n+        r\"|passcode)\"\n         r\"([\\'\\\"\\s:=]+)\"\n         r\"([a-z0-9!\\\"#\\$%&\\\\\\'\\(\\)\\*\\+\\,-\\./:;<=>\\?\\@\\[\\]\\^_`\\{\\|\\}~]{1,})\",\n         flags=re.IGNORECASE,\n@@ -100,13 +107,15 @@ class SecretDetector(logging.Formatter):\n         masked = False\n         err_str = None\n         try:\n-            masked_text = SecretDetector.mask_connection_token(\n-                SecretDetector.mask_password(\n-                    SecretDetector.mask_private_key_data(\n-                        SecretDetector.mask_private_key(\n-                            SecretDetector.mask_aws_tokens(\n-                                SecretDetector.mask_sas_tokens(\n-                                    SecretDetector.mask_aws_keys(text)\n+            masked_text = SecretDetector.mask_jwt(\n+                SecretDetector.mask_connection_token(\n+                    SecretDetector.mask_password(\n+                        SecretDetector.mask_private_key_data(\n+                            SecretDetector.mask_private_key(\n+                                SecretDetector.mask_aws_tokens(\n+                                    SecretDetector.mask_sas_tokens(\n+                                        SecretDetector.mask_aws_keys(text)\n+                                    )\n                                 )\n                             )\n                         )\n"}
{"cve":"CVE-2023-45809:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/wagtail/users/views/bulk_actions/user_bulk_action.py b/wagtail/users/views/bulk_actions/user_bulk_action.py\nindex 76d05db58d..72323e3991 100644\n--- a/wagtail/users/views/bulk_actions/user_bulk_action.py\n+++ b/wagtail/users/views/bulk_actions/user_bulk_action.py\n@@ -8,7 +8,7 @@ class UserBulkAction(BulkAction):\n     models = [get_user_model()]\n \n     def get_all_objects_in_listing_query(self, parent_id):\n-        listing_objects = self.model.objects.all().values_list(\"pk\", flat=True)\n+        listing_objects = self.model.objects.accessible_by(self.request.user).values_list(\"pk\", flat=True)\n         if \"q\" in self.request.GET:\n             q = self.request.GET.get(\"q\")\n             model_fields = {f.name for f in self.model._meta.get_fields()}\n"}
{"cve":"CVE-2022-29217:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/jwt/algorithms.py b/jwt/algorithms.py\nindex 739df80..aab41eb 100644\n--- a/jwt/algorithms.py\n+++ b/jwt/algorithms.py\n@@ -75,8 +75,7 @@ def get_default_algorithms():\n     Returns the algorithms that are implemented by the library.\n     \"\"\"\n     default_algorithms = {\n-        \"none\": NoneAlgorithm(),\n-        \"HS256\": HMACAlgorithm(HMACAlgorithm.SHA256),\n+            \"HS256\": HMACAlgorithm(HMACAlgorithm.SHA256),\n         \"HS384\": HMACAlgorithm(HMACAlgorithm.SHA384),\n         \"HS512\": HMACAlgorithm(HMACAlgorithm.SHA512),\n     }\n"}
{"cve":"CVE-2019-16789:0708", "fix_patch": ""}
{"cve":"CVE-2025-48374:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/api/config/config.go b/pkg/api/config/config.go\nindex 39f86639..8a92f622 100644\n--- a/pkg/api/config/config.go\n+++ b/pkg/api/config/config.go\n@@ -341,6 +341,17 @@ func (c *Config) Sanitize() *Config {\n \t\tsanitizedConfig.HTTP.Auth.LDAP.bindPassword = \"******\"\n \t}\n \n+\t// Sanitize OIDC client secret\n+\tif c.HTTP.Auth != nil && c.HTTP.Auth.OIDC != nil && c.HTTP.Auth.OIDC.ClientSecret != \"\" {\n+\t\tsanitizedConfig.HTTP.Auth.OIDC = &OIDCConfig{}\n+\n+\t\tif err := DeepCopy(c.HTTP.Auth.OIDC, sanitizedConfig.HTTP.Auth.OIDC); err != nil {\n+\t\t\tpanic(err)\n+\t\t}\n+\n+\t\tsanitizedConfig.HTTP.Auth.OIDC.ClientSecret = \"******\"\n+\t}\n+\n \tif c.IsEventRecorderEnabled() {\n \t\tfor i, sink := range c.Extensions.Events.Sinks {\n \t\t\tif sink.Credentials == nil {\n"}
{"cve":"CVE-2025-24882:0708", "fix_patch": ""}
{"cve":"CVE-2025-24806:0708", "fix_patch": ""}
{"cve":"CVE-2024-56362:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/core/auth/auth.go b/core/auth/auth.go\nindex 7725de8d6..b32f6edb2 100644\n--- a/core/auth/auth.go\n+++ b/core/auth/auth.go\n@@ -4,6 +4,7 @@ import (\n \t\"context\"\n \t\"sync\"\n \t\"time\"\n+\t\"os\"\n \n \t\"github.com/go-chi/jwtauth/v5\"\n \t\"github.com/google/uuid\"\n@@ -24,8 +25,8 @@ var (\n func Init(ds model.DataStore) {\n \tonce.Do(func() {\n \t\tlog.Info(\"Setting Session Timeout\", \"value\", conf.Server.SessionTimeout)\n-\t\tsecret, err := ds.Property(context.TODO()).Get(consts.JWTSecretKey)\n-\t\tif err != nil || secret == \"\" {\n+\t\tsecret := os.Getenv(\"NAVIDROME_JWT_SECRET\")\n+\t\tif secret == \"\" {\n \t\t\tlog.Error(\"No JWT secret found in DB. Setting a temp one, but please report this error\", err)\n \t\t\tsecret = uuid.NewString()\n \t\t}\n"}
{"cve":"CVE-2024-52309:0708", "fix_patch": "diff --git a/internal/common/common.go b/internal/common/common.go\nindex 0cbc0ec5..6e964f39 100644\n--- a/internal/common/common.go\n+++ b/internal/common/common.go\n@@ -521,6 +521,8 @@ type MetadataConfig struct {\n \n // Configuration defines configuration parameters common to all supported protocols\n type Configuration struct {\n+\t// List of allowed system commands that can be executed by hooks\n+\tAllowedCommands []string `json:\"allowed_commands\" mapstructure:\"allowed_commands\"`\n \t// Maximum idle timeout as minutes. If a client is idle for a time that exceeds this setting it will be disconnected.\n \t// 0 means disabled\n \tIdleTimeout int `json:\"idle_timeout\" mapstructure:\"idle_timeout\"`\n@@ -671,6 +673,14 @@ func (c *Configuration) GetProxyListener(listener net.Listener) (net.Listener, e\n }\n \n // GetRateLimitersStatus returns the rate limiters status\n+func (c *Configuration) isCommandAllowed(commandPath string) bool {\n+\tif len(c.AllowedCommands) == 0 {\n+\t\treturn false\n+\t}\n+\tcmd := filepath.Base(commandPath)\n+\treturn slices.Contains(c.AllowedCommands, cmd)\n+}\n+\n func (c *Configuration) GetRateLimitersStatus() (bool, []string) {\n \tenabled := false\n \tvar protocols []string\n@@ -710,7 +720,9 @@ func (c *Configuration) ExecuteStartupHook() error {\n \t\tlogger.Debug(logSender, \"\", \"Startup hook executed, elapsed: %v, response code: %v\", time.Since(startTime), resp.StatusCode)\n \t\treturn nil\n \t}\n-\tif !filepath.IsAbs(c.StartupHook) {\n+\tif !c.isCommandAllowed(c.StartupHook) {\n+\t\treturn fmt.Errorf(\"startup hook command not allowed: %q\", c.StartupHook)\n+\t} else if !filepath.IsAbs(c.StartupHook) {\n \t\terr := fmt.Errorf(\"invalid startup hook %q\", c.StartupHook)\n \t\tlogger.Warn(logSender, \"\", \"Invalid startup hook %q\", c.StartupHook)\n \t\treturn err\n@@ -758,7 +770,9 @@ func (c *Configuration) executePostDisconnectHook(remoteAddr, protocol, username\n \t\t\trespCode, time.Since(startTime), err)\n \t\treturn\n \t}\n-\tif !filepath.IsAbs(c.PostDisconnectHook) {\n+\tif !c.isCommandAllowed(c.PostDisconnectHook) {\n+\t\treturn\n+\t} else if !filepath.IsAbs(c.PostDisconnectHook) {\n \t\tlogger.Debug(protocol, connID, \"invalid post disconnect hook %q\", c.PostDisconnectHook)\n \t\treturn\n \t}\n@@ -817,7 +831,9 @@ func (c *Configuration) ExecutePostConnectHook(ipAddr, protocol string) error {\n \t\t}\n \t\treturn nil\n \t}\n-\tif !filepath.IsAbs(c.PostConnectHook) {\n+\tif !c.isCommandAllowed(c.PostConnectHook) {\n+\t\treturn fmt.Errorf(\"post connect hook command not allowed: %q\", c.PostConnectHook)\n+\t} else if !filepath.IsAbs(c.PostConnectHook) {\n \t\terr := fmt.Errorf(\"invalid post connect hook %q\", c.PostConnectHook)\n \t\tlogger.Warn(protocol, \"\", \"Login from ip %q denied: %v\", ipAddr, err)\n \t\treturn getPermissionDeniedError(protocol)\n"}
{"cve":"CVE-2024-22199:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/django.go b/django/django.go\nindex 030fbe2..c6e92a8 100644\n--- a/django/django.go\n+++ b/django/django.go\n@@ -101,7 +101,7 @@ func (e *Engine) Load() error {\n \tpongoset := pongo2.NewSet(\"default\", pongoloader)\n \t// Set template settings\n \tpongoset.Globals.Update(e.Funcmap)\n-\tpongo2.SetAutoescape(false)\n+\tpongo2.SetAutoescape(true)\n \n \t// Loop trough each Directory and register template files\n \twalkFn := func(path string, info os.FileInfo, err error) error {\n"}
{"cve":"CVE-2023-52081:0708", "fix_patch": "diff --git a/catalog.go b/catalog.go\nindex 1fb4814..7b4df30 100644\n--- a/catalog.go\n+++ b/catalog.go\n@@ -42,7 +42,7 @@ func (store Catalog) Lookup(query string) (Theme, error) {\n // to search for something.\n // For example, it is used by (ThemeStore).Lookup\n func lookupPreprocess(s string) string {\n-\treturn strings.ToLower(norm.NFKD.String(regexp.MustCompile(`[-_ .]`).ReplaceAllString(s, \"\")))\n+\treturn strings.ToLower(regexp.MustCompile(`[-_ .]`).ReplaceAllString(norm.NFKD.String(s), \"\"))\n }\n \n // LoadCatalog loads a directory of theme manifests.\n"}
{"cve":"CVE-2023-45128:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\n"}
{"cve":"CVE-2023-40029:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/util/db/cluster.go b/util/db/cluster.go\nindex 9b405a9cac..195624aceb 100644\n--- a/util/db/cluster.go\n+++ b/util/db/cluster.go\n@@ -404,6 +404,7 @@ func SecretToCluster(s *apiv1.Secret) (*appv1.Cluster, error) {\n \tif s.Annotations != nil {\n \t\tannotations = collections.CopyStringMap(s.Annotations)\n \t\tdelete(annotations, common.AnnotationKeyManagedBy)\n+delete(annotations, \"kubectl.kubernetes.io/last-applied-configuration\")\n \t}\n \n \tcluster := appv1.Cluster{\n"}
{"cve":"CVE-2023-25168:0708", "fix_patch": ""}
{"cve":"CVE-2021-3583:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/ansible/template/__init__.py b/lib/ansible/template/__init__.py\nindex 52b9f71977..ab128c0222 100644\n--- a/lib/ansible/template/__init__.py\n+++ b/lib/ansible/template/__init__.py\n@@ -832,9 +832,12 @@ class Templar:\n                 eol = data.find('\\n')\n                 line = data[len(JINJA2_OVERRIDE):eol]\n                 data = data[eol + 1:]\n+                allowed_keys = {'trim_blocks', 'lstrip_blocks', 'newline_sequence', 'keep_trailing_newline'}\n                 for pair in line.split(','):\n                     (key, val) = pair.split(':')\n                     key = key.strip()\n+                    if key not in allowed_keys:\n+                        raise AnsibleError(f\"Invalid Jinja2 environment override key: {key}\")\n                     setattr(myenv, key, ast.literal_eval(val.strip()))\n \n             # Adds Ansible custom filters and tests\n"}
{"cve":"CVE-2023-30172:0708", "fix_patch": ""}
{"cve":"CVE-2020-10691:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/ansible/galaxy/collection.py b/lib/ansible/galaxy/collection.py\nindex fd50472f79..b62c523e96 100644\n--- a/lib/ansible/galaxy/collection.py\n+++ b/lib/ansible/galaxy/collection.py\n@@ -185,7 +185,10 @@ class CollectionRequirement:\n                     _extract_tar_file(collection_tar, file_name, b_collection_path, b_temp_path,\n                                       expected_hash=file_info['chksum_sha256'])\n                 else:\n-                    os.makedirs(os.path.join(b_collection_path, to_bytes(file_name, errors='surrogate_or_strict')))\n+                    sanitized_path = os.path.abspath(os.path.join(b_collection_path, to_bytes(file_name, errors='surrogate_or_strict')))\n+            if not sanitized_path.startswith(b_collection_path):\n+                raise AnsibleError(\"Invalid file name: %s\" % to_text(file_name))\n+            os.makedirs(sanitized_path)\n \n     def set_latest_version(self):\n         self.versions = set([self.latest_version])\n@@ -925,7 +928,10 @@ def _extract_tar_file(tar, filename, b_dest, b_temp_path, expected_hash=None):\n             raise AnsibleError(\"Checksum mismatch for '%s' inside collection at '%s'\"\n                                % (n_filename, to_native(tar.name)))\n \n-        b_dest_filepath = os.path.join(b_dest, to_bytes(filename, errors='surrogate_or_strict'))\n+        sanitized_path = os.path.abspath(os.path.join(b_dest, to_bytes(filename, errors='surrogate_or_strict')))\n+            if not sanitized_path.startswith(b_dest):\n+                raise AnsibleError(\"Invalid file name: %s\" % to_text(filename))\n+            b_dest_filepath = sanitized_path\n         b_parent_dir = os.path.split(b_dest_filepath)[0]\n         if not os.path.exists(b_parent_dir):\n             # Seems like Galaxy does not validate if all file entries have a corresponding dir ftype entry. This check\n"}
{"cve":"CVE-2024-42005:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 277e8a18ca..86e97dbd93 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -2449,29 +2449,24 @@ class Query(BaseExpression):\n             field_names = []\n             extra_names = []\n             annotation_names = []\n-            if not self.extra and not self.annotations:\n-                # Shortcut - if there are no extra or annotations, then\n-                # the values() clause must be just field names.\n-                field_names = list(fields)\n-            else:\n-                self.default_cols = False\n-                for f in fields:\n-                    if f in self.extra_select:\n-                        extra_names.append(f)\n-                    elif f in self.annotation_select:\n-                        annotation_names.append(f)\n-                    elif f in self.annotations:\n-                        raise FieldError(\n-                            f\"Cannot select the '{f}' alias. Use annotate() to \"\n-                            \"promote it.\"\n-                        )\n-                    else:\n-                        # Call `names_to_path` to ensure a FieldError including\n-                        # annotations about to be masked as valid choices if\n-                        # `f` is not resolvable.\n-                        if self.annotation_select:\n-                            self.names_to_path(f.split(LOOKUP_SEP), self.model._meta)\n-                        field_names.append(f)\n+            self.default_cols = False\n+            for f in fields:\n+                if f in self.extra_select:\n+                    extra_names.append(f)\n+                elif f in self.annotation_select:\n+                    annotation_names.append(f)\n+                elif f in self.annotations:\n+                    raise FieldError(\n+                        f\"Cannot select the '{f}' alias. Use annotate() to \"\n+                        \"promote it.\"\n+                    )\n+                else:\n+                    # Call `names_to_path` to ensure a FieldError including\n+                    # annotations about to be masked as valid choices if\n+                    # `f` is not resolvable.\n+                    if self.annotation_select:\n+                        self.names_to_path(f.split(LOOKUP_SEP), self.model._meta)\n+                    field_names.append(f)\n             self.set_extra_mask(extra_names)\n             self.set_annotation_mask(annotation_names)\n             selected = frozenset(field_names + extra_names + annotation_names)\n"}
{"cve":"CVE-2022-28346:0708", "fix_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex f5f85a4d34..9974029843 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1034,7 +1034,11 @@ class Query(BaseExpression):\n             alias = seen[int_model] = join_info.joins[-1]\n         return alias or seen[None]\n \n+    from django.db.models.sql.constants import IDENTIFIER_CHECK\n+\n     def add_annotation(self, annotation, alias, is_summary=False, select=True):\n+        if not IDENTIFIER_CHECK.match(alias):\n+            raise ValueError(f\"Invalid annotation alias: {alias}\")\n         \"\"\"Add a single annotation expression to the Query.\"\"\"\n         annotation = annotation.resolve_expression(self, allow_joins=True, reuse=None,\n                                                    summarize=is_summary)\n@@ -2087,7 +2091,10 @@ class Query(BaseExpression):\n                 param_iter = iter(select_params)\n             else:\n                 param_iter = iter([])\n-            for name, entry in select.items():\n+            from django.db.models.sql.constants import IDENTIFIER_CHECK\n+        for name, entry in select.items():\n+            if not IDENTIFIER_CHECK.match(name):\n+                raise ValueError(f\"Invalid extra select name: {name}\")\n                 entry = str(entry)\n                 entry_params = []\n                 pos = entry.find(\"%s\")\n"}
{"cve":"CVE-2021-31542:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/core/files/storage.py b/django/core/files/storage.py\nindex 1562614e50..78b283bd87 100644\n--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -65,7 +65,8 @@ class Storage:\n         Return a filename that's free on the target storage system and\n         available for new content to be written to.\n         \"\"\"\n-        dir_name, file_name = os.path.split(name)\n+        file_name = os.path.basename(name)\n+        dir_name = ''\n         file_root, file_ext = os.path.splitext(file_name)\n         # If the filename already exists, add an underscore and a random 7\n         # character alphanumeric string (before the file extension, if one\n"}
{"cve":"CVE-2024-10220:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/volume/git_repo/git_repo.go b/pkg/volume/git_repo/git_repo.go\nindex 995018d9007..5849209da96 100644\n--- a/pkg/volume/git_repo/git_repo.go\n+++ b/pkg/volume/git_repo/git_repo.go\n@@ -261,6 +261,15 @@ func validateVolume(src *v1.GitRepoVolumeSource) error {\n \tif err := validateNonFlagArgument(src.Directory, \"directory\"); err != nil {\n \t\treturn err\n \t}\n+\tif src.Directory != \"\" {\n+\t\tif filepath.IsAbs(src.Directory) {\n+\t\t\treturn fmt.Errorf(\"directory %q is not allowed to be an absolute path\", src.Directory)\n+\t\t}\n+\t\tcleanedDir := filepath.Clean(src.Directory)\n+\t\tif strings.HasPrefix(cleanedDir, \"..\") {\n+\t\t\treturn fmt.Errorf(\"directory %q contains path traversal elements\", src.Directory)\n+\t\t}\n+\t}\n \treturn nil\n }\n \n"}
{"cve":"CVE-2024-45043:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/receiver/awsfirehosereceiver/receiver.go b/receiver/awsfirehosereceiver/receiver.go\nindex 6211f61221..0992edd6f5 100644\n--- a/receiver/awsfirehosereceiver/receiver.go\n+++ b/receiver/awsfirehosereceiver/receiver.go\n@@ -233,8 +233,11 @@ func (fmr *firehoseReceiver) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n // validate checks the Firehose access key in the header against\n // the one passed into the Config\n func (fmr *firehoseReceiver) validate(r *http.Request) (int, error) {\n-\tif accessKey := r.Header.Get(headerFirehoseAccessKey); accessKey != \"\" && accessKey != string(fmr.config.AccessKey) {\n-\t\treturn http.StatusUnauthorized, errInvalidAccessKey\n+\tif len(fmr.config.AccessKey) > 0 {\n+\t\taccessKey := r.Header.Get(headerFirehoseAccessKey)\n+\t\tif accessKey == \"\" || accessKey != string(fmr.config.AccessKey) {\n+\t\t\treturn http.StatusUnauthorized, errInvalidAccessKey\n+\t\t}\n \t}\n \treturn http.StatusAccepted, nil\n }\n"}
{"cve":"CVE-2021-21432:0708", "fix_patch": "diff --git a/source/github/authentication.go b/source/github/authentication.go\nindex 6d964e3a..071edb73 100644\n--- a/source/github/authentication.go\n+++ b/source/github/authentication.go\n@@ -115,6 +115,12 @@ func (c *client) AuthenticateToken(r *http.Request) (*library.User, error) {\n \t\treturn nil, err\n \t}\n \n+\t// Verify user exists in system and is authorized\n+\tuser, err := c.Database.GetUserByName(u)\n+\tif err != nil || user == nil {\n+\t\treturn nil, errors.New(\"user not authorized\")\n+\t}\n+\n \treturn &library.User{\n \t\tName:  &u,\n \t\tToken: &token,\n"}
{"cve":"CVE-2022-1992:0708", "fix_patch": ""}
{"cve":"CVE-2020-26294:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/template/native/render.go b/template/native/render.go\nindex 4683db6..9c182fb 100644\n--- a/template/native/render.go\n+++ b/template/native/render.go\n@@ -25,7 +25,9 @@ func Render(tmpl string, s *types.Step) (types.StepSlice, error) {\n \t// parse the template with Masterminds/sprig functions\n \t//\n \t// https://pkg.go.dev/github.com/Masterminds/sprig?tab=doc#TxtFuncMap\n-\tt, err := template.New(s.Name).Funcs(sprig.TxtFuncMap()).Funcs(templateFuncMap).Parse(tmpl)\n+\tfuncMap := sprig.TxtFuncMap()\n+\tdelete(funcMap, \"env\")\n+\tt, err := template.New(s.Name).Funcs(funcMap).Funcs(templateFuncMap).Parse(tmpl)\n \tif err != nil {\n \t\treturn types.StepSlice{}, fmt.Errorf(\"unable to parse template %s: %v\", s.Template.Name, err)\n \t}\n"}
{"cve":"CVE-2022-1986:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/db/repo_editor.go b/internal/db/repo_editor.go\nindex 9d4664be..8f71e1b8 100644\n--- a/internal/db/repo_editor.go\n+++ b/internal/db/repo_editor.go\n@@ -466,11 +466,13 @@ type UploadRepoFileOptions struct {\n // isRepositoryGitPath returns true if given path is or resides inside \".git\"\n // path of the repository.\n func isRepositoryGitPath(path string) bool {\n-\treturn strings.HasSuffix(path, \".git\") ||\n-\t\tstrings.Contains(path, \".git\"+string(os.PathSeparator)) ||\n-\t\t// Windows treats \".git.\" the same as \".git\"\n-\t\tstrings.HasSuffix(path, \".git.\") ||\n-\t\tstrings.Contains(path, \".git.\"+string(os.PathSeparator))\n+\tcleanedPath := filepath.Clean(path)\n+\tfor _, part := range strings.Split(cleanedPath, string(os.PathSeparator)) {\n+\t\tif part == \".git\" {\n+\t\t\treturn true\n+\t\t}\n+\t}\n+\treturn false\n }\n \n func (repo *Repository) UploadRepoFiles(doer *User, opts UploadRepoFileOptions) error {\n"}
{"cve":"CVE-2022-29188:0708", "fix_patch": "diff --git a/pkg/smokescreen/smokescreen.go b/pkg/smokescreen/smokescreen.go\nindex f188768..eda5ee7 100644\n--- a/pkg/smokescreen/smokescreen.go\n+++ b/pkg/smokescreen/smokescreen.go\n@@ -869,7 +869,7 @@ func checkACLsForRequest(config *Config, req *http.Request, outboundHost string)\n \tdecision.role = role\n \n \tsubmatch := hostExtractRE.FindStringSubmatch(outboundHost)\n-\tdestination := submatch[1]\n+\tdestination := strings.Trim(submatch[1], \"[]\")\n \n \taclDecision, err := config.EgressACL.Decide(role, destination)\n \tdecision.project = aclDecision.Project\n"}
{"cve":"CVE-2023-50726:0708", "fix_patch": ""}
{"cve":"CVE-2022-3920:0708", "fix_patch": ""}
{"cve":"CVE-2024-5138:0708", "fix_patch": ""}
{"cve":"CVE-2024-27302:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/rest/internal/cors/handlers.go b/rest/internal/cors/handlers.go\nindex e2a64b74..7d18e552 100644\n--- a/rest/internal/cors/handlers.go\n+++ b/rest/internal/cors/handlers.go\n@@ -82,7 +82,7 @@ func isOriginAllowed(allows []string, origin string) bool {\n \t\t\treturn true\n \t\t}\n \n-\t\tif strings.HasSuffix(origin, o) {\n+\t\tif origin == o {\n \t\t\treturn true\n \t\t}\n \t}\n"}
{"cve":"CVE-2021-21291:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/oauthproxy.go b/oauthproxy.go\nindex 36c58c46..3e23611f 100644\n--- a/oauthproxy.go\n+++ b/oauthproxy.go\n@@ -443,7 +443,7 @@ func (p *OAuthProxy) IsValidRedirect(redirect string) bool {\n \t\t\t\tcontinue\n \t\t\t}\n \n-\t\t\tif (redirectHostname == domainHostname) || (strings.HasPrefix(domain, \".\") && strings.HasSuffix(redirectHostname, domainHostname)) {\n+\t\t\tif (redirectHostname == domainHostname) || (strings.HasPrefix(domain, \".\") && strings.HasSuffix(redirectHostname, \".\" + domainHostname)) {\n \t\t\t\t// the domain names match, now validate the ports\n \t\t\t\t// if the whitelisted domain's port is '*', allow all ports\n \t\t\t\t// if the whitelisted domain contains a specific port, only allow that port\n"}
{"cve":"CVE-2021-43798:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/api/plugins.go b/pkg/api/plugins.go\nindex 6e01a3414fe..d7ddbd9702d 100644\n--- a/pkg/api/plugins.go\n+++ b/pkg/api/plugins.go\n@@ -292,6 +292,24 @@ func (hs *HTTPServer) getPluginAssets(c *models.ReqContext) {\n \trequestedFile := filepath.Clean(web.Params(c.Req)[\"*\"])\n \tpluginFilePath := filepath.Join(plugin.PluginDir, requestedFile)\n \n+\t// Validate path to prevent directory traversal\n+\tpluginDirAbs, err := filepath.Abs(plugin.PluginDir)\n+\tif err != nil {\n+\t\tc.JsonApiErr(500, \"Failed to get plugin directory absolute path\", err)\n+\t\treturn\n+\t}\n+\n+\trequestedFileAbs, err := filepath.Abs(pluginFilePath)\n+\tif err != nil {\n+\t\tc.JsonApiErr(500, \"Failed to get requested file absolute path\", err)\n+\t\treturn\n+\t}\n+\n+\tif !strings.HasPrefix(requestedFileAbs, pluginDirAbs+string(filepath.Separator)) {\n+\t\tc.JsonApiErr(403, \"Access denied to file outside plugin directory\", nil)\n+\t\treturn\n+\t}\n+\n \tif !plugin.IncludedInSignature(requestedFile) {\n \t\ths.log.Warn(\"Access to requested plugin file will be forbidden in upcoming Grafana versions as the file \"+\n \t\t\t\"is not included in the plugin signature\", \"file\", requestedFile)\n"}
{"cve":"CVE-2020-11053:0708", "fix_patch": ""}
{"cve":"CVE-2020-4037:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/oauthproxy.go b/oauthproxy.go\nindex 8c303df8..6bee0e6b 100644\n--- a/oauthproxy.go\n+++ b/oauthproxy.go\n@@ -63,7 +63,7 @@ var (\n \n \t// Used to check final redirects are not susceptible to open redirects.\n \t// Matches //, /\\ and both of these with whitespace in between (eg / / or / \\).\n-\tinvalidRedirectRegex = regexp.MustCompile(`^/(\\s|\\v)?(/|\\\\)`)\n+\tinvalidRedirectRegex = regexp.MustCompile(`^//|^/\\\\\\\\|^/\\s|^/\\v|^/[^/]+[@:][^/]+`))\n )\n \n // OAuthProxy is the main authentication proxy\n"}
{"cve":"CVE-2024-25620:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/chart/metadata.go b/pkg/chart/metadata.go\nindex 97bfc2c0c..c5bd3b703 100644\n--- a/pkg/chart/metadata.go\n+++ b/pkg/chart/metadata.go\n@@ -110,6 +110,9 @@ func (md *Metadata) Validate() error {\n \tif md.Name == \"\" {\n \t\treturn ValidationError(\"chart.metadata.name is required\")\n \t}\n+\tif strings.Contains(md.Name, \"/\") || strings.Contains(md.Name, \"\\\\\") {\n+\t\treturn ValidationError(\"chart.metadata.name must not contain path separators\")\n+\t}\n \tif md.Version == \"\" {\n \t\treturn ValidationError(\"chart.metadata.version is required\")\n \t}\n"}
{"cve":"CVE-2022-2024:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/db/repo_editor.go b/internal/db/repo_editor.go\nindex 3edb16e2..5280667f 100644\n--- a/internal/db/repo_editor.go\n+++ b/internal/db/repo_editor.go\n@@ -486,13 +486,14 @@ type UploadRepoFileOptions struct {\n // isRepositoryGitPath returns true if given path is or resides inside \".git\"\n // path of the repository.\n func isRepositoryGitPath(path string) bool {\n-\treturn strings.HasSuffix(path, \".git\") ||\n-\t\tstrings.Contains(path, \".git/\") ||\n-\t\tstrings.Contains(path, `.git\\`) ||\n+\tlowerPath := strings.ToLower(path)\n+\treturn strings.HasSuffix(lowerPath, \".git\") ||\n+\t\tstrings.Contains(lowerPath, \".git/\") ||\n+\t\tstrings.Contains(lowerPath, `.git\\`) ||\n \t\t// Windows treats \".git.\" the same as \".git\"\n-\t\tstrings.HasSuffix(path, \".git.\") ||\n-\t\tstrings.Contains(path, \".git./\") ||\n-\t\tstrings.Contains(path, `.git.\\`)\n+\t\tstrings.HasSuffix(lowerPath, \".git.\") ||\n+\t\tstrings.Contains(lowerPath, \".git./\") ||\n+\t\tstrings.Contains(lowerPath, `.git.\\`)\n }\n \n func (repo *Repository) UploadRepoFiles(doer *User, opts UploadRepoFileOptions) error {\n"}
{"cve":"CVE-2022-39340:0708", "fix_patch": ""}
{"cve":"CVE-2018-12976:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/gosrc/gosrc.go b/gosrc/gosrc.go\nindex 9a9e44b..4656644 100644\n--- a/gosrc/gosrc.go\n+++ b/gosrc/gosrc.go\n@@ -380,6 +380,12 @@ func getDynamic(ctx context.Context, client *http.Client, importPath, etag strin\n \trepo := strings.TrimSuffix(clonePath, \".\"+im.vcs)\n \tdirName := importPath[len(im.projectRoot):]\n \n+\t// Sanitize directory name to prevent path traversal\n+\tif strings.Contains(dirName, \"..\") || strings.HasPrefix(dirName, \"/\") {\n+\t\treturn nil, fmt.Errorf(\"invalid path component: %s\", dirName)\n+\t}\n+\tdirName = filepath.Clean(dirName)\n+\n \tresolvedPath := repo + dirName\n \tdir, err := getStatic(ctx, client, resolvedPath, etag)\n \tif err == errNoMatch {\n"}
{"cve":"CVE-2024-54132:0708", "fix_patch": ""}
{"cve":"CVE-2024-6257:0708", "fix_patch": ""}
{"cve":"CVE-2020-15233:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/authorize_helper.go b/authorize_helper.go\nindex ec286f5..d4794fc 100644\n--- a/authorize_helper.go\n+++ b/authorize_helper.go\n@@ -131,15 +131,28 @@ func isLoopbackURI(requested *url.URL, registeredURI string) bool {\n \t\treturn false\n \t}\n \n-\tif registered.Scheme != \"http\" || !isLoopbackAddress(registered.Host) {\n+\t// Only consider registered loopback URIs\n+\tif registered.Scheme != \"http\" || !isLoopbackAddress(registered.Hostname()) {\n \t\treturn false\n \t}\n \n-\tif requested.Scheme == \"http\" && isLoopbackAddress(requested.Host) && registered.Path == requested.Path {\n+\t// Requested URI must be a loopback address with the same path\n+\tif requested.Scheme != \"http\" || !isLoopbackAddress(requested.Hostname()) || registered.Path != requested.Path {\n+\t\treturn false\n+\t}\n+\n+\t// For loopback URIs, check if the port matches or if dynamic ports are allowed\n+\tregisteredPort := registered.Port()\n+\trequestedPort := requested.Port()\n+\n+\t// If the registered URI doesn't specify a port or uses the default port (80),\n+\t// allow any port on the loopback address\n+\tif registeredPort == \"\" || registeredPort == \"80\" {\n \t\treturn true\n \t}\n \n-\treturn false\n+\t// Otherwise, the ports must match exactly\n+\treturn registeredPort == requestedPort\n }\n \n // Check if address is either an IPv4 loopback or an IPv6 loopback-\n"}
{"cve":"CVE-2021-36157:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/tenant/resolver.go b/pkg/tenant/resolver.go\nindex e5fbea252..cbffca91f 100644\n--- a/pkg/tenant/resolver.go\n+++ b/pkg/tenant/resolver.go\n@@ -70,7 +70,10 @@ func (t *SingleResolver) TenantIDs(ctx context.Context) ([]string, error) {\n \tif err != nil {\n \t\treturn nil, err\n \t}\n-\treturn []string{orgID}, err\n+\tif err := ValidTenantID(orgID); err != nil {\n+\t\treturn nil, err\n+\t}\n+\treturn []string{orgID}, nil\n }\n \n type MultiResolver struct {\n"}
{"cve":"CVE-2020-29529:0708", "fix_patch": ""}
{"cve":"CVE-2024-43405:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/templates/signer/tmpl_signer.go b/pkg/templates/signer/tmpl_signer.go\nindex c4378fd4..110e2c15 100644\n--- a/pkg/templates/signer/tmpl_signer.go\n+++ b/pkg/templates/signer/tmpl_signer.go\n@@ -20,8 +20,13 @@ import (\n \terrorutil \"github.com/projectdiscovery/utils/errors\"\n )\n \n+// NormalizeNewlines converts all newline sequences to \\n\n+func NormalizeNewlines(data []byte) []byte {\n+\treturn bytes.ReplaceAll(bytes.ReplaceAll(data, []byte(\"\\r\\n\"), []byte(\"\\n\")), []byte(\"\\r\"), []byte(\"\\n\"))\n+}\n+\n var (\n-\tReDigest            = regexp.MustCompile(`(?m)^#\\sdigest:\\s.+$`)\n+\tReDigest            = regexp.MustCompile(`(?m)^#\\sdigest:\\s.+$[\\r\\n]*`)\n \tErrUnknownAlgorithm = errors.New(\"unknown algorithm\")\n \tSignaturePattern    = \"# digest: \"\n \tSignatureFmt        = SignaturePattern + \"%x\" + \":%v\" // `#digest: <signature>:<fragment>`\n@@ -88,7 +93,7 @@ func (t *TemplateSigner) Sign(data []byte, tmpl SignableTemplate) (string, error\n \t\t}\n \t}\n \n-\tbuff := bytes.NewBuffer(RemoveSignatureFromData(data))\n+\tbuff := bytes.NewBuffer(NormalizeNewlines(RemoveSignatureFromData(data)))\n \t// if file has any imports process them\n \tfor _, file := range tmpl.GetFileImports() {\n \t\tbin, err := os.ReadFile(file)\n@@ -130,13 +135,17 @@ func (t *TemplateSigner) Verify(data []byte, tmpl SignableTemplate) (bool, error\n \n \tdigestData = bytes.TrimSpace(bytes.TrimPrefix(digestData, []byte(SignaturePattern)))\n \t// remove fragment from digest as it is used for re-signing purposes only\n-\tdigestString := strings.TrimSuffix(string(digestData), \":\"+t.GetUserFragment())\n+\tdigestParts := strings.SplitN(string(digestData), \":\", 3)\n+\tdigestString := digestData\n+\tif len(digestParts) >= 2 {\n+\t\tdigestString = []byte(digestParts[0] + \":\" + digestParts[1])\n+\t}\n \tdigest, err := hex.DecodeString(digestString)\n \tif err != nil {\n \t\treturn false, err\n \t}\n \n-\tbuff := bytes.NewBuffer(RemoveSignatureFromData(data))\n+\tbuff := bytes.NewBuffer(NormalizeNewlines(RemoveSignatureFromData(data)))\n \t// if file has any imports process them\n \tfor _, file := range tmpl.GetFileImports() {\n \t\tbin, err := os.ReadFile(file)\n"}
{"cve":"CVE-2023-33967:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/probe/client/mysql/mysql.go b/probe/client/mysql/mysql.go\nindex 572a330..f25d369 100644\n--- a/probe/client/mysql/mysql.go\n+++ b/probe/client/mysql/mysql.go\n@@ -22,6 +22,7 @@ import (\n \t\"crypto/tls\"\n \t\"database/sql\"\n \t\"fmt\"\n+\t\"regexp\"\n \t\"strconv\"\n \t\"strings\"\n \t\"time\"\n@@ -108,12 +109,12 @@ func (r *MySQL) Probe() (bool, string) {\n \tif len(r.Data) > 0 {\n \t\tfor k, v := range r.Data {\n \t\t\tlog.Debugf(\"[%s / %s / %s] - Verifying Data - [%s] : [%s]\", r.ProbeKind, r.ProbeName, r.ProbeTag, k, v)\n-\t\t\tsql, err := r.getSQL(k)\n+\t\t\tsql, params, err := r.getSQL(k)\n \t\t\tif err != nil {\n \t\t\t\treturn false, err.Error()\n \t\t\t}\n \t\t\tlog.Debugf(\"[%s / %s / %s] - SQL - [%s]\", r.ProbeKind, r.ProbeName, r.ProbeTag, sql)\n-\t\t\trows, err := db.Query(sql)\n+\t\t\trows, err := db.Query(sql, params...)\n \t\t\tif err != nil {\n \t\t\t\treturn false, err.Error()\n \t\t\t}\n@@ -150,27 +151,36 @@ func (r *MySQL) Probe() (bool, string) {\n \n }\n \n-// getSQL get the SQL statement\n+// getSQL get the SQL statement with parameters\n // input: database:table:column:key:value\n-// output: SELECT column FROM database.table WHERE key = value\n-func (r *MySQL) getSQL(str string) (string, error) {\n+// output: SELECT column FROM database.table WHERE key = ?, parameters\n+func (r *MySQL) getSQL(str string) (string, []interface{}, error) {\n \tif len(strings.TrimSpace(str)) == 0 {\n-\t\treturn \"\", fmt.Errorf(\"Empty SQL data\")\n+\t\treturn \"\", nil, fmt.Errorf(\"Empty SQL data\")\n \t}\n \tfields := strings.Split(str, \":\")\n \tif len(fields) != 5 {\n-\t\treturn \"\", fmt.Errorf(\"Invalid SQL data - [%s]. (syntax: database:table:field:key:value)\", str)\n+\t\treturn \"\", nil, fmt.Errorf(\"Invalid SQL data - [%s]. (syntax: database:table:field:key:value)\", str)\n \t}\n \tdb := fields[0]\n \ttable := fields[1]\n \tfield := fields[2]\n \tkey := fields[3]\n \tvalue := fields[4]\n-\t//check value is int or not\n-\tif _, err := strconv.Atoi(value); err != nil {\n-\t\treturn \"\", fmt.Errorf(\"Invalid SQL data - [%s], the value must be int\", str)\n+\n+\t// Validate SQL identifiers\n+\tidentifierRegex := regexp.MustCompile(`^[a-zA-Z0-9_]+$`)\n+\tif !identifierRegex.MatchString(db) || !identifierRegex.MatchString(table) || \n+\t   !identifierRegex.MatchString(field) || !identifierRegex.MatchString(key) {\n+\t\treturn \"\", nil, fmt.Errorf(\"Invalid SQL identifier in - [%s]\", str)\n+\t}\n+\n+\t// Check value is int\n+\tintValue, err := strconv.Atoi(value)\n+\tif err != nil {\n+\t\treturn \"\", nil, fmt.Errorf(\"Invalid SQL data - [%s], the value must be int\", str)\n \t}\n \n-\tsql := fmt.Sprintf(\"SELECT %s FROM %s.%s WHERE %s = %s\", field, db, table, key, value)\n-\treturn sql, nil\n+\tsql := fmt.Sprintf(\"SELECT `%s` FROM `%s`.`%s` WHERE `%s` = ?\", field, db, table, key)\n+\treturn sql, []interface{}{intValue}, nil\n }\n"}
{"cve":"CVE-2024-27289:0708", "fix_patch": ""}
{"cve":"CVE-2023-30625:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/router/failed-events-manager.go b/router/failed-events-manager.go\nindex b76908fb..93484887 100644\n--- a/router/failed-events-manager.go\n+++ b/router/failed-events-manager.go\n@@ -5,6 +5,7 @@ import (\n \t\"database/sql\"\n \t\"encoding/json\"\n \t\"fmt\"\n+\t\"regexp\"\n \t\"strings\"\n \t\"time\"\n \n@@ -93,9 +94,16 @@ func (fem *FailedEventsManagerT) DropFailedRecordIDs(taskRunID string) {\n \t\treturn\n \t}\n \n-\t// Drop table\n+\t// Validate taskRunID to prevent SQL injection\n+\tif !regexp.MustCompile(`^[a-zA-Z0-9_]+$`).MatchString(taskRunID) {\n+\t\tpkgLogger.Errorf(\"Invalid taskRunID format: %s\", taskRunID)\n+\t\treturn\n+\t}\n+\n+\t// Drop table with properly escaped table name\n \ttable := fmt.Sprintf(`%s_%s`, failedKeysTablePrefix, taskRunID)\n-\tsqlStatement := fmt.Sprintf(`DROP TABLE IF EXISTS %s`, table)\n+\tescapedTable := strings.ReplaceAll(table, `\"`, `\"\"`)\n+\tsqlStatement := fmt.Sprintf(`DROP TABLE IF EXISTS \"%s\"`, escapedTable)\n \t_, err := fem.dbHandle.Exec(sqlStatement)\n \tif err != nil {\n \t\tpkgLogger.Errorf(\"Failed to drop table %s with error: %v\", taskRunID, err)\n"}
{"cve":"CVE-2022-23857:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/model/criteria/criteria.go b/model/criteria/criteria.go\nindex 0d3c7295..9fcba5bb 100644\n--- a/model/criteria/criteria.go\n+++ b/model/criteria/criteria.go\n@@ -29,7 +29,7 @@ func (c Criteria) OrderBy() string {\n \tvar mapped string\n \tif f == nil {\n \t\tlog.Error(\"Invalid field in 'sort' field\", \"field\", c.Sort)\n-\t\tmapped = c.Sort\n+\t\tmapped = \"title\"\n \t} else {\n \t\tif f.order == \"\" {\n \t\t\tmapped = f.field\n@@ -38,7 +38,11 @@ func (c Criteria) OrderBy() string {\n \t\t}\n \t}\n \tif c.Order != \"\" {\n-\t\tmapped = mapped + \" \" + c.Order\n+\t\torder := strings.ToUpper(c.Order)\n+\t\tif order != \"ASC\" && order != \"DESC\" {\n+\t\t\torder = \"ASC\"\n+\t\t}\n+\t\tmapped = mapped + \" \" + order\n \t}\n \treturn mapped\n }\n"}
{"cve":"CVE-2019-19499:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/tsdb/mysql/mysql.go b/pkg/tsdb/mysql/mysql.go\nindex fe41a9f38b5..773180fa8c8 100644\n--- a/pkg/tsdb/mysql/mysql.go\n+++ b/pkg/tsdb/mysql/mysql.go\n@@ -13,6 +13,7 @@ import (\n \t\"github.com/grafana/grafana/pkg/setting\"\n \n \t\"github.com/go-sql-driver/mysql\"\n+\t\"time\"\n \t\"github.com/go-xorm/core\"\n \t\"github.com/grafana/grafana/pkg/infra/log\"\n \t\"github.com/grafana/grafana/pkg/models\"\n@@ -31,13 +32,18 @@ func newMysqlQueryEndpoint(datasource *models.DataSource) (tsdb.TsdbQueryEndpoin\n \tif strings.HasPrefix(datasource.Url, \"/\") {\n \t\tprotocol = \"unix\"\n \t}\n-\tcnnstr := fmt.Sprintf(\"%s:%s@%s(%s)/%s?collation=utf8mb4_unicode_ci&parseTime=true&loc=UTC&allowNativePasswords=true\",\n-\t\tdatasource.User,\n-\t\tdatasource.DecryptedPassword(),\n-\t\tprotocol,\n-\t\tdatasource.Url,\n-\t\tdatasource.Database,\n-\t)\n+\tmysqlConfig := mysql.Config{\n+\t\tUser:                 datasource.User,\n+\t\tPasswd:               datasource.DecryptedPassword(),\n+\t\tNet:                  protocol,\n+\t\tAddr:                 datasource.Url,\n+\t\tDBName:               datasource.Database,\n+\t\tCollation:            \"utf8mb4_unicode_ci\",\n+\t\tParseTime:            true,\n+\t\tLoc:                  time.UTC,\n+\t\tAllowNativePasswords: true,\n+\t}\n+\tcnnstr := mysqlConfig.FormatDSN()\n \n \ttlsConfig, err := datasource.GetTLSConfig()\n \tif err != nil {\n"}
{"cve":"CVE-2022-1883:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/db/db.go b/db/db.go\nindex 88e5390..bc9e1b6 100644\n--- a/db/db.go\n+++ b/db/db.go\n@@ -370,11 +370,13 @@ func (db *Database) SearchAttribute(query url.Values) (results []types.SearchRes\n \t}\n \n \tif v := query.Get(\"tf_version\"); string(v) != \"\" {\n-\t\twhere = append(where, fmt.Sprintf(\"states.tf_version LIKE '%s'\", fmt.Sprintf(\"%%%s%%\", v)))\n+\t\twhere = append(where, \"states.tf_version LIKE ?\")\n+\t\tparams = append(params, fmt.Sprintf(\"%%%s%%\", v))\n \t}\n \n \tif v := query.Get(\"lineage_value\"); string(v) != \"\" {\n-\t\twhere = append(where, fmt.Sprintf(\"lineages.value LIKE '%s'\", fmt.Sprintf(\"%%%s%%\", v)))\n+\t\twhere = append(where, \"lineages.value LIKE ?\")\n+\t\tparams = append(params, fmt.Sprintf(\"%%%s%%\", v))\n \t}\n \n \tif len(where) > 0 {\n"}
{"cve":"CVE-2024-52010:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/mod/sshprox/sshprox.go b/src/mod/sshprox/sshprox.go\nindex ed1b92c..5a51a2c 100644\n--- a/src/mod/sshprox/sshprox.go\n+++ b/src/mod/sshprox/sshprox.go\n@@ -9,6 +9,7 @@ import (\n \t\"os\"\n \t\"os/exec\"\n \t\"path/filepath\"\n+\t\"regexp\"\n \t\"runtime\"\n \t\"strconv\"\n \t\"strings\"\n@@ -19,6 +20,8 @@ import (\n \t\"imuslab.com/zoraxy/mod/websocketproxy\"\n )\n \n+var validUsernameRegex = regexp.MustCompile(`^[a-zA-Z0-9_-]+$`)\n+\n /*\n \tSSH Proxy\n \n@@ -163,6 +166,11 @@ func (m *Manager) NewSSHProxy(binaryRoot string) (*Instance, error) {\n \n // Create a new Connection to target address\n func (i *Instance) CreateNewConnection(listenPort int, username string, remoteIpAddr string, remotePort int) error {\n+\t// Validate username\n+\tif username != \"\" && !validUsernameRegex.MatchString(username) {\n+\t\treturn errors.New(\"invalid username format\")\n+\t}\n+\n \t//Create a gotty instance\n \tconnAddr := remoteIpAddr\n \tif username != \"\" {\n@@ -174,8 +182,21 @@ func (i *Instance) CreateNewConnection(listenPort int, username string, remoteIp\n \t\ttitle = title + \":\" + strconv.Itoa(remotePort)\n \t}\n \n+\t// Construct SSH command safely without shell\n \tsshCommand := []string{\"ssh\", \"-t\", connAddr, \"-p\", strconv.Itoa(remotePort)}\n-\tcmd := exec.Command(i.ExecPath, \"-w\", \"-p\", strconv.Itoa(listenPort), \"--once\", \"--config\", configPath, \"--title-format\", title, \"bash\", \"-c\", strings.Join(sshCommand, \" \"))\n+\n+\t// Build gotty command with proper argument separation\n+\tcmdArgs := []string{\n+\t\t\"-w\", \n+\t\t\"-p\", strconv.Itoa(listenPort), \n+\t\t\"--once\", \n+\t\t\"--config\", configPath, \n+\t\t\"--title-format\", title,\n+\t}\n+\t// Append SSH command directly\n+\tcmdArgs = append(cmdArgs, sshCommand...)\n+\n+\tcmd := exec.Command(i.ExecPath, cmdArgs...)\n \tcmd.Dir = filepath.Dir(i.ExecPath)\n \tcmd.Env = append(os.Environ(), \"TERM=xterm\")\n \tcmd.Stdout = os.Stdout\n"}
{"cve":"CVE-2023-41891:0708", "fix_patch": "diff --git a/pkg/common/sorting.go b/pkg/common/sorting.go\nindex c4922d0b..84f40bbd 100644\n--- a/pkg/common/sorting.go\n+++ b/pkg/common/sorting.go\n@@ -2,12 +2,15 @@ package common\n \n import (\n \t\"fmt\"\n+\t\"regexp\"\n \n \t\"github.com/flyteorg/flyteadmin/pkg/errors\"\n \t\"github.com/flyteorg/flyteidl/gen/pb-go/flyteidl/admin\"\n \t\"google.golang.org/grpc/codes\"\n )\n \n+var validSortKeyRegex = regexp.MustCompile(`^[a-zA-Z_][a-zA-Z0-9_]*$`)\n+\n const gormDescending = \"%s desc\"\n const gormAscending = \"%s asc\"\n \n@@ -24,6 +27,9 @@ func (s *sortParamImpl) GetGormOrderExpr() string {\n }\n \n func NewSortParameter(sort admin.Sort) (SortParameter, error) {\n+\tif !validSortKeyRegex.MatchString(sort.Key) {\n+\t\treturn nil, errors.NewFlyteAdminErrorf(codes.InvalidArgument, \"invalid sort key: %s\", sort.Key)\n+\t}\n \tvar gormOrderExpression string\n \tswitch sort.Direction {\n \tcase admin.Sort_DESCENDING:\n"}
{"cve":"CVE-2022-23536:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/alertmanager/api.go b/pkg/alertmanager/api.go\nindex 3ed63a6e4..4cea27a2b 100644\n--- a/pkg/alertmanager/api.go\n+++ b/pkg/alertmanager/api.go\n@@ -45,6 +45,7 @@ var (\n \terrTLSFileNotAllowed             = errors.New(\"setting TLS ca_file, cert_file and key_file is not allowed\")\n \terrSlackAPIURLFileNotAllowed     = errors.New(\"setting Slack api_url_file and global slack_api_url_file is not allowed\")\n \terrVictorOpsAPIKeyFileNotAllowed = errors.New(\"setting VictorOps api_key_file is not allowed\")\n+\terrOpsGenieAPIKeyFileNotAllowed = errors.New(\"setting OpsGenie api_key_file is not allowed\")\n )\n \n // UserConfig is used to communicate a users alertmanager configs\n@@ -350,6 +351,10 @@ func validateAlertmanagerConfig(cfg interface{}) error {\n \t\tif err := validateVictorOpsConfig(v.Interface().(config.VictorOpsConfig)); err != nil {\n \t\t\treturn err\n \t\t}\n+\tcase reflect.TypeOf(config.OpsGenieConfig{}):\n+\t\tif err := validateOpsGenieConfig(v.Interface().(config.OpsGenieConfig)); err != nil {\n+\t\t\treturn err\n+\t\t}\n \t}\n \n \t// If the input config is a struct, recursively iterate on all fields.\n@@ -449,3 +454,10 @@ func validateVictorOpsConfig(cfg config.VictorOpsConfig) error {\n \t}\n \treturn nil\n }\n+\n+func validateOpsGenieConfig(cfg config.OpsGenieConfig) error {\n+\tif cfg.APIKeyFile != \"\" {\n+\t\treturn errOpsGenieAPIKeyFileNotAllowed\n+\t}\n+\treturn nil\n+}\n"}
{"cve":"CVE-2024-24579:0708", "fix_patch": ""}
{"cve":"CVE-2020-4053:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/plugin/installer/http_installer.go b/pkg/plugin/installer/http_installer.go\nindex c07cad80a..e6a9119ec 100644\n--- a/pkg/plugin/installer/http_installer.go\n+++ b/pkg/plugin/installer/http_installer.go\n@@ -173,6 +173,19 @@ func (g *TarGzExtractor) Extract(buffer *bytes.Buffer, targetDir string) error {\n \n \t\tpath := filepath.Join(targetDir, header.Name)\n \n+\t// Prevent path traversal\n+\tabsTargetDir, err := filepath.Abs(targetDir)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tabsPath, err := filepath.Abs(path)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tif !strings.HasPrefix(absPath, absTargetDir) {\n+\t\treturn errors.Errorf(\"path traversal detected in file: %s\", header.Name)\n+\t}\n+\n \t\tswitch header.Typeflag {\n \t\tcase tar.TypeDir:\n \t\t\tif err := os.Mkdir(path, 0755); err != nil {\n"}
{"cve":"CVE-2025-24366:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/sftpd/ssh_cmd.go b/internal/sftpd/ssh_cmd.go\nindex 8a342e99..9b73c1da 100644\n--- a/internal/sftpd/ssh_cmd.go\n+++ b/internal/sftpd/ssh_cmd.go\n@@ -441,6 +441,32 @@ func (c *sshCommand) getSystemCommand() (systemCommand, error) {\n \t\t\t}\n \t\t}\n \t}\n+\n+\t// Sanitize rsync arguments to prevent command injection\n+\tallowedRsyncOptions := map[string]bool{\n+\t\t\"--safe-links\":   true,\n+\t\t\"--munge-links\":  true,\n+\t\t\"-a\":             true,\n+\t\t\"-r\":             true,\n+\t\t\"-l\":             true,\n+\t\t\"-p\":             true,\n+\t\t\"-t\":             true,\n+\t\t\"-g\":             true,\n+\t\t\"-o\":             true,\n+\t\t\"-D\":             true,\n+\t\t\"-P\":             true,\n+\t\t\"--progress\":     true,\n+\t\t\"-v\":             true,\n+\t\t\"-z\":             true,\n+\t\t\"--compress\":     true,\n+\t}\n+\n+\tfor _, arg := range args {\n+\t\tif strings.HasPrefix(arg, \"-\") && !allowedRsyncOptions[arg] {\n+\t\t\treturn command, fmt.Errorf(\"rsync: invalid option %q\", arg)\n+\t\t}\n+\t}\n+\n \tc.connection.Log(logger.LevelDebug, \"new system command %q, with args: %+v fs path %q quota check path %q\",\n \t\tc.command, args, fsPath, quotaPath)\n \tcmd := exec.Command(c.command, args...)\n"}
{"cve":"CVE-2022-4643:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pdf_ocr.go b/pdf_ocr.go\nindex 4d9d53a..331c86f 100644\n--- a/pdf_ocr.go\n+++ b/pdf_ocr.go\n@@ -110,16 +110,35 @@ func ConvertPDFImages(path string) (BodyResult, error) {\n \n // PdfHasImage verify if `path` (PDF) has images\n func PDFHasImage(path string) bool {\n-\tcmd := \"pdffonts -l 5 %s | tail -n +3 | cut -d' ' -f1 | sort | uniq\"\n-\tout, err := exec.Command(\"bash\", \"-c\", fmt.Sprintf(cmd, path)).Output()\n+\tcmd := exec.Command(\"pdffonts\", \"-l\", \"5\", path)\n+\toutput, err := cmd.Output()\n \tif err != nil {\n \t\tlog.Println(err)\n \t\treturn false\n \t}\n-\tif string(out) == \"\" {\n-\t\treturn true\n+\n+\tlines := strings.Split(string(output), \"\\n\")\n+\t// Skip first two lines (header)\n+\tif len(lines) < 3 {\n+\t\treturn true // No fonts detected\n \t}\n-\treturn false\n+\n+\tfonts := make(map[string]bool)\n+\tfor _, line := range lines[2:] { // Start from third line\n+\t\tif line == \"\" {\n+\t\t\tcontinue\n+\t\t}\n+\t\t// Split by whitespace and take first field\n+\t\tparts := strings.Fields(line)\n+\t\tif len(parts) == 0 {\n+\t\t\tcontinue\n+\t\t}\n+\t\tfont := parts[0]\n+\t\tfonts[font] = true\n+\t}\n+\n+\t// If no unique fonts, return true (has images)\n+\treturn len(fonts) == 0\n }\n \n func ConvertPDF(r io.Reader) (string, map[string]string, error) {\n"}
{"cve":"CVE-2023-26125:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/gin.go b/gin.go\nindex 32dae24..413062f 100644\n--- a/gin.go\n+++ b/gin.go\n@@ -668,7 +668,7 @@ func serveError(c *Context, code int, defaultMessage []byte) {\n func redirectTrailingSlash(c *Context) {\n \treq := c.Request\n \tp := req.URL.Path\n-\tif prefix := path.Clean(c.Request.Header.Get(\"X-Forwarded-Prefix\")); prefix != \".\" {\n+\tif prefix := path.Clean(c.Request.Header.Get(\"X-Forwarded-Prefix\")); prefix != \".\" && strings.HasPrefix(prefix, \"/\") {\n \t\tprefix = url.QueryEscape(prefix)\n \t\tprefix = strings.ReplaceAll(prefix, \"%2F\", \"/\")\n \n"}
{"cve":"CVE-2023-24623:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/client.go b/client.go\nindex 4f80444..f2a33c1 100644\n--- a/client.go\n+++ b/client.go\n@@ -39,6 +39,8 @@ func init() {\n \t\t\tmustParseCIDR(\"192.168.0.0/16\"), // private class C\n \t\t\tmustParseCIDR(\"192.0.2.0/24\"),   // test net 1\n \t\t\tmustParseCIDR(\"192.88.99.0/24\"), // 6to4 relay\n+\t\tmustParseCIDR(\"::1/128\"),     // IPv6 loopback\n+\t\tmustParseCIDR(\"fe80::/10\"),   // IPv6 link-local\n \t\t},\n \t\tForbiddenHosts: []*regexp.Regexp{\n \t\t\tregexp.MustCompile(`(?i)^localhost$`),\n@@ -121,7 +123,7 @@ func safeAddr(ctx context.Context, resolver *net.Resolver, hostport string, opts\n \n \tip := net.ParseIP(host)\n \tif ip != nil {\n-\t\tif ip.To4() != nil && c.isIPForbidden(ip) {\n+\t\tif c.isIPForbidden(ip) {\n \t\t\treturn \"\", fmt.Errorf(\"bad ip is detected: %v\", ip)\n \t\t}\n \t\treturn net.JoinHostPort(ip.String(), port), nil\n@@ -141,10 +143,6 @@ func safeAddr(ctx context.Context, resolver *net.Resolver, hostport string, opts\n \t}\n \tsafeAddrs := make([]net.IPAddr, 0, len(addrs))\n \tfor _, addr := range addrs {\n-\t\t// only support IPv4 address\n-\t\tif addr.IP.To4() == nil {\n-\t\t\tcontinue\n-\t\t}\n \t\tif c.isIPForbidden(addr.IP) {\n \t\t\treturn \"\", fmt.Errorf(\"bad ip is detected: %v\", addr.IP)\n \t\t}\n"}
{"cve":"CVE-2022-24825:0708", "fix_patch": "diff --git a/pkg/smokescreen/acl/v1/acl.go b/pkg/smokescreen/acl/v1/acl.go\nindex bf913c0..81f1e68 100644\n--- a/pkg/smokescreen/acl/v1/acl.go\n+++ b/pkg/smokescreen/acl/v1/acl.go\n@@ -222,13 +222,14 @@ func (acl *ACL) Rule(service string) *Rule {\n }\n \n func hostMatchesGlob(host string, domainGlob string) bool {\n+\tnormalizedHost := strings.ToLower(strings.TrimSuffix(host, \".\"))\n+\t\n \tif domainGlob != \"\" && domainGlob[0] == '*' {\n \t\tsuffix := domainGlob[1:]\n-\t\tif strings.HasSuffix(host, suffix) {\n-\t\t\treturn true\n-\t\t}\n-\t} else if domainGlob == host {\n-\t\treturn true\n+\t\tnormalizedSuffix := strings.ToLower(strings.TrimSuffix(suffix, \".\"))\n+\t\treturn strings.HasSuffix(normalizedHost, normalizedSuffix)\n \t}\n-\treturn false\n+\t\n+\tnormalizedGlob := strings.ToLower(strings.TrimSuffix(domainGlob, \".\"))\n+\treturn normalizedHost == normalizedGlob\n }\n"}
{"cve":"CVE-2021-32783:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/dag/accessors.go b/internal/dag/accessors.go\nindex 9f61e412..d3260136 100644\n--- a/internal/dag/accessors.go\n+++ b/internal/dag/accessors.go\n@@ -15,6 +15,7 @@ package dag\n \n import (\n \t\"fmt\"\n+\t\"net\"\n \t\"strconv\"\n \n \t\"github.com/projectcontour/contour/internal/annotation\"\n@@ -91,7 +92,15 @@ func externalName(svc *v1.Service) string {\n \tif svc.Spec.Type != v1.ServiceTypeExternalName {\n \t\treturn \"\"\n \t}\n-\treturn svc.Spec.ExternalName\n+\textName := svc.Spec.ExternalName\n+\t// Block IP addresses and localhost variants\n+\tif ip := net.ParseIP(extName); ip != nil {\n+\t\treturn \"\"\n+\t}\n+\tif extName == \"localhost\" || extName == \"127.0.0.1\" || extName == \"::1\" {\n+\t\treturn \"\"\n+\t}\n+\treturn extName\n }\n \n // serviceGetter is a visitor that gets all services\n"}
{"cve":"CVE-2021-3155:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cmd/snap/cmd_run.go b/cmd/snap/cmd_run.go\nindex 2895a336ab..36fbe38cc2 100644\n--- a/cmd/snap/cmd_run.go\n+++ b/cmd/snap/cmd_run.go\n@@ -400,7 +400,7 @@ func createUserDataDirs(info *snap.Info) error {\n \t\tcreateDirs = append(createDirs, snapUserDir)\n \t}\n \tfor _, d := range createDirs {\n-\t\tif err := os.MkdirAll(d, 0755); err != nil {\n+\t\tif err := os.MkdirAll(d, 0700); err != nil {\n \t\t\t// TRANSLATORS: %q is the directory whose creation failed, %v the error message\n \t\t\treturn fmt.Errorf(i18n.G(\"cannot create %q: %v\"), d, err)\n \t\t}\n"}
{"cve":"CVE-2025-29778:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/cosign/cosign.go b/pkg/cosign/cosign.go\nindex 60ca41696..f4b1fea98 100644\n--- a/pkg/cosign/cosign.go\n+++ b/pkg/cosign/cosign.go\n@@ -534,7 +534,7 @@ func extractDigest(imgRef string, payload []payload.SimpleContainerImage) (strin\n }\n \n func matchSignatures(signatures []oci.Signature, subject, subjectRegExp, issuer, issuerRegExp string, extensions map[string]string) error {\n-\tif subject == \"\" && issuer == \"\" && len(extensions) == 0 {\n+\tif subject == \"\" && subjectRegExp == \"\" && issuer == \"\" && issuerRegExp == \"\" && len(extensions) == 0 {\n \t\treturn nil\n \t}\n \n"}
{"cve":"CVE-2022-24450:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/server/consumer.go b/server/consumer.go\nindex 2a5b1039..62fa36d6 100644\n--- a/server/consumer.go\n+++ b/server/consumer.go\n@@ -2913,7 +2913,7 @@ func (o *consumer) deliverMsg(dsubj, subj string, hdr, msg []byte, seq, dc uint6\n }\n \n func (o *consumer) needFlowControl() bool {\n-\tif o.maxpb == 0 {\n+\tif o.maxpb == 0 || o.acc == nil || o.acc.Name == \"$SYS\" {\n \t\treturn false\n \t}\n \t// Decide whether to send a flow control message which we will need the user to respond.\n"}
{"cve":"CVE-2021-29417:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/pkg/gitjacker/retriever.go b/internal/pkg/gitjacker/retriever.go\nindex 3066e69..a5c83a5 100644\n--- a/internal/pkg/gitjacker/retriever.go\n+++ b/internal/pkg/gitjacker/retriever.go\n@@ -162,6 +162,18 @@ func (r *retriever) downloadFile(path string) error {\n \n \tfilePath := filepath.Join(r.outputDir, \".git\", path)\n \n+\tabsRoot, err := filepath.Abs(filepath.Join(r.outputDir, \".git\"))\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tabsFilePath, err := filepath.Abs(filePath)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\tif !strings.HasPrefix(absFilePath, absRoot) {\n+\t\treturn fmt.Errorf(\"invalid path: %s\", path)\n+\t}\n+\n \tif r.downloaded[path] {\n \t\treturn nil\n \t}\n"}
{"cve":"CVE-2021-41803:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/agent/consul/auto_config_endpoint.go b/agent/consul/auto_config_endpoint.go\nindex 088c9a3e0d..a9afc09f81 100644\n--- a/agent/consul/auto_config_endpoint.go\n+++ b/agent/consul/auto_config_endpoint.go\n@@ -5,6 +5,7 @@ import (\n \t\"crypto/x509\"\n \t\"encoding/base64\"\n \t\"fmt\"\n+\t\"regexp\"\n \n \t\"github.com/hashicorp/consul/acl\"\n \n@@ -59,6 +60,25 @@ func (a *jwtAuthorizer) Authorize(req *pbautoconf.AutoConfigRequest) (AutoConfig\n \t\treturn AutoConfigOptions{}, acl.PermissionDenied(\"Failed JWT authorization: %v\", err)\n \t}\n \n+\t// Validate node and segment names to prevent injection\n+\tif !isValidNodeName(req.Node) {\n+\t\treturn AutoConfigOptions{}, acl.PermissionDenied(\"invalid node name\")\n+\t}\n+\tif !isValidSegmentName(req.Segment) {\n+\t\treturn AutoConfigOptions{}, acl.PermissionDenied(\"invalid segment name\")\n+\t}\n+\n+\t// Validate node and segment names to prevent injection\n+\tvar nodeNameRegex = regexp.MustCompile(`^[a-zA-Z0-9_-]+$`)\n+\tif !nodeNameRegex.MatchString(req.Node) {\n+\t\treturn AutoConfigOptions{}, acl.PermissionDenied(\"invalid node name\")\n+\t}\n+\n+\tvar segmentNameRegex = regexp.MustCompile(`^[a-zA-Z0-9_-]*$`) // Allow empty\n+\tif req.Segment != \"\" && !segmentNameRegex.MatchString(req.Segment) {\n+\t\treturn AutoConfigOptions{}, acl.PermissionDenied(\"invalid segment name\")\n+\t}\n+\n \tvarMap := map[string]string{\n \t\t\"node\":      req.Node,\n \t\t\"segment\":   req.Segment,\n"}
{"cve":"CVE-2024-45388:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/core/hoverfly_funcs.go b/core/hoverfly_funcs.go\nindex 181d2f13..e8aa96f1 100644\n--- a/core/hoverfly_funcs.go\n+++ b/core/hoverfly_funcs.go\n@@ -188,12 +188,29 @@ func (hf *Hoverfly) readResponseBodyFile(filePath string) (string, error) {\n \t\treturn \"\", fmt.Errorf(\"bodyFile contains absolute path (%s). only relative is supported\", filePath)\n \t}\n \n-\tfileContents, err := ioutil.ReadFile(filepath.Join(hf.Cfg.ResponsesBodyFilesPath, filePath))\n+\tbasePath := hf.Cfg.ResponsesBodyFilesPath\n+\tabsBasePath, err := filepath.Abs(basePath)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to get absolute path of base directory: %v\", err)\n+\t}\n+\n+\tjoinedPath := filepath.Join(absBasePath, filePath)\n+\tabsJoinedPath, err := filepath.Abs(joinedPath)\n+\tif err != nil {\n+\t\treturn \"\", fmt.Errorf(\"failed to resolve absolute path: %v\", err)\n+\t}\n+\n+\t// Ensure the resolved path is within the base directory\n+\tif !strings.HasPrefix(absJoinedPath, absBasePath+string(filepath.Separator)) {\n+\t\treturn \"\", fmt.Errorf(\"bodyFile path is outside allowed directory\")\n+\t}\n+\n+\tfileContents, err := ioutil.ReadFile(absJoinedPath)\n \tif err != nil {\n \t\treturn \"\", err\n \t}\n \n-\treturn string(fileContents[:]), nil\n+\treturn string(fileContents), nil\n }\n \n func (hf *Hoverfly) applyTransitionsStateTemplating(requestDetails *models.RequestDetails, response *models.ResponseDetails, cachedResponse *models.CachedResponse) (map[string]string, error) {\n"}
{"cve":"CVE-2023-25165:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/engine/engine.go b/pkg/engine/engine.go\nindex 00494f9d7..326060979 100644\n--- a/pkg/engine/engine.go\n+++ b/pkg/engine/engine.go\n@@ -106,6 +106,7 @@ func warnWrap(warn string) string {\n // initFunMap creates the Engine's FuncMap and adds context-specific functions.\n func (e Engine) initFunMap(t *template.Template, referenceTpls map[string]renderable) {\n \tfuncMap := funcMap()\n+\tdelete(funcMap, \"getHostByName\")\n \tincludedNames := make(map[string]int)\n \n \t// Add the 'include' function here so we can close over t.\n"}
{"cve":"CVE-2021-22538:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/rbac/rbac.go b/pkg/rbac/rbac.go\nindex 18c433bd..ee2ef193 100644\n--- a/pkg/rbac/rbac.go\n+++ b/pkg/rbac/rbac.go\n@@ -76,6 +76,9 @@ func CompileAndAuthorize(actorPermission Permission, toUpdate []Permission) (Per\n \t// Ensure implied permissions. The actor must also have the implied\n \t// permissions by definition.\n \tpermission = AddImplied(permission)\n+\tif !Can(actorPermission, permission) {\n+\t\treturn 0, fmt.Errorf(\"actor does not have all implied permissions being granted\")\n+\t}\n \treturn permission, nil\n }\n \n"}
{"cve":"CVE-2023-23947:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/server/cluster/cluster.go b/server/cluster/cluster.go\nindex 2225a5d6f..0f0b1ed37 100644\n--- a/server/cluster/cluster.go\n+++ b/server/cluster/cluster.go\n@@ -221,7 +221,7 @@ func (s *Server) Update(ctx context.Context, q *cluster.ClusterUpdateRequest) (*\n \t}\n \n \t// verify that user can do update inside project where cluster is located\n-\tif err := s.enf.EnforceErr(ctx.Value(\"claims\"), rbacpolicy.ResourceClusters, rbacpolicy.ActionUpdate, createRBACObject(c.Project, q.Cluster.Server)); err != nil {\n+\tif err := s.enf.EnforceErr(ctx.Value(\"claims\"), rbacpolicy.ResourceClusters, rbacpolicy.ActionUpdate, createRBACObject(c.Project, c.Server)); err != nil {\n \t\treturn nil, err\n \t}\n \n"}
{"cve":"CVE-2023-25173:0708", "fix_patch": "diff --git a/oci/spec_opts.go b/oci/spec_opts.go\nindex 81c148627..15c040ce2 100644\n--- a/oci/spec_opts.go\n+++ b/oci/spec_opts.go\n@@ -644,6 +644,11 @@ func WithUserID(uid uint32) SpecOpts {\n \t\t\t\treturn err\n \t\t\t}\n \t\t\ts.Process.User.UID, s.Process.User.GID = uint32(user.Uid), uint32(user.Gid)\n+\tadditionalGids := make([]uint32, len(user.Groups))\n+\tfor i, g := range user.Groups {\n+\t\tadditionalGids[i] = uint32(g)\n+\t}\n+\ts.Process.User.AdditionalGids = additionalGids\n \t\t\treturn nil\n \n \t\t}\n@@ -672,6 +677,11 @@ func WithUserID(uid uint32) SpecOpts {\n \t\t\t\treturn err\n \t\t\t}\n \t\t\ts.Process.User.UID, s.Process.User.GID = uint32(user.Uid), uint32(user.Gid)\n+\tadditionalGids := make([]uint32, len(user.Groups))\n+\tfor i, g := range user.Groups {\n+\t\tadditionalGids[i] = uint32(g)\n+\t}\n+\ts.Process.User.AdditionalGids = additionalGids\n \t\t\treturn nil\n \t\t})\n \t}\n@@ -698,6 +708,11 @@ func WithUsername(username string) SpecOpts {\n \t\t\t\t\treturn err\n \t\t\t\t}\n \t\t\t\ts.Process.User.UID, s.Process.User.GID = uint32(user.Uid), uint32(user.Gid)\n+\tadditionalGids := make([]uint32, len(user.Groups))\n+\tfor i, g := range user.Groups {\n+\t\tadditionalGids[i] = uint32(g)\n+\t}\n+\ts.Process.User.AdditionalGids = additionalGids\n \t\t\t\treturn nil\n \t\t\t}\n \t\t\tif c.Snapshotter == \"\" {\n@@ -721,6 +736,11 @@ func WithUsername(username string) SpecOpts {\n \t\t\t\t\treturn err\n \t\t\t\t}\n \t\t\t\ts.Process.User.UID, s.Process.User.GID = uint32(user.Uid), uint32(user.Gid)\n+\tadditionalGids := make([]uint32, len(user.Groups))\n+\tfor i, g := range user.Groups {\n+\t\tadditionalGids[i] = uint32(g)\n+\t}\n+\ts.Process.User.AdditionalGids = additionalGids\n \t\t\t\treturn nil\n \t\t\t})\n \t\t} else if s.Windows != nil {\n"}
{"cve":"CVE-2022-36103:0708", "fix_patch": "diff --git a/internal/app/trustd/internal/reg/reg.go b/internal/app/trustd/internal/reg/reg.go\nindex ed5fd6960..293a55552 100644\n--- a/internal/app/trustd/internal/reg/reg.go\n+++ b/internal/app/trustd/internal/reg/reg.go\n@@ -39,8 +39,41 @@ func (r *Registrator) Certificate(ctx context.Context, in *securityapi.Certifica\n \t\treturn nil, err\n \t}\n \n-\t// TODO: Verify that the request is coming from the IP addresss declared in\n-\t// the CSR.\n+\t// Get client IP from gRPC context\n+\tpeerInfo, ok := peer.FromContext(ctx)\n+\tif !ok {\n+\t\treturn nil, errors.New(\"failed to retrieve peer information\")\n+\t}\n+\n+\tclientIP, _, err := net.SplitHostPort(peerInfo.Addr.String())\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"failed to parse client address: %w\", err)\n+\t}\n+\n+\t// Parse CSR to extract IP SANs\n+\tcsr, err := x509.ParseCertificateRequest(in.Csr)\n+\tif err != nil {\n+\t\treturn nil, fmt.Errorf(\"failed to parse CSR: %w\", err)\n+\t}\n+\n+\t// Validate client IP matches one of the CSR's IP SANs\n+\tclientIPAddr := net.ParseIP(clientIP)\n+\tif clientIPAddr == nil {\n+\t\treturn nil, fmt.Errorf(\"invalid client IP address: %s\", clientIP)\n+\t}\n+\n+\tfound := false\n+\tfor _, sanIP := range csr.IPAddresses {\n+\t\tif sanIP.Equal(clientIPAddr) {\n+\t\t\tfound = true\n+\t\t\tbreak\n+\t\t}\n+\t}\n+\n+\tif !found {\n+\t\treturn nil, fmt.Errorf(\"client IP %s not authorized in CSR\", clientIP)\n+\t}\n+\n \tsigned, err := x509.NewCertificateFromCSRBytes(osRoot.TypedSpec().CA.Crt, osRoot.TypedSpec().CA.Key, in.Csr)\n \tif err != nil {\n \t\treturn\n"}
{"cve":"CVE-2023-22480:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/router/v1/v1api.go b/pkg/router/v1/v1api.go\nindex 1a3b9cbc1..db97ee24f 100644\n--- a/pkg/router/v1/v1api.go\n+++ b/pkg/router/v1/v1api.go\n@@ -67,7 +67,7 @@ func V1(parent iris.Party) {\n \tmvc.New(AuthScope.Party(\"/user/messages\")).HandleError(ErrorHandler).Handle(controller.NewUserMsgController())\n \tmvc.New(AuthScope.Party(\"/user/settings\")).HandleError(ErrorHandler).Handle(controller.NewUserSettingController())\n \tWhiteScope = v1.Party(\"/\")\n-\tWhiteScope.Get(\"/clusters/kubeconfig/{name}\", downloadKubeconfig)\n+\tAuthScope.Get(\"/clusters/kubeconfig/{name}\", downloadKubeconfig)\n \tWhiteScope.Get(\"/captcha\", generateCaptcha)\n \tmvc.New(WhiteScope.Party(\"/theme\")).HandleError(ErrorHandler).Handle(controller.NewThemeController())\n \n"}
{"cve":"CVE-2022-36009:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/eventcontent.go b/eventcontent.go\nindex 5f9ba63..2fba999 100644\n--- a/eventcontent.go\n+++ b/eventcontent.go\n@@ -431,7 +431,7 @@ func NewPowerLevelContentFromEvent(event *Event) (c PowerLevelContent, err error\n \t\t\tUsersDefaultLevel  levelJSONValue            `json:\"users_default\"`\n \t\t\tEventLevels        map[string]levelJSONValue `json:\"events\"`\n \t\t\tStateDefaultLevel  levelJSONValue            `json:\"state_default\"`\n-\t\t\tEventDefaultLevel  levelJSONValue            `json:\"event_default\"`\n+\t\t\tEventDefaultLevel  levelJSONValue            `json:\"events_default\"`\n \t\t\tNotificationLevels map[string]levelJSONValue `json:\"notifications\"`\n \t\t}\n \t\tif err = json.Unmarshal(event.Content(), &content); err != nil {\n"}
{"cve":"CVE-2021-32701:0708", "fix_patch": ""}
{"cve":"CVE-2021-21411:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/providers/gitlab.go b/providers/gitlab.go\nindex eb7c2ffa..be897451 100644\n--- a/providers/gitlab.go\n+++ b/providers/gitlab.go\n@@ -296,7 +296,7 @@ func (p *GitLabProvider) EnrichSession(ctx context.Context, s *sessions.SessionS\n \ts.User = userInfo.Username\n \ts.Email = userInfo.Email\n \n-\tp.addGroupsToSession(ctx, s)\n+\tp.addGroupsToSession(ctx, s, userInfo.Groups)\n \n \tp.addProjectsToSession(ctx, s)\n \n@@ -305,9 +305,8 @@ func (p *GitLabProvider) EnrichSession(ctx context.Context, s *sessions.SessionS\n }\n \n // addGroupsToSession projects into session.Groups\n-func (p *GitLabProvider) addGroupsToSession(ctx context.Context, s *sessions.SessionState) {\n-\t// Iterate over projects, check if oauth2-proxy can get project information on behalf of the user\n-\tfor _, group := range p.Groups {\n+func (p *GitLabProvider) addGroupsToSession(ctx context.Context, s *sessions.SessionState, userGroups []string) {\n+\tfor _, group := range userGroups {\n \t\ts.Groups = append(s.Groups, fmt.Sprintf(\"group:%s\", group))\n \t}\n }\n"}
{"cve":"CVE-2022-35936:0708", "fix_patch": "diff --git a/x/evm/keeper/statedb.go b/x/evm/keeper/statedb.go\nindex a70d1427..ad0807ce 100644\n--- a/x/evm/keeper/statedb.go\n+++ b/x/evm/keeper/statedb.go\n@@ -197,10 +197,6 @@ func (k *Keeper) DeleteAccount(ctx sdk.Context, addr common.Address) error {\n \t}\n \n \t// remove code\n-\tcodeHashBz := ethAcct.GetCodeHash().Bytes()\n-\tif !bytes.Equal(codeHashBz, types.EmptyCodeHash) {\n-\t\tk.SetCode(ctx, codeHashBz, nil)\n-\t}\n \n \t// clear storage\n \tk.ForEachStorage(ctx, addr, func(key, _ common.Hash) bool {\n"}
{"cve":"CVE-2022-23542:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/server/commands/check_utils.go b/server/commands/check_utils.go\nindex 2b1651e4..5515c57b 100644\n--- a/server/commands/check_utils.go\n+++ b/server/commands/check_utils.go\n@@ -336,16 +336,7 @@ func (rc *resolutionContext) fork(tk *openfgapb.TupleKey, tracer resolutionTrace\n }\n \n func (rc *resolutionContext) readUserTuple(ctx context.Context, backend storage.TupleBackend) (*openfgapb.TupleKey, error) {\n-\ttk, ok := rc.contextualTuples.ReadUserTuple(rc.tk)\n-\tif ok {\n-\t\treturn tk, nil\n-\t}\n-\n-\ttuple, err := backend.ReadUserTuple(ctx, rc.store, rc.tk)\n-\tif err != nil {\n-\t\treturn nil, err\n-\t}\n-\treturn tuple.GetKey(), nil\n+\treturn backend.ReadUserTuple(ctx, rc.store, rc.tk)\n }\n \n func (rc *resolutionContext) readUsersetTuples(ctx context.Context, backend storage.TupleBackend) (storage.TupleKeyIterator, error) {\n"}
{"cve":"CVE-2024-1724:0708", "fix_patch": "diff --git a/interfaces/builtin/home.go b/interfaces/builtin/home.go\nindex 998ca254f0..59ac96e4ec 100644\n--- a/interfaces/builtin/home.go\n+++ b/interfaces/builtin/home.go\n@@ -54,6 +54,10 @@ const homeConnectedPlugAppArmor = `\n # Allow read access to toplevel $HOME for the user\n owner @{HOME}/ r,\n \n+# Disallow writes to the well-known directory included in\n+# the user's PATH on several distributions\n+audit deny @{HOME}/bin/{,**} wl,\n+\n # Allow read/write access to all files in @{HOME}, except snap application\n # data in @{HOME}/snap and toplevel hidden directories in @{HOME}.\n owner @{HOME}/[^s.]**             rwkl###HOME_IX###,\n"}
{"cve":"CVE-2023-22736:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/controller/appcontroller.go b/controller/appcontroller.go\nindex a989c5a16..de3d514f7 100644\n--- a/controller/appcontroller.go\n+++ b/controller/appcontroller.go\n@@ -1775,10 +1775,15 @@ func (ctrl *ApplicationController) canProcessApp(obj interface{}) bool {\n \t}\n \tif ctrl.clusterFilter != nil {\n \t\tcluster, err := ctrl.db.GetCluster(context.Background(), app.Spec.Destination.Server)\n+\t\tvar allowedByCluster bool\n \t\tif err != nil {\n-\t\t\treturn ctrl.clusterFilter(nil)\n+\t\t\tallowedByCluster = ctrl.clusterFilter(nil)\n+\t\t} else {\n+\t\t\tallowedByCluster = ctrl.clusterFilter(cluster)\n+\t\t}\n+\t\tif !allowedByCluster {\n+\t\t\treturn false\n \t\t}\n-\t\treturn ctrl.clusterFilter(cluster)\n \t}\n \n \t// Only process given app if it exists in a watched namespace, or in the\n"}
{"cve":"CVE-2020-8559:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go b/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\nindex 17cbad90f74..ef65ba97c3f 100644\n--- a/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\n+++ b/staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go\n@@ -279,7 +279,7 @@ func (h *UpgradeAwareHandler) tryUpgrade(w http.ResponseWriter, req *http.Reques\n \tutilnet.AppendForwardedForHeader(clone)\n \tif h.InterceptRedirects {\n \t\tklog.V(6).Infof(\"Connecting to backend proxy (intercepting redirects) %s\\n  Headers: %v\", &location, clone.Header)\n-\t\tbackendConn, rawResponse, err = utilnet.ConnectWithRedirects(req.Method, &location, clone.Header, req.Body, utilnet.DialerFunc(h.DialForUpgrade), h.RequireSameHostRedirects)\n+\t\tbackendConn, rawResponse, err = utilnet.ConnectWithRedirects(req.Method, &location, clone.Header, req.Body, utilnet.DialerFunc(h.DialForUpgrade), true)\n \t} else {\n \t\tklog.V(6).Infof(\"Connecting to backend proxy (direct dial) %s\\n  Headers: %v\", &location, clone.Header)\n \t\tclone.URL = &location\n"}
{"cve":"CVE-2023-5122:0708", "fix_patch": "diff --git a/pkg/http_storage.go b/pkg/http_storage.go\nindex 1434126..08b5287 100644\n--- a/pkg/http_storage.go\n+++ b/pkg/http_storage.go\n@@ -81,7 +81,11 @@ func (c *httpStorage) Stat() error {\n }\n \n func newRequestFromQuery(settings *backend.DataSourceInstanceSettings, customSettings dataSourceSettings, query dataSourceQuery) (*http.Request, error) {\n-\tu, err := url.Parse(settings.URL + query.Path)\n+\tbaseURL, err := url.Parse(settings.URL)\n+\tif err != nil {\n+\t\treturn nil, err\n+\t}\n+\tu := baseURL.ResolveReference(&url.URL{Path: query.Path})\n \tif err != nil {\n \t\treturn nil, err\n \t}\n"}
{"cve":"CVE-2022-46146:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/web/handler.go b/web/handler.go\nindex ae3ebc0..36146de 100644\n--- a/web/handler.go\n+++ b/web/handler.go\n@@ -113,7 +113,7 @@ func (u *webHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n \t\t\thashedPassword = \"$2y$10$QOauhQNbBCuQDKes6eFzPeMqBSjb7Mr5DUmpZ/VcEd00UAV/LDeSi\"\n \t\t}\n \n-\t\tcacheKey := hex.EncodeToString(append(append([]byte(user), []byte(hashedPassword)...), []byte(pass)...))\n+\t\tcacheKey := hex.EncodeToString([]byte(user + \":\" + hashedPassword))\n \t\tauthOk, ok := u.cache.get(cacheKey)\n \n \t\tif !ok {\n"}
{"cve":"CVE-2022-31145:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/auth/authzserver/resource_server.go b/auth/authzserver/resource_server.go\nindex 78e89529..ef19bf4e 100644\n--- a/auth/authzserver/resource_server.go\n+++ b/auth/authzserver/resource_server.go\n@@ -11,6 +11,7 @@ import (\n \t\"strings\"\n \n \t\"k8s.io/apimachinery/pkg/util/sets\"\n+\t\"time\"\n \n \t\"github.com/flyteorg/flytestdlib/config\"\n \n@@ -38,6 +39,17 @@ func (r ResourceServer) ValidateAccessToken(ctx context.Context, expectedAudienc\n \t\treturn nil, fmt.Errorf(\"failed to unmarshal user info claim into UserInfo type. Error: %w\", err)\n \t}\n \n+\t// Check token expiration\n+\texp, ok := claimsRaw[\"exp\"].(float64)\n+\tif !ok {\n+\t\treturn nil, fmt.Errorf(\"token missing or invalid expiration claim\")\n+\t}\n+\n+\texpirationTime := time.Unix(int64(exp), 0)\n+\tif time.Now().After(expirationTime) {\n+\t\treturn nil, fmt.Errorf(\"token has expired\")\n+\t}\n+\n \treturn verifyClaims(sets.NewString(append(r.allowedAudience, expectedAudience)...), claimsRaw)\n }\n \n"}
{"cve":"CVE-2021-26921:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/util/session/sessionmanager.go b/util/session/sessionmanager.go\nindex 2bd99f9fd..248e27fee 100644\n--- a/util/session/sessionmanager.go\n+++ b/util/session/sessionmanager.go\n@@ -283,7 +283,11 @@ func (mgr *SessionManager) Parse(tokenString string) (jwt.Claims, error) {\n \t\treturn nil, err\n \t}\n \n-\tif id := jwtutil.StringField(claims, \"jti\"); id != \"\" && account.TokenIndex(id) == -1 {\n+\tif !account.Enabled {\n+    return nil, fmt.Errorf(\"Account %s is disabled\", subject)\n+}\n+\n+if id := jwtutil.StringField(claims, \"jti\"); id != \"\" && account.TokenIndex(id) == -1 {\n \t\treturn nil, fmt.Errorf(\"account %s does not have token with id %s\", subject, id)\n \t}\n \n"}
{"cve":"CVE-2025-46331:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/internal/graph/cached_resolver.go b/internal/graph/cached_resolver.go\nindex 2e7e02cc..67977f9f 100644\n--- a/internal/graph/cached_resolver.go\n+++ b/internal/graph/cached_resolver.go\n@@ -195,7 +195,7 @@ func (c *CachedCheckResolver) ResolveCheck(\n \n func BuildCacheKey(req ResolveCheckRequest) string {\n \ttup := tuple.From(req.GetTupleKey())\n-\tcacheKeyString := tup.String() + req.GetInvariantCacheKey()\n+\tcacheKeyString := tup.String() + req.GetAuthorizationModelID() + req.GetInvariantCacheKey()\n \n \thasher := xxhash.New()\n \n"}
{"cve":"CVE-2025-24976:0708", "fix_patch": "diff --git a/registry/auth/token/token.go b/registry/auth/token/token.go\nindex 55d0b7f6..06408051 100644\n--- a/registry/auth/token/token.go\n+++ b/registry/auth/token/token.go\n@@ -219,9 +219,13 @@ func verifyJWK(header jose.Header, verifyOpts VerifyOptions) (signingKey crypto.\n \t// Check to see if the key includes a certificate chain.\n \tif len(jwk.Certificates) == 0 {\n \t\t// The JWK should be one of the trusted root keys.\n-\t\tif _, trusted := verifyOpts.TrustedKeys[jwk.KeyID]; !trusted {\n+\t\ttrustedKey, trusted := verifyOpts.TrustedKeys[jwk.KeyID]\n+\t\tif !trusted {\n \t\t\treturn nil, errors.New(\"untrusted JWK with no certificate chain\")\n \t\t}\n+\t\tif !trustedKey.Equal(jwk.Key) {\n+\t\t\treturn nil, errors.New(\"JWK key material does not match trusted key\")\n+\t\t}\n \t\t// The JWK is one of the trusted keys.\n \t\treturn\n \t}\n"}
{"cve":"CVE-2022-24738:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/x/claims/keeper/ibc_callbacks.go b/x/claims/keeper/ibc_callbacks.go\nindex 5a27b235..1873b328 100644\n--- a/x/claims/keeper/ibc_callbacks.go\n+++ b/x/claims/keeper/ibc_callbacks.go\n@@ -59,48 +59,18 @@ func (k Keeper) OnRecvPacket(\n \t\t)\n \t}\n \n-\tsenderClaimsRecord, senderRecordFound := k.GetClaimsRecord(ctx, sender)\n \trecipientClaimsRecord, recipientRecordFound := k.GetClaimsRecord(ctx, recipient)\n \n-\t// handle the 4 cases for the recipient and sender claim records\n-\n-\tswitch {\n-\tcase senderRecordFound && recipientRecordFound:\n-\t\t// 1. Both sender and recipient have a claims record\n-\t\t// Merge sender's record with the recipient's record and\n-\t\t// claim actions that have been completed by one or the other\n-\t\trecipientClaimsRecord, err = k.MergeClaimsRecords(ctx, recipient, senderClaimsRecord, recipientClaimsRecord, params)\n+\t// Only process if recipient has an existing claims record\n+\tif recipientRecordFound {\n+\t\t// Claim IBC transfer action for recipient\n+\t\t_, err = k.ClaimCoinsForAction(ctx, recipient, recipientClaimsRecord, types.ActionIBCTransfer, params)\n \t\tif err != nil {\n \t\t\treturn channeltypes.NewErrorAcknowledgement(err.Error())\n \t\t}\n-\n-\t\t// update the recipient's record with the new merged one, while deleting the\n-\t\t// sender's record\n-\t\tk.SetClaimsRecord(ctx, recipient, recipientClaimsRecord)\n-\t\tk.DeleteClaimsRecord(ctx, sender)\n-\tcase senderRecordFound && !recipientRecordFound:\n-\t\t// 2. Only the sender has a claims record.\n-\t\t// Migrate the sender record to the recipient address\n-\t\tk.SetClaimsRecord(ctx, recipient, senderClaimsRecord)\n-\t\tk.DeleteClaimsRecord(ctx, sender)\n-\n-\t\t// claim IBC action\n-\t\t_, err = k.ClaimCoinsForAction(ctx, recipient, senderClaimsRecord, types.ActionIBCTransfer, params)\n-\tcase !senderRecordFound && recipientRecordFound:\n-\t\t// 3. Only the recipient has a claims record.\n-\t\t// Only claim IBC transfer action\n-\t\t_, err = k.ClaimCoinsForAction(ctx, recipient, recipientClaimsRecord, types.ActionIBCTransfer, params)\n-\tcase !senderRecordFound && !recipientRecordFound:\n-\t\t// 4. Neither the sender or recipient have a claims record.\n-\t\t// Perform a no-op by returning the  original success acknowledgement\n-\t\treturn ack\n-\t}\n-\n-\tif err != nil {\n-\t\treturn channeltypes.NewErrorAcknowledgement(err.Error())\n \t}\n \n-\t// return the original success acknowledgement\n+\t// Return original success acknowledgement\n \treturn ack\n }\n \n"}
{"cve":"CVE-2022-31130:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000000..5227fa9a7c9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pkg/util/proxyutil/reverse_proxy.go b/pkg/util/proxyutil/reverse_proxy.go\nindex 3ce5d3b4011..5917e6938da 100644\n--- a/pkg/util/proxyutil/reverse_proxy.go\n+++ b/pkg/util/proxyutil/reverse_proxy.go\n@@ -69,9 +69,11 @@ func wrapDirector(d func(*http.Request)) func(req *http.Request) {\n \t\td(req)\n \t\tPrepareProxyRequest(req)\n \n-\t\t// Clear Origin and Referer to avoid CORS issues\n+\t\t// Clear sensitive headers to prevent credential leakage\n \t\treq.Header.Del(\"Origin\")\n \t\treq.Header.Del(\"Referer\")\n+\treq.Header.Del(\"Authorization\")\n+\treq.Header.Del(\"X-API-Key\")\n \t}\n }\n \n"}
{"cve":"CVE-2022-23538:0708", "fix_patch": ""}
{"cve":"CVE-2024-47616:0708", "fix_patch": ""}
{"cve":"CVE-2024-24747:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cmd/admin-handlers-users.go b/cmd/admin-handlers-users.go\nindex 1d9f2a5b1..8089a34d6 100644\n--- a/cmd/admin-handlers-users.go\n+++ b/cmd/admin-handlers-users.go\n@@ -23,6 +23,7 @@ import (\n \t\"encoding/json\"\n \t\"errors\"\n \t\"fmt\"\n+\t\"strings\"\n \t\"io\"\n \t\"net/http\"\n \t\"os\"\n"}
{"cve":"CVE-2024-39330:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/core/files/storage/base.py b/django/core/files/storage/base.py\nindex 16ac22f70a..8218fc9bfc 100644\n--- a/django/core/files/storage/base.py\n+++ b/django/core/files/storage/base.py\n@@ -35,9 +35,9 @@ class Storage:\n             content = File(content, name)\n \n         name = self.get_available_name(name, max_length=max_length)\n-        name = self._save(name, content)\n         # Ensure that the name returned from the storage system is still valid.\n         validate_file_name(name, allow_relative_path=True)\n+        name = self._save(name, content)\n         return name\n \n     # These methods are part of the public API, with default implementations.\n"}
{"cve":"CVE-2021-35042:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 7a16d4889a..dfccdf5206 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -1898,14 +1898,10 @@ class Query(BaseExpression):\n         for item in ordering:\n             if isinstance(item, str):\n                 if '.' in item:\n-                    warnings.warn(\n-                        'Passing column raw column aliases to order_by() is '\n-                        'deprecated. Wrap %r in a RawSQL expression before '\n-                        'passing it to order_by().' % item,\n-                        category=RemovedInDjango40Warning,\n-                        stacklevel=3,\n+                    raise ValueError(\n+                        'Cannot use column aliases with dots in order_by(). '\n+                        'Use RawSQL for database-level expressions.'\n                     )\n-                    continue\n                 if item == '?':\n                     continue\n                 if item.startswith('-'):\n"}
{"cve":"CVE-2021-33203:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/contrib/admindocs/views.py b/django/contrib/admindocs/views.py\nindex bd566cde40..2d68f4aeae 100644\n--- a/django/contrib/admindocs/views.py\n+++ b/django/contrib/admindocs/views.py\n@@ -329,14 +329,17 @@ class TemplateDetailView(BaseAdminDocsView):\n         else:\n             # This doesn't account for template loaders (#24128).\n             for index, directory in enumerate(default_engine.dirs):\n-                template_file = Path(directory) / template\n-                if template_file.exists():\n-                    template_contents = template_file.read_text()\n+                dir_path = Path(directory).resolve()\n+                template_file = (dir_path / template).resolve()\n+                if template_file.is_relative_to(dir_path):\n+                    exists = template_file.exists()\n+                    template_contents = template_file.read_text() if exists else ''\n                 else:\n+                    exists = False\n                     template_contents = ''\n                 templates.append({\n                     'file': template_file,\n-                    'exists': template_file.exists(),\n+                    'exists': exists,\n                     'contents': template_contents,\n                     'order': index,\n                 })\n"}
{"cve":"CVE-2022-28347:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/db/backends/postgresql/operations.py b/django/db/backends/postgresql/operations.py\nindex 1cb6050bc5..b6e20d7e82 100644\n--- a/django/db/backends/postgresql/operations.py\n+++ b/django/db/backends/postgresql/operations.py\n@@ -293,10 +293,16 @@ class DatabaseOperations(BaseDatabaseOperations):\n         if format:\n             extra[\"FORMAT\"] = format\n         if options:\n+            # Only allow valid PostgreSQL EXPLAIN options\n+            allowed_options = {'ANALYZE', 'VERBOSE', 'COSTS', 'BUFFERS', 'TIMING', 'FORMAT', 'SUMMARY', 'SETTINGS'}\n+            filtered_options = {\n+                name: value for name, value in options.items()\n+                if name.upper() in allowed_options\n+            }\n             extra.update(\n                 {\n                     name.upper(): \"true\" if value else \"false\"\n-                    for name, value in options.items()\n+                    for name, value in filtered_options.items()\n                 }\n             )\n         if extra:\n"}
{"cve":"CVE-2017-7233:0708", "fix_patch": ""}
{"cve":"CVE-2021-3281:0708", "fix_patch": "diff --git a/django/utils/archive.py b/django/utils/archive.py\nindex 235809f2ad..6c2ec81731 100644\n--- a/django/utils/archive.py\n+++ b/django/utils/archive.py\n@@ -156,6 +156,10 @@ class TarArchive(BaseArchive):\n             if leading:\n                 name = self.split_leading_dir(name)[1]\n             filename = os.path.join(to_path, name)\n+            abs_filename = os.path.abspath(filename)\n+            abs_to_path = os.path.abspath(to_path)\n+            if not abs_filename.startswith(abs_to_path + os.sep):\n+                continue\n             if member.isdir():\n                 if filename:\n                     os.makedirs(filename, exist_ok=True)\n@@ -199,6 +203,10 @@ class ZipArchive(BaseArchive):\n             if leading:\n                 name = self.split_leading_dir(name)[1]\n             filename = os.path.join(to_path, name)\n+            abs_filename = os.path.abspath(filename)\n+            abs_to_path = os.path.abspath(to_path)\n+            if not abs_filename.startswith(abs_to_path + os.sep):\n+                continue\n             if filename.endswith(('/', '\\\\')):\n                 # A directory\n                 os.makedirs(filename, exist_ok=True)\n"}
{"cve":"CVE-2018-14574:0708", "fix_patch": ""}
{"cve":"CVE-2021-45452:0708", "fix_patch": "diff --git a/django/core/files/storage.py b/django/core/files/storage.py\nindex 89faa626e6..438a06c47c 100644\n--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -47,6 +47,8 @@ class Storage:\n         if name is None:\n             name = content.name\n \n+        name = self.generate_filename(name)\n+\n         if not hasattr(content, 'chunks'):\n             content = File(content, name)\n \n"}
{"cve":"CVE-2015-8213:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/django/utils/formats.py b/django/utils/formats.py\nindex d2bdda458e..81097bf630 100644\n--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -92,6 +92,16 @@ def get_format(format_type, lang=None, use_l10n=None):\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n     format_type = force_str(format_type)\n+    allowed_formats = {\n+        'DATE_FORMAT', 'TIME_FORMAT', 'DATETIME_FORMAT',\n+        'YEAR_MONTH_FORMAT', 'MONTH_DAY_FORMAT',\n+        'SHORT_DATE_FORMAT', 'SHORT_DATETIME_FORMAT',\n+        'FIRST_DAY_OF_WEEK',\n+        'DATE_INPUT_FORMATS', 'TIME_INPUT_FORMATS', 'DATETIME_INPUT_FORMATS',\n+        'DECIMAL_SEPARATOR', 'THOUSAND_SEPARATOR', 'NUMBER_GROUPING'\n+    }\n+    if format_type not in allowed_formats:\n+        raise ValueError(f\"Invalid format type: {format_type}\")\n     if use_l10n or (use_l10n is None and settings.USE_L10N):\n         if lang is None:\n             lang = get_language()\n"}
{"cve":"CVE-2022-21699:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/IPython/core/application.py b/IPython/core/application.py\nindex e93a10647..2b389a686 100644\n--- a/IPython/core/application.py\n+++ b/IPython/core/application.py\n@@ -157,7 +157,7 @@ def _config_file_name_changed(self, change):\n     config_file_paths = List(Unicode())\n     @default('config_file_paths')\n     def _config_file_paths_default(self):\n-        return [os.getcwd()]\n+        return []\n \n     extra_config_file = Unicode(\n     help=\"\"\"Path to an extra config file to load.\ndiff --git a/IPython/core/profileapp.py b/IPython/core/profileapp.py\nindex 97434e3d0..4591dc04c 100644\n--- a/IPython/core/profileapp.py\n+++ b/IPython/core/profileapp.py\n@@ -178,11 +178,6 @@ def list_profile_dirs(self):\n             print(\"Available profiles in %s:\" % self.ipython_dir)\n             self._print_profiles(profiles)\n         \n-        profiles = list_profiles_in(os.getcwd())\n-        if profiles:\n-            print()\n-            print(\"Available profiles in current directory (%s):\" % os.getcwd())\n-            self._print_profiles(profiles)\n         \n         print()\n         print(\"To use any of the above profiles, start IPython with:\")\ndiff --git a/IPython/core/profiledir.py b/IPython/core/profiledir.py\nindex 756595adb..5d6d9e8df 100644\n--- a/IPython/core/profiledir.py\n+++ b/IPython/core/profiledir.py\n@@ -200,7 +200,7 @@ def find_profile_dir_by_name(cls, ipython_dir, name=u'default', config=None):\n             will be \"profile_<profile>\".\n         \"\"\"\n         dirname = u'profile_' + name\n-        paths = [os.getcwd(), ipython_dir]\n+        paths = [ipython_dir]\n         for p in paths:\n             profile_dir = os.path.join(p, dirname)\n             if os.path.isdir(profile_dir):\n"}
{"cve":"CVE-2023-34233:0708", "fix_patch": ""}
{"cve":"CVE-2022-21683:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/wagtail/admin/views/pages/edit.py b/wagtail/admin/views/pages/edit.py\nindex 2edf11b450..3c6af8b6b4 100644\n--- a/wagtail/admin/views/pages/edit.py\n+++ b/wagtail/admin/views/pages/edit.py\n@@ -181,20 +181,6 @@ class EditView(TemplateResponseMixin, ContextMixin, HookResponseMixin, View):\n                 ]\n             })\n \n-        return send_notification(global_recipient_users, 'updated_comments', {\n-            'page': self.page,\n-            'editor': self.request.user,\n-            'new_comments': changes['new_comments'],\n-            'resolved_comments': changes['resolved_comments'],\n-            'deleted_comments': changes['deleted_comments'],\n-            'replied_comments': [\n-                {\n-                    'comment': comment,\n-                    'replies': replies,\n-                }\n-                for comment, replies in changes['new_replies']\n-            ]\n-        })\n \n     def log_commenting_changes(self, changes, revision):\n         \"\"\"\n"}
{"cve":"CVE-2024-23334:0708", "fix_patch": "diff --git a/aiohttp/web_urldispatcher.py b/aiohttp/web_urldispatcher.py\nindex fee4f61a1..52b447fff 100644\n--- a/aiohttp/web_urldispatcher.py\n+++ b/aiohttp/web_urldispatcher.py\n@@ -575,8 +575,7 @@ class StaticResource(PrefixResource):\n         if append_version:\n             try:\n                 filepath = self._directory.joinpath(filename).resolve()\n-                if not self._follow_symlinks:\n-                    filepath.relative_to(self._directory)\n+                filepath.relative_to(self._directory)\n             except (ValueError, FileNotFoundError):\n                 # ValueError for case when path point to symlink\n                 # with follow_symlinks is False\n@@ -641,8 +640,7 @@ class StaticResource(PrefixResource):\n                 # where the static dir is totally different\n                 raise HTTPForbidden()\n             filepath = self._directory.joinpath(filename).resolve()\n-            if not self._follow_symlinks:\n-                filepath.relative_to(self._directory)\n+            filepath.relative_to(self._directory)\n         except (ValueError, FileNotFoundError) as error:\n             # relatively safe\n             raise HTTPNotFound() from error\n"}
{"cve":"CVE-2022-37109:0708", "fix_patch": ""}
{"cve":"CVE-2023-49736:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/superset/jinja_context.py b/superset/jinja_context.py\nindex 4bb0b91a4e..0967d45e5b 100644\n--- a/superset/jinja_context.py\n+++ b/superset/jinja_context.py\n@@ -397,7 +397,7 @@ def validate_template_context(\n     return validate_context_types(context)\n \n \n-def where_in(values: list[Any], mark: str = \"'\") -> str:\n+def where_in(values: list[Any]) -> str:\n     \"\"\"\n     Given a list of values, build a parenthesis list suitable for an IN expression.\n \n@@ -405,7 +405,7 @@ def where_in(values: list[Any], mark: str = \"'\") -> str:\n         (1, 'b', 3)\n \n     \"\"\"\n-\n+    mark = \"'\"\n     def quote(value: Any) -> str:\n         if isinstance(value, str):\n             value = value.replace(mark, mark * 2)\n"}
{"cve":"CVE-2024-39877:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/airflow/models/dag.py b/airflow/models/dag.py\nindex 560d05b548..75c6b70733 100644\n--- a/airflow/models/dag.py\n+++ b/airflow/models/dag.py\n@@ -774,9 +774,7 @@ class DAG(LoggingMixin):\n \n         env = self.get_template_env(force_sandboxed=True)\n \n-        if not doc_md.endswith(\".md\"):\n-            template = jinja2.Template(doc_md)\n-        else:\n+        if doc_md.endswith(\".md\"):\n             try:\n                 template = env.get_template(doc_md)\n             except jinja2.exceptions.TemplateNotFound:\n@@ -784,8 +782,9 @@ class DAG(LoggingMixin):\n                 # Templating Error!\n                 Not able to find the template file: `{doc_md}`.\n                 \"\"\"\n-\n-        return template.render()\n+            return template.render()\n+        else:\n+            return doc_md\n \n     def _check_schedule_interval_matches_timetable(self) -> bool:\n         \"\"\"\n"}
{"cve":"CVE-2023-33977:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/tcms/kiwi_attachments/validators.py b/tcms/kiwi_attachments/validators.py\nindex 696a1439..e46caa6e 100644\n--- a/tcms/kiwi_attachments/validators.py\n+++ b/tcms/kiwi_attachments/validators.py\n@@ -3,9 +3,13 @@ from django.utils.translation import gettext_lazy as _\n \n \n def deny_uploads_containing_script_tag(uploaded_file):\n+    buffer = b\"\"\n     for chunk in uploaded_file.chunks(2048):\n-        if chunk.lower().find(b\"<script\") > -1:\n+        combined = buffer + chunk.lower()\n+        if b\"<script\" in combined:\n             raise ValidationError(_(\"File contains forbidden <script> tag\"))\n+        # Keep the last 6 characters to check for split tags across chunks\n+        buffer = combined[-6:] if len(combined) >= 6 else combined\n \n \n def deny_uploads_ending_in_dot_exe(uploaded_file):\n"}
{"cve":"CVE-2022-31506:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/opendiamond/dataretriever/diamond_store.py b/opendiamond/dataretriever/diamond_store.py\nindex 0bcb1160..eeb9491f 100644\n--- a/opendiamond/dataretriever/diamond_store.py\n+++ b/opendiamond/dataretriever/diamond_store.py\n@@ -17,6 +17,7 @@ from xml.sax.saxutils import quoteattr\n from flask import Blueprint, url_for, Response, stream_with_context, send_file, \\\n     jsonify\n from werkzeug.datastructures import Headers\n+from werkzeug.utils import safe_join\n \n from opendiamond.dataretriever.util import ATTR_SUFFIX\n \n@@ -120,7 +121,7 @@ def _get_object_src_uri(object_path):\n \n \n def _get_obj_absolute_path(obj_path):\n-    return os.path.join(DATAROOT, obj_path)\n+    return safe_join(DATAROOT, obj_path)\n \n \n def _get_index_absolute_path(index):\n"}
{"cve":"CVE-2019-7539:0708", "fix_patch": "diff --git a/ipycache.py b/ipycache.py\nindex 74a4fe5..706deb9 100644\n--- a/ipycache.py\n+++ b/ipycache.py\n@@ -72,16 +72,10 @@ except ImportError:\n def conditional_eval(var, variables):\n     \"\"\"\n     Evaluates the variable string if it starts with $.\n-    If the variable string contains one or several {code} statements, the code\n-    is executed and the result stringified (wrapped in str()) into the rest of\n-    the string.\n     \"\"\"\n     if var[0] == '$':\n         return variables.get(var[1:], var)\n-    def evalfun(x):\n-        code=x.group(0)[1:-1]\n-        return str(eval(code, variables))\n-    return re.sub(r'{.*?}', evalfun, var, flags=re.DOTALL)\n+    return var\n \n def clean_var(var):\n     \"\"\"Clean variable name, removing accidental commas, etc.\"\"\"\n"}
{"cve":"CVE-2025-23042:0708", "fix_patch": "diff --git a/gradio/utils.py b/gradio/utils.py\nindex 080a3d118..5d98db279 100644\n--- a/gradio/utils.py\n+++ b/gradio/utils.py\n@@ -1513,13 +1513,13 @@ def is_allowed_file(\n     bool, Literal[\"in_blocklist\", \"allowed\", \"created\", \"not_created_or_allowed\"]\n ]:\n     in_blocklist = any(\n-        is_in_or_equal(path, blocked_path) for blocked_path in blocked_paths\n+        is_in_or_equal(path.as_posix().lower(), Path(blocked_path).as_posix().lower()) for blocked_path in blocked_paths\n     )\n     if in_blocklist:\n         return False, \"in_blocklist\"\n-    if any(is_in_or_equal(path, allowed_path) for allowed_path in allowed_paths):\n+    if any(is_in_or_equal(path.as_posix().lower(), Path(allowed_path).as_posix().lower()) for allowed_path in allowed_paths):\n         return True, \"allowed\"\n-    if any(is_in_or_equal(path, created_path) for created_path in created_paths):\n+    if any(is_in_or_equal(path.as_posix().lower(), Path(created_path).as_posix().lower()) for created_path in created_paths):\n         return True, \"created\"\n     return False, \"not_created_or_allowed\"\n \n"}
{"cve":"CVE-2022-3298:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/rdiffweb/controller/pref_sshkeys.py b/rdiffweb/controller/pref_sshkeys.py\nindex 4fc3555..c3866b4 100644\n--- a/rdiffweb/controller/pref_sshkeys.py\n+++ b/rdiffweb/controller/pref_sshkeys.py\n@@ -58,7 +58,7 @@ class SshForm(CherryForm):\n         description=_(\n             \"Enter a SSH public key. It should start with 'ssh-dss', 'ssh-ed25519', 'ssh-rsa', 'ecdsa-sha2-nistp256', 'ecdsa-sha2-nistp384' or 'ecdsa-sha2-nistp521'.\"\n         ),\n-        validators=[validators.data_required(), validate_key],\n+        validators=[validators.data_required(), validate_key, validators.Length(max=8192)],\n     )\n     fingerprint = StringField('Fingerprint')\n \n"}
{"cve":"CVE-2022-41672:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/airflow/www/app.py b/airflow/www/app.py\nindex b67314c99a..2e06b0fab6 100644\n--- a/airflow/www/app.py\n+++ b/airflow/www/app.py\n@@ -152,6 +152,19 @@ def create_app(config=None, testing=False):\n         init_jinja_globals(flask_app)\n         init_xframe_protection(flask_app)\n         init_airflow_session_interface(flask_app)\n+\n+    from flask import redirect, url_for, flash\n+    from flask_appbuilder import current_app, logout_user\n+\n+    @flask_app.before_request\n+    def check_user_active_status():\n+        if current_app.appbuilder.sm.is_authenticated():\n+            user = current_app.appbuilder.sm.current_user\n+            if not user.is_active:\n+                logout_user()\n+                flash('Your account has been deactivated. Please contact an administrator.', 'warning')\n+                return redirect(url_for('security.login'))\n+\n     return flask_app\n \n \n"}
{"cve":"CVE-2024-3571:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/libs/langchain/langchain/storage/file_system.py b/libs/langchain/langchain/storage/file_system.py\nindex 720acf085..299ecd4bd 100644\n--- a/libs/langchain/langchain/storage/file_system.py\n+++ b/libs/langchain/langchain/storage/file_system.py\n@@ -55,7 +55,11 @@ class LocalFileStore(ByteStore):\n         \"\"\"\n         if not re.match(r\"^[a-zA-Z0-9_.\\-/]+$\", key):\n             raise InvalidKeyException(f\"Invalid characters in key: {key}\")\n-        return self.root_path / key\n+        root_resolved = self.root_path.resolve()\n+        full_path = (root_resolved / key).resolve()\n+        if not full_path.as_posix().startswith(root_resolved.as_posix()):\n+            raise InvalidKeyException(f\"Key '{key}' resolves to a path outside the root directory.\")\n+        return full_path\n \n     def mget(self, keys: Sequence[str]) -> List[Optional[bytes]]:\n         \"\"\"Get the values associated with the given keys.\n"}
{"cve":"CVE-2024-0243:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/libs/core/langchain_core/utils/html.py b/libs/core/langchain_core/utils/html.py\nindex 95e1c3c2f..bd02f74c1 100644\n--- a/libs/core/langchain_core/utils/html.py\n+++ b/libs/core/langchain_core/utils/html.py\n@@ -83,7 +83,9 @@ def extract_sub_links(\n     for path in absolute_paths:\n         if any(path.startswith(exclude) for exclude in exclude_prefixes):\n             continue\n-        if prevent_outside and not path.startswith(base_url):\n+        parsed_base = urlparse(base_url)\n+        parsed_path = urlparse(path)\n+        if prevent_outside and parsed_path.netloc != parsed_base.netloc:\n             continue\n         res.append(path)\n     return res\n"}
{"cve":"CVE-2023-6831:0708", "fix_patch": ""}
{"cve":"CVE-2024-3848:0708", "fix_patch": "diff --git a/mlflow/server/handlers.py b/mlflow/server/handlers.py\nindex 6d3204002..9a9090513 100644\n--- a/mlflow/server/handlers.py\n+++ b/mlflow/server/handlers.py\n@@ -601,6 +601,8 @@ def _create_experiment():\n     # Validate query string in artifact location to prevent attacks\n     parsed_artifact_locaion = urllib.parse.urlparse(request_message.artifact_location)\n     validate_query_string(parsed_artifact_locaion.query)\n+    if parsed_artifact_locaion.fragment:\n+        raise MlflowException(\"Artifact location URL contains invalid fragment\", INVALID_PARAMETER_VALUE)\n \n     experiment_id = _get_tracking_store().create_experiment(\n         request_message.name, request_message.artifact_location, tags\n@@ -1739,6 +1741,9 @@ def _validate_source(source: str, run_id: str) -> None:\n \n     # Checks if relative paths are present in the source (a security threat). If any are present,\n     # raises an Exception.\n+    parsed_source = urllib.parse.urlparse(source)\n+    if parsed_source.fragment:\n+        raise MlflowException(\"Source URL contains invalid fragment\", INVALID_PARAMETER_VALUE)\n     _validate_non_local_source_contains_relative_paths(source)\n \n \n"}
{"cve":"CVE-2021-21354:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pollbot/middlewares.py b/pollbot/middlewares.py\nindex 1c5d381..59e5425 100644\n--- a/pollbot/middlewares.py\n+++ b/pollbot/middlewares.py\n@@ -60,8 +60,10 @@ async def handle_any(request, response):\n \n async def handle_404(request, response):\n     if 'json' not in response.headers['Content-Type']:\n-        if request.path.endswith('/'):\n-            return web.HTTPFound(request.path.rstrip('/'))\n+        stripped_path = request.path.rstrip('/')\n+        if stripped_path.startswith('//'):\n+            return web.HTTPFound('/')\n+        return web.HTTPFound(stripped_path)\n         return web.json_response({\n             \"status\": 404,\n             \"message\": \"Page '{}' not found\".format(request.path)\n"}
{"cve":"CVE-2021-4315:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/psiturk/experiment.py b/psiturk/experiment.py\nindex a6904f6..ac08dda 100644\n--- a/psiturk/experiment.py\n+++ b/psiturk/experiment.py\n@@ -10,7 +10,7 @@ import user_agents\n import requests\n import re\n import json\n-from jinja2 import TemplateNotFound\n+from jinja2 import TemplateNotFound, escape\n from collections import Counter\n \n \n@@ -740,7 +740,7 @@ def insert_mode(page_html, mode):\n     for match in matches:\n         match_found = True\n     if match_found:\n-        new_html = page_html[:match.end()] + \"&mode=\" + mode +\\\n+        new_html = page_html[:match.end()] + \"&mode=\" + escape(mode) +\\\n             page_html[match.end():]\n         return new_html\n     else:\n"}
{"cve":"CVE-2023-39631:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/numexpr/necompiler.py b/numexpr/necompiler.py\nindex 37052ac..621d056 100644\n--- a/numexpr/necompiler.py\n+++ b/numexpr/necompiler.py\n@@ -271,7 +271,26 @@ def stringToExpression(s, types, context):\n             flags = __future__.division.compiler_flag\n         else:\n             flags = 0\n-        c = compile(s, '<expr>', 'eval', flags)\n+        import ast\n+        # Validate expression to prevent code injection\n+        tree = ast.parse(s, mode='eval')\n+        allowed_node_types = {\n+            ast.Expression, ast.BinOp, ast.UnaryOp, ast.Constant,\n+            ast.Name, ast.Load, ast.Add, ast.Sub, ast.Mult, ast.Div,\n+            ast.FloorDiv, ast.Mod, ast.Pow, ast.BitAnd, ast.BitOr,\n+            ast.BitXor, ast.Invert, ast.LShift, ast.RShift, ast.UAdd,\n+            ast.USub, ast.Eq, ast.NotEq, ast.Lt, ast.LtE, ast.Gt,\n+            ast.GtE, ast.Is, ast.IsNot, ast.In, ast.NotIn, ast.Not,\n+            ast.And, ast.Or, ast.Compare, ast.BoolOp, ast.UnaryOp\n+        }\n+        allowed_functions = set(expressions.functions.keys())\n+        for node in ast.walk(tree):\n+            if type(node) not in allowed_node_types:\n+                raise ValueError(f\"Unsupported expression node type: {type(node).__name__}\")\n+            if isinstance(node, ast.Call):\n+                if isinstance(node.func, ast.Name) and node.func.id not in allowed_functions:\n+                    raise ValueError(f\"Disallowed function call: {node.func.id}\")\n+        c = compile(tree, '<expr>', 'eval', flags)\n         # make VariableNode's for the names\n         names = {}\n         for name in c.co_names:\n"}
{"cve":"CVE-2024-21542:0708", "fix_patch": "diff --git a/luigi/contrib/lsf_runner.py b/luigi/contrib/lsf_runner.py\nindex 5a6c8b56..5abff060 100755\n--- a/luigi/contrib/lsf_runner.py\n+++ b/luigi/contrib/lsf_runner.py\n@@ -54,6 +54,11 @@ def extract_packages_archive(work_dir):\n     os.chdir(work_dir)\n     tar = tarfile.open(package_file)\n     for tarinfo in tar:\n+        # Prevent path traversal\n+        extracted_path = os.path.abspath(tarinfo.name)\n+        if not extracted_path.startswith(work_dir):\n+            logging.warning(f\"Skipping potentially malicious file: {tarinfo.name}\")\n+            continue\n         tar.extract(tarinfo)\n     tar.close()\n     if '' not in sys.path:\ndiff --git a/luigi/contrib/sge_runner.py b/luigi/contrib/sge_runner.py\nindex f0621fb4..d7dd4d1c 100755\n--- a/luigi/contrib/sge_runner.py\n+++ b/luigi/contrib/sge_runner.py\n@@ -66,6 +66,11 @@ def _extract_packages_archive(work_dir):\n     os.chdir(work_dir)\n     tar = tarfile.open(package_file)\n     for tarinfo in tar:\n+        # Prevent path traversal\n+        extracted_path = os.path.abspath(tarinfo.name)\n+        if not extracted_path.startswith(work_dir):\n+            logging.warning(f\"Skipping potentially malicious file: {tarinfo.name}\")\n+            continue\n         tar.extract(tarinfo)\n     tar.close()\n     if '' not in sys.path:\n"}
{"cve":"CVE-2017-0360:0708", "fix_patch": "diff --git a/.gitignore b/.gitignore\nnew file mode 100644\nindex 00000000..6f8023f8\n--- /dev/null\n+++ b/.gitignore\n@@ -0,0 +1,111 @@\n+\n+# \u56fe\u50cf\u548c\u5a92\u4f53\u6587\u4ef6\uff08\u4e8c\u8fdb\u5236\uff09\n+*.png\n+*.jpg\n+*.jpeg\n+*.gif\n+*.bmp\n+*.tiff\n+*.webp\n+*.mp3\n+*.mp4\n+*.avi\n+*.mov\n+*.flv\n+*.wmv\n+*.pdf\n+*.psd\n+*.ai\n+\n+# \u538b\u7f29\u6587\u4ef6\uff08\u4e8c\u8fdb\u5236\uff09\n+*.zip\n+*.tar\n+*.tar.gz\n+*.tar.bz2\n+*.7z\n+*.rar\n+*.gz\n+*.bz2\n+\n+# \u53ef\u6267\u884c\u6587\u4ef6\uff08\u4e8c\u8fdb\u5236\uff09\n+*.exe\n+*.dll\n+*.so\n+*.dylib\n+*.bin\n+*.out\n+\n+# \u6570\u636e\u5e93\u6587\u4ef6\n+*.db\n+*.sqlite\n+*.sqlite3\n+\n+# \u7f16\u8bd1\u751f\u6210\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\n+/build/\n+/dist/\n+/bin/\n+/out/\n+\n+\n+.DS_Store\n+Thumbs.db\n+\n+# Go\n+myapp\n+vendor/\n+*.out\n+*.test\n+coverage.out\n+build/\n+dist/\n+\n+# JavaScript/Node.js\n+node_modules/\n+dist/\n+build/\n+out/\n+dist-ssr/\n+*.bundle.js\n+*.bundle.js.map\n+*.chunk.js\n+*.chunk.js.map\n+npm-debug.log*\n+yarn-debug.log*\n+yarn-error.log*\n+.pnpm-debug.log*\n+.env.local\n+.env.development.local\n+.env.test.local\n+.env.production.local\n+.node-gyp/\n+*.node\n+\n+# Python\n+__pycache__/\n+*.py[cod]\n+*.class\n+venv/\n+env/\n+ENV/\n+*.venv\n+*.egg-info/\n+.installed.cfg\n+*.egg\n+dist/\n+build/\n+wheelhouse/\n+*.so\n+*.pyd\n+*.dll\n+.coverage\n+htmlcov/\n+.pytest_cache/\n+\n+*.blk\n+*.idx\n+*.jar\n+*.md\n+*package-lock.json\n+\n+\n+\ndiff --git a/trytond/tools/misc.py b/trytond/tools/misc.py\nindex 2b9a7f8f..c7164811 100644\n--- a/trytond/tools/misc.py\n+++ b/trytond/tools/misc.py\n@@ -32,7 +32,7 @@ def file_open(name, mode=\"r\", subdir='modules', encoding=None):\n         \"Join paths and ensure it still below root\"\n         path = os.path.join(root, *paths)\n         path = os.path.normpath(path)\n-        if not path.startswith(root):\n+        if not (path == root or path.startswith(root + os.sep)):\n             raise IOError(\"Permission denied: %s\" % name)\n         return path\n \n"}
{"cve":"CVE-2018-18074:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/requests/sessions.py b/requests/sessions.py\nindex dd525e2a..c31c56fc 100644\n--- a/requests/sessions.py\n+++ b/requests/sessions.py\n@@ -242,7 +242,7 @@ class SessionRedirectMixin(object):\n             original_parsed = urlparse(response.request.url)\n             redirect_parsed = urlparse(url)\n \n-            if (original_parsed.hostname != redirect_parsed.hostname):\n+            if (original_parsed.scheme == 'https' and redirect_parsed.scheme == 'http') or (original_parsed.hostname != redirect_parsed.hostname):\n                 del headers['Authorization']\n \n         # .netrc might have more auth for us on our new host.\n"}
{"cve":"CVE-2021-3987:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cps/shelf.py b/cps/shelf.py\nindex 2c6a17a2..bbb2805e 100644\n--- a/cps/shelf.py\n+++ b/cps/shelf.py\n@@ -245,6 +245,9 @@ def create_edit_shelf(shelf, page_title, page, shelf_id=False):\n     if request.method == \"POST\":\n         to_save = request.form.to_dict()\n         shelf.is_public = 1 if to_save.get(\"is_public\") else 0\n+        if shelf.is_public and not current_user.role_edit_shelfs():\n+            flash(_(u\"You do not have permission to create public shelves\"), category=\"error\")\n+            return redirect(url_for('web.index'))\n         if config.config_kobo_sync:\n             shelf.kobo_sync = True if to_save.get(\"kobo_sync\") else False\n         shelf_title = to_save.get(\"title\", \"\")\n"}
{"cve":"CVE-2023-40267:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/git/index/base.py b/git/index/base.py\nindex dd8f9aa2..1997828c 100644\n--- a/git/index/base.py\n+++ b/git/index/base.py\n@@ -1234,7 +1234,7 @@ class IndexFile(LazyMixin, git_diff.Diffable, Serializable):\n             checked_out_files: List[PathLike] = []\n \n             for path in paths:\n-                co_path = to_native_path_linux(self._to_relative_path(path))\n+                co_path = to_native_path_linux(self._to_relative_path(path)).replace('\\n', '')\n                 # if the item is not in the index, it could be a directory\n                 path_is_directory = False\n \n"}
{"cve":"CVE-2021-23727:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/celery/backends/base.py b/celery/backends/base.py\nindex ffbd1d030..4cf6ef52c 100644\n--- a/celery/backends/base.py\n+++ b/celery/backends/base.py\n@@ -341,21 +341,26 @@ class Backend:\n         if exc:\n             if not isinstance(exc, BaseException):\n                 exc_module = exc.get('exc_module')\n+                allowed_modules = {'celery.exceptions', 'builtins'}\n                 if exc_module is None:\n                     cls = create_exception_cls(\n-                        from_utf8(exc['exc_type']), __name__)\n+                        from_utf8(exc['exc_type']), 'celery.exceptions')\n                 else:\n                     exc_module = from_utf8(exc_module)\n                     exc_type = from_utf8(exc['exc_type'])\n-                    try:\n-                        # Load module and find exception class in that\n-                        cls = sys.modules[exc_module]\n-                        # The type can contain qualified name with parent classes\n-                        for name in exc_type.split('.'):\n-                            cls = getattr(cls, name)\n-                    except (KeyError, AttributeError):\n-                        cls = create_exception_cls(exc_type,\n-                                                   celery.exceptions.__name__)\n+                    if exc_module not in allowed_modules:\n+                        logger.warning(f\"Unsafe exception module {exc_module} requested, using default exception\")\n+                        cls = create_exception_cls(exc_type, 'celery.exceptions')\n+                    else:\n+                        try:\n+                            # Load module and find exception class in that\n+                            cls = sys.modules[exc_module]\n+                            # The type can contain qualified name with parent classes\n+                            for name in exc_type.split('.'):\n+                                cls = getattr(cls, name)\n+                        except (KeyError, AttributeError):\n+                            cls = create_exception_cls(exc_type,\n+                                                       'celery.exceptions')\n                 exc_msg = exc['exc_message']\n                 try:\n                     if isinstance(exc_msg, (tuple, list)):\n"}
{"cve":"CVE-2022-24065:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/cookiecutter/vcs.py b/cookiecutter/vcs.py\nindex 08cb2eb..f9c1218 100644\n--- a/cookiecutter/vcs.py\n+++ b/cookiecutter/vcs.py\n@@ -98,8 +98,12 @@ def clone(repo_url, checkout=None, clone_to_dir='.', no_input=False):\n                 stderr=subprocess.STDOUT,\n             )\n             if checkout is not None:\n+                if repo_type == 'hg':\n+                    cmd = [repo_type, 'checkout', '--rev', checkout]\n+                else:\n+                    cmd = [repo_type, 'checkout', checkout]\n                 subprocess.check_output(  # nosec\n-                    [repo_type, 'checkout', checkout],\n+                    cmd,\n                     cwd=repo_dir,\n                     stderr=subprocess.STDOUT,\n                 )\n"}
{"cve":"CVE-2023-26145:0708", "fix_patch": "diff --git a/src/pydash/helpers.py b/src/pydash/helpers.py\nindex 0467c9c..4c4ee32 100644\n--- a/src/pydash/helpers.py\n+++ b/src/pydash/helpers.py\n@@ -179,10 +179,11 @@ def _base_get_object(obj, key, default=UNSET):\n     value = _base_get_item(obj, key, default=UNSET)\n     if value is UNSET:\n         value = default\n-        try:\n-            value = getattr(obj, key)\n-        except Exception:\n-            pass\n+        if not key.startswith('__'):\n+            try:\n+                value = getattr(obj, key)\n+            except Exception:\n+                pass\n     return value\n \n \n@@ -212,7 +213,7 @@ def base_set(obj, key, value, allow_override=True):\n                 # into the key index.\n                 obj[:] = (obj + [None] * key)[:key]\n             obj.append(value)\n-    elif (allow_override or not hasattr(obj, key)) and obj is not None:\n+    elif (allow_override or not hasattr(obj, key)) and obj is not None and not key.startswith('__'):\n         setattr(obj, key, value)\n \n     return obj\n"}
{"cve":"CVE-2020-25459:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/federatedml/tree/hetero/hetero_decision_tree_guest.py b/federatedml/tree/hetero/hetero_decision_tree_guest.py\nindex 1f23ddc53..984eafd92 100644\n--- a/federatedml/tree/hetero/hetero_decision_tree_guest.py\n+++ b/federatedml/tree/hetero/hetero_decision_tree_guest.py\n@@ -532,7 +532,22 @@ class HeteroDecisionTreeGuest(DecisionTree):\n     def sync_tree(self):\n         LOGGER.info(\"sync tree to host\")\n \n-        self.transfer_inst.tree.remote(self.tree_,\n+        # Send only necessary tree structure without sensitive information\n+        sanitized_tree = []\n+        for node in self.tree_:\n+            sanitized_node = Node(\n+                id=node.id,\n+                sitename=node.sitename,\n+                is_leaf=node.is_leaf,\n+                left_nodeid=node.left_nodeid,\n+                right_nodeid=node.right_nodeid,\n+                fid=node.fid,\n+                bid=node.bid,\n+                missing_dir=node.missing_dir,\n+                weight=node.weight if node.is_leaf else None\n+            )\n+            sanitized_tree.append(sanitized_node)\n+        self.transfer_inst.tree.remote(sanitized_tree,\n                                        role=consts.HOST,\n                                        idx=-1)\n         \"\"\"\n"}
{"cve":"CVE-2022-39286:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/jupyter_core/application.py b/jupyter_core/application.py\nindex cb46d12..457eaad 100644\n--- a/jupyter_core/application.py\n+++ b/jupyter_core/application.py\n@@ -89,7 +89,6 @@ class JupyterApp(Application):\n         path = jupyter_config_path()\n         if self.config_dir not in path:\n             path.insert(0, self.config_dir)\n-        path.insert(0, os.getcwd())\n         return path\n \n     data_dir = Unicode()\n"}
{"cve":"CVE-2019-10856:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/notebook/auth/login.py b/notebook/auth/login.py\nindex 8dbd6112f..2f0660471 100644\n--- a/notebook/auth/login.py\n+++ b/notebook/auth/login.py\n@@ -44,7 +44,7 @@ class LoginHandler(IPythonHandler):\n         # instead of %5C, causing `\\\\` to behave as `//`\n         url = url.replace(\"\\\\\", \"%5C\")\n         parsed = urlparse(url)\n-        if parsed.netloc or not (parsed.path + '/').startswith(self.base_url):\n+        if parsed.scheme or parsed.netloc or not (parsed.path + '/').startswith(self.base_url):\n             # require that next_url be absolute path within our path\n             allow = False\n             # OR pass our cross-origin check\n"}
{"cve":"CVE-2020-26215:0708", "fix_patch": ""}
{"cve":"CVE-2021-39163:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/synapse/groups/groups_server.py b/synapse/groups/groups_server.py\nindex 3dc55ab86..22f7c3680 100644\n--- a/synapse/groups/groups_server.py\n+++ b/synapse/groups/groups_server.py\n@@ -332,6 +332,9 @@ class GroupsServerWorkerHandler:\n             requester_user_id, group_id\n         )\n \n+        if self.hs.config.enable_group_creation and not is_user_in_group:\n+            raise SynapseError(403, \"Unauthorized to access group rooms\")\n+\n         room_results = await self.store.get_rooms_in_group(\n             group_id, include_private=is_user_in_group\n         )\n"}
{"cve":"CVE-2022-0577:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/scrapy/downloadermiddlewares/redirect.py b/scrapy/downloadermiddlewares/redirect.py\nindex 4053fecc5..9de7f1cae 100644\n--- a/scrapy/downloadermiddlewares/redirect.py\n+++ b/scrapy/downloadermiddlewares/redirect.py\n@@ -1,5 +1,6 @@\n import logging\n from urllib.parse import urljoin, urlparse\n+from scrapy.spidermiddlewares.offsite import URLNetlocFilter\n \n from w3lib.url import safe_url_string\n \n@@ -50,6 +51,12 @@ class BaseRedirectMiddleware:\n         redirected = request.replace(url=redirect_url, method='GET', body='')\n         redirected.headers.pop('Content-Type', None)\n         redirected.headers.pop('Content-Length', None)\n+        # Strip sensitive headers on cross-domain redirects\n+        original_netloc = urlparse(request.url).netloc\n+        redirect_netloc = urlparse(redirect_url).netloc\n+        if original_netloc != redirect_netloc:\n+            for header in ['Authorization', 'Cookie']:\n+                redirected.headers.pop(header, None)\n         return redirected\n \n \n@@ -79,6 +86,15 @@ class RedirectMiddleware(BaseRedirectMiddleware):\n \n         redirected_url = urljoin(request.url, location)\n \n+        # Check if redirect is allowed by spider's allowed_domains\n+        allowed_domains = getattr(spider, 'allowed_domains', None)\n+        if allowed_domains:\n+            url_filter = URLNetlocFilter(allowed_domains)\n+            if not url_filter.is_allowed(redirected_url):\n+                logger.debug(\"Redirect to disallowed domain not followed: %(url)s\",\n+                             {'url': redirected_url}, extra={'spider': spider})\n+                return response\n+\n         if response.status in (301, 307, 308) or request.method == 'HEAD':\n             redirected = request.replace(url=redirected_url)\n             return self._redirect(redirected, request, spider, response.status)\n"}
{"cve":"CVE-2021-41125:0708", "fix_patch": ""}
{"cve":"CVE-2021-21360:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/Products/GenericSetup/context.py b/src/Products/GenericSetup/context.py\nindex 1c8ba1d..31c59af 100644\n--- a/src/Products/GenericSetup/context.py\n+++ b/src/Products/GenericSetup/context.py\n@@ -559,6 +559,9 @@ class SnapshotExportContext(BaseContext):\n             if element not in current.objectIds():\n                 # No Unicode IDs!\n                 current._setObject(str(element), Folder(element))\n+                folder = current._getOb(element)\n+                folder.manage_permission('View', ['Manager'], acquire=0)\n+                folder.manage_permission('Access contents information', ['Manager'], acquire=0)\n \n             current = current._getOb(element)\n \n"}
{"cve":"CVE-2023-32303:0708", "fix_patch": "diff --git a/planet/auth.py b/planet/auth.py\nindex e50f1af..3a1e89f 100644\n--- a/planet/auth.py\n+++ b/planet/auth.py\n@@ -240,7 +240,7 @@ class _SecretFile:\n \n     def _write(self, contents: dict):\n         LOGGER.debug(f'Writing to {self.path}')\n-        with open(self.path, 'w') as fp:\n+        with open(self.path, 'w', 0o600) as fp:\n             fp.write(json.dumps(contents))\n \n     def read(self) -> dict:\n"}
{"cve":"CVE-2022-21712:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000000..5227fa9a7c\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/twisted/web/client.py b/src/twisted/web/client.py\nindex a1295c2705..0d87ccc02f 100644\n--- a/src/twisted/web/client.py\n+++ b/src/twisted/web/client.py\n@@ -2186,6 +2186,15 @@ class RedirectAgent:\n             )\n             raise ResponseFailed([Failure(err)], response)\n         location = self._resolveLocation(uri, locationHeaders[0])\n+        # Check if redirect is cross-origin\n+        original_uri = URI.fromBytes(uri)\n+        new_uri = URI.fromBytes(location)\n+        if (original_uri.scheme, original_uri.host, original_uri.port) != (new_uri.scheme, new_uri.host, new_uri.port):\n+            # Strip sensitive headers for cross-origin redirect\n+            headers = headers.copy()\n+            for h in [b'cookie', b'authorization', b'proxy-authorization']:\n+                if headers.hasHeader(h):\n+                    headers.removeHeader(h)\n         deferred = self._agent.request(method, location, headers)\n \n         def _chainResponse(newResponse):\n"}
{"cve":"CVE-2022-4724:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/rdiffweb/core/model/_user.py b/rdiffweb/core/model/_user.py\nindex 9b06363..7b504b6 100644\n--- a/rdiffweb/core/model/_user.py\n+++ b/rdiffweb/core/model/_user.py\n@@ -397,6 +397,16 @@ class UserObject(Base):\n             raise ValueError('Username cannot be modified.')\n         return value\n \n+    @validates('user_root')\n+    def validates_user_root(self, key, value):\n+        if not value:\n+            return value\n+        if '..' in value:\n+            raise ValueError(_(\"Invalid user_root path contains '..'\"))\n+        if not os.path.isabs(value):\n+            raise ValueError(_(\"user_root must be an absolute path\"))\n+        return value\n+\n     def validate_access_token(self, token):\n         \"\"\"\n         Check if the given token matches.\n"}
{"cve":"CVE-2023-32309:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pymdownx/snippets.py b/pymdownx/snippets.py\nindex e7ae2e98..fddb5c37 100644\n--- a/pymdownx/snippets.py\n+++ b/pymdownx/snippets.py\n@@ -159,18 +159,25 @@ class SnippetPreprocessor(Preprocessor):\n         for base in self.base_path:\n             if os.path.exists(base):\n                 if os.path.isdir(base):\n-                    filename = os.path.join(base, path)\n-                    if os.path.exists(filename):\n-                        snippet = filename\n-                        break\n+                    abs_base = os.path.abspath(base)\n+                    candidate_path = os.path.join(abs_base, path)\n+                    resolved_path = os.path.abspath(candidate_path)\n+                    # Check if resolved path is within the base directory\n+                    if resolved_path.startswith(abs_base + os.sep):\n+                        if os.path.exists(resolved_path):\n+                            snippet = resolved_path\n+                            break\n                 else:\n                     basename = os.path.basename(base)\n                     dirname = os.path.dirname(base)\n                     if basename.lower() == path.lower():\n-                        filename = os.path.join(dirname, path)\n-                        if os.path.exists(filename):\n-                            snippet = filename\n-                            break\n+                        abs_dirname = os.path.abspath(dirname)\n+                        candidate_path = os.path.join(abs_dirname, path)\n+                        resolved_path = os.path.abspath(candidate_path)\n+                        if resolved_path.startswith(abs_dirname + os.sep):\n+                            if os.path.exists(resolved_path):\n+                                snippet = resolved_path\n+                                break\n         return snippet\n \n     @functools.lru_cache()\n"}
{"cve":"CVE-2024-5823:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/modules/utils.py b/modules/utils.py\nindex f2baefa..0ef8eb6 100644\n--- a/modules/utils.py\n+++ b/modules/utils.py\n@@ -743,9 +743,14 @@ def transfer_input(inputs):\n \n def update_chuanhu():\n     from .repo import background_update\n+    import os\n+    import tempfile\n \n     print(\"[Updater] Trying to update...\")\n-    update_status = background_update()\n+    # Restrict update to application directory only\n+    app_dir = os.path.abspath(os.path.dirname(__file__))\n+    with tempfile.TemporaryDirectory(dir=app_dir) as temp_dir:\n+        update_status = background_update(restricted_dir=app_dir, temp_dir=temp_dir)\n     if update_status == \"success\":\n         logging.info(\"Successfully updated, restart needed\")\n         status = '<span id=\"update-status\" class=\"hideK\">success</span>'\n"}
{"cve":"CVE-2022-36087:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/oauthlib/uri_validate.py b/oauthlib/uri_validate.py\nindex 8a6d9c2..95787d8 100644\n--- a/oauthlib/uri_validate.py\n+++ b/oauthlib/uri_validate.py\n@@ -66,7 +66,7 @@ IPv4address = r\"%(dec_octet)s \\. %(dec_octet)s \\. %(dec_octet)s \\. %(dec_octet)s\n )\n \n #   IPv6address\n-IPv6address = r\"([A-Fa-f0-9:]+:+)+[A-Fa-f0-9]+\"\n+IPv6address = r\"(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,7}:|(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}|(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}|(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}|(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:(?:(?::[0-9a-fA-F]{1,4}){1,6})|:(?:(?::[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(?::[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(?:ffff(?::0{1,4}){0,1}:){0,1}(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])|(?:[0-9a-fA-F]{1,4}:){1,4}:(?:(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(?:25[0-5]|(?:2[0-4]|1{0,1}[0-9]){0,1}[0-9])\"\n \n #   IPvFuture     = \"v\" 1*HEXDIG \".\" 1*( unreserved / sub-delims / \":\" )\n IPvFuture = r\"v %(HEXDIG)s+ \\. (?: %(unreserved)s | %(sub_delims)s | : )+\" % locals()\n"}
{"cve":"CVE-2023-29159:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/starlette/staticfiles.py b/starlette/staticfiles.py\nindex 4d075b3..075a1b1 100644\n--- a/starlette/staticfiles.py\n+++ b/starlette/staticfiles.py\n@@ -169,7 +169,7 @@ class StaticFiles:\n             else:\n                 full_path = os.path.realpath(joined_path)\n             directory = os.path.realpath(directory)\n-            if os.path.commonprefix([full_path, directory]) != directory:\n+            if not (full_path.startswith(directory + os.sep) or full_path == directory):\n                 # Don't allow misbehaving clients to break out of the static files\n                 # directory.\n                 continue\n"}
{"cve":"CVE-2023-41040:0708", "fix_patch": "diff --git a/git/refs/symbolic.py b/git/refs/symbolic.py\nindex 734bf32d..c4fba53e 100644\n--- a/git/refs/symbolic.py\n+++ b/git/refs/symbolic.py\n@@ -172,8 +172,13 @@ class SymbolicReference(object):\n             raise ValueError(f\"Invalid reference '{ref_path}'\")\n         tokens: Union[None, List[str], Tuple[str, str]] = None\n         repodir = _git_dir(repo, ref_path)\n+        full_path = os.path.join(repodir, str(ref_path))\n+        abs_full_path = os.path.abspath(full_path)\n+        abs_repodir = os.path.abspath(repodir)\n+        if not abs_full_path.startswith(abs_repodir):\n+            raise ValueError(f\"Invalid reference path: {ref_path}\")\n         try:\n-            with open(os.path.join(repodir, str(ref_path)), \"rt\", encoding=\"UTF-8\") as fp:\n+            with open(full_path, \"rt\", encoding=\"UTF-8\") as fp:\n                 value = fp.read().rstrip()\n             # Don't only split on spaces, but on whitespace, which allows to parse lines like\n             # 60b64ef992065e2600bfef6187a97f92398a9144                branch 'master' of git-server:/path/to/repo\n"}
{"cve":"CVE-2023-39660:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/pandasai/__init__.py b/pandasai/__init__.py\nindex bb325fb6..a9d4a25f 100644\n--- a/pandasai/__init__.py\n+++ b/pandasai/__init__.py\n@@ -569,22 +569,39 @@ class PandasAI(Shortcuts):\n         if library not in WHITELISTED_BUILTINS:\n             raise BadImportError(library)\n \n-    def _is_df_overwrite(self, node: ast.stmt) -> bool:\n+    def _is_dangerous_call(self, node: ast.stmt) -> bool:\n         \"\"\"\n-        Remove df declarations from the code to prevent malicious code execution.\n-\n-        Args:\n-            node (object): ast.stmt\n-\n-        Returns (bool):\n-\n+        Detect dangerous function calls that could enable code injection.\n         \"\"\"\n+        if isinstance(node, ast.Expr) and isinstance(node.value, ast.Call):\n+            func = node.value.func\n+            if isinstance(func, ast.Name):\n+                # Check for direct calls to dangerous functions\n+                if func.id in ['exec', 'eval', 'compile', 'open', 'file', 'subprocess', 'os', 'system']:\n+                    return True\n+            elif isinstance(func, ast.Attribute):\n+                # Check for attribute calls like subprocess.run\n+                if (isinstance(func.value, ast.Name) and \n+                    func.value.id in ['subprocess', 'os'] and \n+                    func.attr in ['run', 'call', 'system', 'popen']):\n+                    return True\n+        return False\n \n-        return (\n-            isinstance(node, ast.Assign)\n-            and isinstance(node.targets[0], ast.Name)\n-            and re.match(r\"df\\d{0,2}$\", node.targets[0].id)\n-        )\n+    def _is_df_overwrite(self, node: ast.stmt) -> bool:\n+        \"\"\"\n+        Detect dataframe overwrites with enhanced pattern matching.\n+        \"\"\"\n+        if isinstance(node, ast.Assign):\n+            # Check for simple df assignments (df = ...)\n+            if isinstance(node.targets[0], ast.Name):\n+                if re.match(r\"^df\\d{0,2}$\", node.targets[0].id):\n+                    return True\n+            # Check for df attribute assignments (df.attr = ...)\n+            elif (isinstance(node.targets[0], ast.Attribute) and \n+                  isinstance(node.targets[0].value, ast.Name) and \n+                  re.match(r\"^df\\d{0,2}$\", node.targets[0].value.id)):\n+                return True\n+        return False\n \n     def _clean_code(self, code: str) -> str:\n         \"\"\"\n@@ -608,7 +625,7 @@ class PandasAI(Shortcuts):\n             if isinstance(node, (ast.Import, ast.ImportFrom)):\n                 self._check_imports(node)\n                 continue\n-            if self._is_df_overwrite(node):\n+            if self._is_df_overwrite(node) or self._is_dangerous_call(node):\n                 continue\n             new_body.append(node)\n \n"}
{"cve":"CVE-2025-27154:0708", "fix_patch": "diff --git a/spotipy/cache_handler.py b/spotipy/cache_handler.py\nindex 936e81b..9f6e908 100644\n--- a/spotipy/cache_handler.py\n+++ b/spotipy/cache_handler.py\n@@ -92,7 +92,7 @@ class CacheFileHandler(CacheHandler):\n \n     def save_token_to_cache(self, token_info):\n         try:\n-            with open(self.cache_path, \"w\", encoding='utf-8') as f:\n+            with open(self.cache_path, \"w\", encoding='utf-8', perm=0o600) as f:\n                 f.write(json.dumps(token_info, cls=self.encoder_cls))\n         except OSError:\n             logger.warning(f\"Couldn't write token to cache at: {self.cache_path}\")\n"}
{"cve":"CVE-2020-15278:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/redbot/cogs/mod/kickban.py b/redbot/cogs/mod/kickban.py\nindex 88b9e053..313ac9de 100644\n--- a/redbot/cogs/mod/kickban.py\n+++ b/redbot/cogs/mod/kickban.py\n@@ -475,6 +475,11 @@ class KickBanMixin(MixinMeta):\n             queue_entry = (guild.id, user_id)\n             async with self.config.guild(guild).current_tempbans() as tempbans:\n                 if user_id in tempbans:\n+                    # Check hierarchy if user is still a member\n+                    member = guild.get_member(user_id)\n+                    if member is not None and not await is_allowed_by_hierarchy(self.bot, self.config, guild, author, member):\n+                        errors[user_id] = _(\"Cannot upgrade tempban for {user_id}: insufficient hierarchy\").format(user_id=user_id)\n+                        continue\n                     tempbans.remove(user_id)\n                     upgrades.append(str(user_id))\n                     log.info(\n"}
{"cve":"CVE-2024-48911:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/opencanary/config.py b/opencanary/config.py\nindex 4886783..d29cdaa 100644\n--- a/opencanary/config.py\n+++ b/opencanary/config.py\n@@ -72,9 +72,9 @@ class Config:\n                 print(\"[-] Failed to open %s for reading (%s)\" % (fname, e))\n             except ValueError as e:\n                 print(\"[-] Failed to decode json from %s (%s)\" % (fname, e))\n-                subprocess.call(\n-                    \"cp -r %s /var/tmp/config-err-$(date +%%s)\" % fname, shell=True\n-                )\n+                import time\n+                timestamp = int(time.time())\n+                subprocess.call(['cp', '-r', fname, f\"/var/tmp/config-err-{timestamp}\"], shell=False)\n             except Exception as e:\n                 print(\"[-] An error occurred loading %s (%s)\" % (fname, e))\n         if self.__config is None:\n"}
{"cve":"CVE-2020-28360:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/index.js b/src/index.js\nindex 0dc1033..d24a399 100644\n--- a/src/index.js\n+++ b/src/index.js\n@@ -1,9 +1,12 @@\n export default (ip) => (\n-  /^(::f{4}:)?10\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?192\\.168\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?172\\.(1[6-9]|2\\d|30|31)\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?127\\.([0-9]{1,3})\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n-  /^(::f{4}:)?169\\.254\\.([0-9]{1,3})\\.([0-9]{1,3})$/i.test(ip) ||\n+  /^(::f{4}:)?10\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?192\\.168\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?172\\.(1[6-9]|2\\d|30|31)\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?127\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?169\\.254\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?0\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?224\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n+  /^(::f{4}:)?240\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))\\.(0|(1?\\d{1,2}|2[0-4]\\d|25[0-5]))$/i.test(ip) ||\n   /^f[cd][0-9a-f]{2}:/i.test(ip) ||\n   /^fe80:/i.test(ip) ||\n   /^::1$/.test(ip) ||\n"}
{"cve":"CVE-2017-16100:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/dns-sync.js b/lib/dns-sync.js\nindex 5f63607..f914fd2 100644\n--- a/lib/dns-sync.js\n+++ b/lib/dns-sync.js\n@@ -3,6 +3,7 @@\n var net = require('net'),\n     util = require('util'),\n     path = require('path'),\n+    child_process = require('child_process'),\n     shell = require('shelljs'),\n     debug = require('debug')('dns-sync');\n \n@@ -14,17 +15,25 @@ module.exports = {\n     resolve: function resolve(hostname) {\n         var output,\n             nodeBinary = process.execPath,\n-            scriptPath = path.join(__dirname, \"../scripts/dns-lookup-script\"),\n-            response,\n-            cmd = util.format('\"%s\" \"%s\" %s', nodeBinary, scriptPath, hostname);\n+            scriptPath = path.join(__dirname, \"../scripts/dns-lookup-script\");\n \n-        response = shell.exec(cmd, {silent: true});\n-        if (response && response.code === 0) {\n-            output = response.output;\n+        // Validate hostname format\n+        if (typeof hostname !== 'string' || !/^[a-zA-Z0-9.-]+$/.test(hostname)) {\n+            debug('hostname', \"Invalid hostname format: \" + hostname);\n+            return null;\n+        }\n+\n+        try {\n+            // Use execFile instead of shell.exec to prevent command injection\n+            var result = child_process.execFile.sync(nodeBinary, [scriptPath, hostname], {encoding: 'utf8', silent: true});\n+            output = result.trim();\n             if (output && net.isIP(output)) {\n                 return output;\n             }\n+        } catch (error) {\n+            debug('hostname', \"Failed to resolve hostname \" + hostname + \": \" + error.message);\n         }\n+\n         debug('hostname', \"fail to resolve hostname \" + hostname);\n         return null;\n     }\n"}
{"cve":"CVE-2021-23384:0708", "fix_patch": "diff --git a/index.js b/index.js\nindex 0102e84..901af5d 100644\n--- a/index.js\n+++ b/index.js\n@@ -56,9 +56,13 @@ function haveSlash(path) {\n }\n \n function getPath(original, querystring) {\n+    let path;\n     if (querystring.length) {\n-        return original.slice(0, -querystring.length - 1);\n+        path = original.slice(0, -querystring.length - 1);\n+    } else {\n+        path = original;\n     }\n-\n-    return original;\n+    \n+    // Normalize path to prevent open redirect by ensuring single leading slash\n+    return '/' + path.replace(/^\\/+|\\/$/g, '');\n }\n"}
{"cve":"CVE-2024-53900:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 000000000..5227fa9a7\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/helpers/populate/getModelsMapForPopulate.js b/lib/helpers/populate/getModelsMapForPopulate.js\nindex 16d920366..281f6f747 100644\n--- a/lib/helpers/populate/getModelsMapForPopulate.js\n+++ b/lib/helpers/populate/getModelsMapForPopulate.js\n@@ -184,7 +184,7 @@ module.exports = function getModelsMapForPopulate(model, docs, options) {\n     if (hasMatchFunction) {\n       match = match.call(doc, doc);\n     }\n-    data.match = match;\n+    data.match = sanitizeMatch(match);\n     data.hasMatchFunction = hasMatchFunction;\n     data.isRefPath = isRefPath;\n     data.modelNamesInOrder = modelNamesInOrder;\n@@ -444,7 +444,7 @@ function _virtualPopulate(model, docs, options, _virtualRes) {\n     }\n     data.localField = localField;\n     data.foreignField = foreignField;\n-    data.match = match;\n+    data.match = sanitizeMatch(match);\n     data.hasMatchFunction = hasMatchFunction;\n \n     // Get local fields\n@@ -598,6 +598,23 @@ function handleRefFunction(ref, doc) {\n  * ignore\n  */\n \n+function sanitizeMatch(match) {\n+  if (typeof match !== 'object' || match === null) {\n+    return match;\n+  }\n+  if (Array.isArray(match)) {\n+    return match.map(sanitizeMatch);\n+  }\n+  const sanitized = { ...match };\n+  delete sanitized.$where;\n+  for (const key in sanitized) {\n+    if (sanitized[key] && typeof sanitized[key] === 'object') {\n+      sanitized[key] = sanitizeMatch(sanitized[key]);\n+    }\n+  }\n+  return sanitized;\n+}\n+\n function _getLocalFieldValues(doc, localField, model, options, virtual, schema) {\n   // Get Local fields\n   const localFieldPathType = model.schema._getPathType(localField);\n"}
{"cve":"CVE-2022-35949:0708", "fix_patch": ""}
{"cve":"CVE-2022-0691:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex c5a2a11..b089f25 100644\n--- a/index.js\n+++ b/index.js\n@@ -135,7 +135,7 @@ function isSpecial(scheme) {\n  */\n function extractProtocol(address, location) {\n   address = trimLeft(address);\n-  address = address.replace(CRHTLF, '');\n+  address = address.replace(CRHTLF, '').replace(/\\\\/g, '/');\n   location = location || {};\n \n   var match = protocolre.exec(address);\n@@ -236,7 +236,7 @@ function resolve(relative, base) {\n  */\n function Url(address, location, parser) {\n   address = trimLeft(address);\n-  address = address.replace(CRHTLF, '');\n+  address = address.replace(CRHTLF, '').replace(/\\\\/g, '/');\n \n   if (!(this instanceof Url)) {\n     return new Url(address, location, parser);\n"}
{"cve":"CVE-2019-10787:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 16654d1..fda869c 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,4 +1,4 @@\n-var exec = require('child_process').exec;\n+var spawn = require('child_process').spawn;\n var aspect = require('aspectratio');\n var dirname = require('path').dirname;\n var basename = require('path').basename;\n@@ -7,9 +7,14 @@ var join = require('path').join;\n var sprintf = require('util').format;\n \n module.exports = function(image, output, cb) {\n-  var cmd = module.exports.cmd(image, output);\n-  exec(cmd, {timeout: 30000}, function(e, stdout, stderr) {\n-    if (e) { return cb(e); }\n+  var args = module.exports.args(image, output);\n+  var convert = spawn('convert', args, {timeout: 30000});\n+var stdout = '';\n+var stderr = '';\n+convert.stdout.on('data', (data) => { stdout += data; });\n+convert.stderr.on('data', (data) => { stderr += data; });\n+convert.on('close', function(code) {\n+    if (code !== 0) { return cb(new Error(`Command failed with code ${code}: ${stderr}`)); }\n     if (stderr) { return cb(new Error(stderr)); }\n \n     return cb(null, output.versions);\n@@ -98,18 +103,20 @@ module.exports.path = function(src, opts) {\n };\n \n /**\n- * Get convert command\n+ * Get convert command arguments\n  *\n  * @param object image - original image object\n  * @param Array versions - derivated versions\n  *\n- * @return string convert command\n+ * @return array convert command arguments\n  */\n-module.exports.cmd = function(image, output) {\n-  var cmd = [\n-    sprintf(\n-      'convert %s -auto-orient -strip -write mpr:%s +delete', image.path, image.path\n-    )\n+module.exports.args = function(image, output) {\n+  var args = [\n+    image.path,\n+    '-auto-orient',\n+    '-strip',\n+    '-write', `mpr:${image.path}`,\n+    '+delete'\n   ];\n \n   for (var i = 0; i < output.versions.length; i++) {\n@@ -125,10 +132,10 @@ module.exports.cmd = function(image, output) {\n       suffix: version.suffix || ''\n     });\n \n-    cmd.push(module.exports.cmdVersion(image, version, last));\n+    args.push(...module.exports.cmdVersion(image, version, last));\n   }\n \n-  return cmd.join(' ');\n+  return args;\n };\n \n /**\n@@ -153,7 +160,7 @@ module.exports.cmdVersion = function(image, version, last) {\n \n   // -background\n   if (version.background) {\n-    cmd.push(sprintf('-background \"%s\"', version.background));\n+    cmd.push('-background', version.background);\n   }\n \n   // -flatten\n@@ -164,14 +171,14 @@ module.exports.cmdVersion = function(image, version, last) {\n   // -crop\n   var crop = module.exports.crop(image, version.aspect);\n   if (crop.geometry) {\n-    cmd.push(sprintf('-crop \"%s\"', crop.geometry));\n+    cmd.push('-crop', crop.geometry);\n   }\n \n   // -resize\n   // http://www.imagemagick.org/script/command-line-processing.php#geometry\n   var resize = module.exports.resize(crop, version);\n   if (resize) {\n-    cmd.push(sprintf('-resize \"%s\"', resize));\n+    cmd.push('-resize', resize);\n   }\n \n   // -write\n@@ -181,5 +188,5 @@ module.exports.cmdVersion = function(image, version, last) {\n     cmd.push(sprintf('-write %s +delete', version.path));\n   }\n \n-  return cmd.join(' ');\n+  return args;\n };\n"}
{"cve":"CVE-2020-7687:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 2100676..32e9c9d 100644\n--- a/index.js\n+++ b/index.js\n@@ -10,8 +10,18 @@ module.exports = function (port, root, wordy) {\n     if (port === undefined) port = 80;\n     var server = http.createServer(function (req, res) {\n \n-        var uri = url.parse(req.url).pathname,\n-            filename = path.join(root, uri);\n+        var uri = url.parse(req.url).pathname;\n+        // Decode URI to handle encoded path traversal sequences\n+        var decodedUri = decodeURIComponent(uri);\n+        // Resolve the path relative to root and normalize\n+        var filename = path.resolve(path.join(root, decodedUri));\n+        // Check if the resolved path is within the root directory\n+        if (!filename.startsWith(path.resolve(root) + path.sep)) {\n+            if (wordy) console.log('Path traversal attempt blocked');\n+            res.writeHead(403, {'Content-Type': 'text/plain'});\n+            res.end('Forbidden');\n+            return;\n+        }\n \n         if (uri.charAt(uri.length - 1) === '/') {\n             filename += 'index.html';\n"}
{"cve":"CVE-2018-16482:0708", "fix_patch": "diff --git a/lib/staticFileHandler.js b/lib/staticFileHandler.js\nindex cfdc1c7..de1db83 100644\n--- a/lib/staticFileHandler.js\n+++ b/lib/staticFileHandler.js\n@@ -22,6 +22,13 @@ module.exports = function staticFileListener(options, nextHandler){\n             filePath = mockedFilePath;\n \n         var file = path.normalize(path.join(root,filePath));\n+\n+        // Validate path is within root directory\n+        var relativePath = path.relative(root, file);\n+        if (relativePath.startsWith('..') || path.isAbsolute(relativePath)) {\n+            return statusHandlers[403](res, nextHandler, { error: 'Access denied' });\n+        }\n+\n         fs.stat(file,function(error, stats){\n             if(error)\n                 return statusHandlers[500](res, nextHandler, { error: error });\n"}
{"cve":"CVE-2021-23363:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex a827f37..92f239a 100644\n--- a/index.js\n+++ b/index.js\n@@ -3,6 +3,9 @@\n const exec = require('child_process').execSync\n \n exports.killByPort = function (port) {\n+  if (typeof port !== 'number' || !Number.isInteger(port) || port < 1 || port > 65535) {\n+    throw new Error('Invalid port number');\n+  }\n   var processId = null\n   try {\n     processId = exec(`lsof -t -i:${port}`)\n"}
{"cve":"CVE-2019-10788:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex d85f5ff..12641e9 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,7 +1,7 @@\n /*jshint laxbreak:true */\n \n var sizeParser = require('filesize-parser');\n-var exec = require('child_process').exec, child;\n+var { execFile } = require('child_process');\n \n module.exports = function(path, opts, cb) {\n   if (!cb) {\n@@ -9,10 +9,10 @@ module.exports = function(path, opts, cb) {\n     opts = {};\n   }\n \n-  var cmd = module.exports.cmd(path, opts);\n+  var args = module.exports.cmd(path, opts);\n   opts.timeout = opts.timeout || 5000;\n \n-  exec(cmd, opts, function(e, stdout, stderr) {\n+  execFile('identify', args, opts, function(e, stdout, stderr) {\n     if (e) { return cb(e); }\n     if (stderr) { return cb(new Error(stderr)); }\n \n@@ -33,7 +33,7 @@ module.exports.cmd = function(path, opts) {\n     (opts.exif ? '%[exif:*]' : '')\n   ].join(\"\\n\");\n \n-  return 'identify -format \"' + format + '\" ' + path;\n+  return ['-format', format, path];\n };\n \n module.exports.parse = function(path, stdout, opts) {\n"}
{"cve":"CVE-2020-7675:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/messenger-node.js b/src/messenger-node.js\nindex ec76b26..006686a 100755\n--- a/src/messenger-node.js\n+++ b/src/messenger-node.js\n@@ -68,7 +68,7 @@ const messenger = {\n   line: color => {\n     if (color.length > 0) {\n       try {\n-        eval(`cl.${color}()`); // eslint-disable-line\n+        if (typeof cl[color] === 'function') { cl[color](); } else { throw new Error('Invalid color method'); }\n       }\n       catch (e) {\n         console.error(chalk.bgRed.bold(`Invalid Color: ${color}`));\n"}
{"cve":"CVE-2019-15597:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex 767584b..11370c5 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -1,4 +1,4 @@\n-var exec = require('child_process').exec\n+var execFile = require('child_process').execFile\n var parse = require('./parse')\n \n module.exports = function df(aOptions, aCallback) {\n@@ -33,12 +33,12 @@ module.exports = function df(aOptions, aCallback) {\n \n     // TODO: should fail if unit is not a string\n \n-    var command = 'df -kP'\n+    var args = ['-kP'];\n     if (options.file) {\n-        command += ' ' + options.file\n+        args.push(options.file);\n     }\n \n-    exec(command, function(err, stdout, stderr) {\n+    execFile('df', args, function(err, stdout, stderr) {\n         if (err) {\n             callback(err)\n             return\n"}
{"cve":"CVE-2020-7627:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/key-sender.js b/key-sender.js\nindex 2093f04..5c03443 100644\n--- a/key-sender.js\n+++ b/key-sender.js\n@@ -112,7 +112,8 @@ module.exports = function() {\n         return new Promise(function(resolve, reject) {\n             var jarPath = path.join(__dirname, 'jar', 'key-sender.jar');\n \n-            var command = 'java -jar \\\"' + jarPath + '\\\" ' + arrParams.join(' ') + module.getCommandLineOptions();\n+            var escapedParams = arrParams.map(param => param.replace(/[^a-zA-Z0-9_-]/g, ''));\n+var command = 'java -jar \\\"' + jarPath + '\\\" ' + escapedParams.join(' ') + module.getCommandLineOptions();\n \n             return exec(command, {}, function(error, stdout, stderr) {\n                 if (error == null) {\n"}
{"cve":"CVE-2020-7631:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/posix.js b/lib/posix.js\nindex 76b4b98..b73b873 100644\n--- a/lib/posix.js\n+++ b/lib/posix.js\n@@ -1,6 +1,6 @@\n 'use strict';\n \n-var exec = require('child_process').exec;\n+var execFile = require('child_process').execFile;\n var isDigits = require('./utils').isDigits;\n \n function diskusage(path, cb) {\n@@ -8,7 +8,7 @@ function diskusage(path, cb) {\n         return cb(new Error('Paths with double quotes are not supported yet'));\n     }\n \n-    exec('df -k \"' + path + '\"', function(err, stdout) {\n+    execFile('df', ['-k', path], function(err, stdout) {\n         if (err) {\n             return cb(err);\n         }\n"}
{"cve":"CVE-2020-7795:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex a207f28..f9aabff 100644\n--- a/index.js\n+++ b/index.js\n@@ -11,9 +11,9 @@ module.exports = function (packageName, { registry = '', timeout = null } = {})\n         }\n \n         if (registry) {\n-            version = require('child_process').execSync(`npm view ${packageName} version --registry ${registry}`, config);\n+            version = require('child_process').execFileSync('npm', ['view', packageName, 'version', '--registry', registry], config);\n         } else {\n-            version = require('child_process').execSync(`npm view ${packageName} version`, config);\n+            version = require('child_process').execFileSync('npm', ['view', packageName, 'version'], config);\n         }\n \n         if (version) {\n"}
{"cve":"CVE-2018-3772:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 88a62e9..d34ca58 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,15 +1,15 @@\n var cp = require('child_process');\n \n module.exports = function whereis(name, cb) {\n-  cp.exec('which ' + name, function(error, stdout, stderr) {\n+  cp.execFile('which', [name], function(error, stdout, stderr) {\n     stdout = stdout.split('\\n')[0];\n     if (error || stderr || stdout === '' || stdout.charAt(0) !== '/') {\n       stdout = stdout.split('\\n')[0];\n-      cp.exec('whereis ' + name, function(error, stdout, stderr) {\n+      cp.execFile('whereis', [name], function(error, stdout, stderr) {\n         if (error || stderr || stdout === '' || stdout.indexOf( '/' ) === -1) {\n-          cp.exec('where ' + name, function (error, stdout, stderr) { //windows\n+          cp.execFile('where', [name], function (error, stdout, stderr) { //windows\n             if (error || stderr || stdout === '' || stdout.indexOf('\\\\') === -1) {\n-              cp.exec('for %i in (' + name + '.exe) do @echo. %~$PATH:i', function (error, stdout, stderr) { //windows xp\n+              cp.exec('for %i in (\\\"' + name.replace(/\\\"/g, '\\\\\\\"') + '.exe\\\") do @echo. %~$PATH:i', function (error, stdout, stderr) { //windows xp\n                 if (error || stderr || stdout === '' || stdout.indexOf('\\\\') === -1) {\n                   return cb(new Error('Could not find ' + name + ' on your system'));\n                 }\n"}
{"cve":"CVE-2020-7640:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/class.js b/class.js\nindex 28476eb..0d43d8c 100644\n--- a/class.js\n+++ b/class.js\n@@ -20,10 +20,9 @@ exports.create = function create(members) {\n \t\t}\n \t\telse {\n \t\t\t// inherit parent's constructor\n-\t\t\tvar code = members.__parent.toString();\n-\t\t\tvar args = code.substring( code.indexOf(\"(\")+1, code.indexOf(\")\") );\n-\t\t\tvar inner_code = code.substring( code.indexOf(\"{\")+1, code.lastIndexOf(\"}\") );\n-\t\t\teval('constructor = function ('+args+') {'+inner_code+'};');\n+\t\t\tconstructor = function(...args) {\n+\t\t\t\tmembers.__parent.apply(this, args);\n+\t\t\t};\n \t\t}\n \t\t\n \t\t// inherit rest of parent members\n"}
{"cve":"CVE-2017-16198:0708", "fix_patch": "diff --git a/index.js b/index.js\nindex cad0b67..292b22c 100644\n--- a/index.js\n+++ b/index.js\n@@ -40,6 +40,15 @@ var main = function(req, res) {\n         //\u4f7f\u7528\u8def\u5f84\u89e3\u6790\u6a21\u5757,\u7ec4\u88c5\u5b9e\u9645\u6587\u4ef6\u8def\u5f84 \n         var filePath = path.join(argvs.getPath(), pathName);\n \n+    // Prevent directory traversal attacks\n+    const baseDir = path.resolve(argvs.getPath());\n+    const resolvedPath = path.resolve(filePath);\n+    if (!resolvedPath.startsWith(baseDir)) {\n+        res.writeHead(403);\n+        res.end('<h1>403 Forbidden</h1>');\n+        return;\n+    }\n+\n         //\u5224\u65ad\u6587\u4ef6\u662f\u5426\u5b58\u5728 \n         fs.exists(filePath, function(exists) {\n             try{\n"}
{"cve":"CVE-2020-7674:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/encode.js b/lib/encode.js\nindex 6756d1e..a4c1803 100644\n--- a/lib/encode.js\n+++ b/lib/encode.js\n@@ -1,9 +1,19 @@\n 'use strict';\n \n function template(literal, data) {\n-  var tmpl = literal.replace(/(\\$\\{)/gm, '$1data.');\n-\n-  return eval('`' + tmpl + '`');\n+  return literal.replace(/\\$\\{([^}]+)\\}/g, (match, key) => {\n+    const keys = key.split('.');\n+    let value = data;\n+    for (const k of keys) {\n+      if (value && typeof value === 'object' && k in value) {\n+        value = value[k];\n+      } else {\n+        value = '';\n+        break;\n+      }\n+    }\n+    return value;\n+  });\n }\n \n function encodeStatements(statements, data) {\n"}
{"cve":"CVE-2021-23376:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 8a9c7ea..aa85751 100644\n--- a/index.js\n+++ b/index.js\n@@ -1,4 +1,4 @@\n-const { exec } = require(\"child_process\");\n+const { exec, execFile } = require(\"child_process\");\n const fs = require(\"fs\");\n \n const filestostring = array => {\n@@ -216,8 +216,8 @@ const ffmpegjs = {\n   trimvideo: (input, start, duration, output) => {\n     return new Promise(function(resolve, reject) {\n       if (fs.existsSync(input)) {\n-        exec(\n-          `ffmpeg -hide_banner -loglevel quiet -ss ${start} -i ${input} -t ${duration} -c copy -y ${output}.mp4`,\n+        execFile(\n+          \"ffmpeg\", [\"-hide_banner\", \"-loglevel\", \"quiet\", \"-ss\", start, \"-i\", input, \"-t\", duration, \"-c\", \"copy\", \"-y\", `${output}.mp4`],\n           (error, stdout, stderr) => {\n             if (error) {\n               reject(error);\n"}
{"cve":"CVE-2020-28494:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/image.js b/image.js\nindex 19631b27..12128a23 100755\n--- a/image.js\n+++ b/image.js\n@@ -34,7 +34,7 @@ const Fs = require('fs');\n const REGEXP_SVG = /(width=\"\\d+\")+|(height=\"\\d+\")+/g;\n const REGEXP_PATH = /\\//g;\n const REGEXP_ESCAPE = /'/g;\n-const SPAWN_OPT = { shell: true };\n+const SPAWN_OPT = { shell: false };\n const D = require('os').platform().substring(0, 3).toLowerCase() === 'win' ? '\"' : '\\'';\n const CMD_CONVERT = { gm: 'gm', im: 'convert', magick: 'magick' };\n const CMD_CONVERT2 = { gm: 'gm convert', im: 'convert', magick: 'magick' };\n"}
{"cve":"CVE-2020-7613:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 7cdbddf..630f7d4 100755\n--- a/index.js\n+++ b/index.js\n@@ -484,15 +484,12 @@ class NodeClam {\n             return false;\n         }\n \n-        const version_cmds = {\n-            clamdscan: `${path} --version`,\n-            clamscan: `${path} --version`,\n-        };\n+        const versionArgs = ['--version'];\n \n         try {\n             await fs_access(path, fs.constants.R_OK);\n \n-            const {stdout} = await cp_exec(version_cmds[scanner]);\n+            const {stdout} = await cp_execfile(path, versionArgs);\n             if (stdout.toString().match(/ClamAV/) === null) {\n                 if (this.settings.debug_mode) console.log(`${this.debug_label}: Could not verify the ${scanner} binary.`);\n                 return false;\n"}
{"cve":"CVE-2020-28437:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/get.js b/lib/get.js\nindex 25abee9..1ff3856 100644\n--- a/lib/get.js\n+++ b/lib/get.js\n@@ -1,6 +1,6 @@\n-var exec = require('child_process').exec\n+var execFile = require('child_process').execFile\n module.exports = function(app, cb) {\n-  exec('heroku config --app ' + app, function(err, stdout) {\n+  execFile('heroku', ['config', '--app', app], function(err, stdout) {\n     if(err) return cb(err);\n     var config = {}\n     var lines = stdout.split('\\n')\n"}
{"cve":"CVE-2017-16083:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/router.js b/lib/router.js\nindex be232b9..6803074 100644\n--- a/lib/router.js\n+++ b/lib/router.js\n@@ -730,7 +730,12 @@\n     };\n     dispatch[\"static\"] = function(pathname, req, res) {\n       var full_path;\n-      full_path = \"\" + dispatch.static_route + (unescape(pathname));\n+      var userPath = unescape(pathname);\n+var sanitizedPath = path_tools.resolve(dispatch.static_route, userPath);\n+if (!sanitizedPath.startsWith(dispatch.static_route)) {\n+  return dispatch._403(null, res, pathname, \"Access denied\");\n+}\n+var full_path = sanitizedPath;\n       return fs.exists(full_path, function(exists) {\n         var e, error;\n         if (exists) {\n@@ -837,7 +842,12 @@\n       var body, child, d, data, e, env, error, full_path, isPHP, prepareChild, respbuffer, urlobj;\n       urlobj = urlparse(req.url);\n       respbuffer = '';\n-      full_path = \"\" + dispatch.static_route + (unescape(pathname));\n+      var userPath = unescape(pathname);\n+var sanitizedPath = path_tools.resolve(dispatch.static_route, userPath);\n+if (!sanitizedPath.startsWith(dispatch.static_route)) {\n+  return dispatch._403(null, res, pathname, \"Access denied\");\n+}\n+var full_path = sanitizedPath;\n       env = dispatch.getEnv(pathname, req, res);\n       isPHP = !!pathname.match(/\\.php$/);\n       prepareChild = function(req_body) {\n"}
{"cve":"CVE-2016-10548:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 74ea51b..25a30c3 100755\n--- a/index.js\n+++ b/index.js\n@@ -70,6 +70,10 @@ function reduceCSSCalc(value, decimalPrecision) {\n     // Remove units in expression:\n     var toEvaluate = expression.replace(new RegExp(unit, \"gi\"), \"\")\n     var result\n+    var allowedChars = /^[0-9+\\-*/().\\s]+$/;\n+    if (!allowedChars.test(toEvaluate)) {\n+      return functionIdentifier + \"(\" + expression + \")\";\n+    }\n \n     try {\n       result = eval(toEvaluate)\n"}
{"cve":"CVE-2018-3733:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/crud-file-server.js b/crud-file-server.js\nindex e598241..cb4dfdc 100644\n--- a/crud-file-server.js\n+++ b/crud-file-server.js\n@@ -1,12 +1,21 @@\n var fs = require('fs');\n+var path = require('path');\n \n // don't let users crawl up the folder structure by using a/../../../c/d\n var cleanUrl = function(url) { \n \turl = decodeURIComponent(url);\n-\twhile(url.indexOf('..').length > 0) { url = url.replace('..', ''); }\n \treturn url;\n };\n \n+function validatePath(rootDir, userPath) {\n+\tvar resolvedPath = path.resolve(rootDir, userPath);\n+\tvar normalizedRoot = path.resolve(rootDir);\n+\tif (!resolvedPath.startsWith(normalizedRoot)) {\n+\t\tthrow new Error('Path traversal attempt detected');\n+\t}\n+\treturn resolvedPath;\n+};\n+\n /*  \n example usage:\n \trequire('http').createServer(function (req, res) {\n"}
{"cve":"CVE-2020-7781:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 614a6d6..c70179d 100644\n--- a/index.js\n+++ b/index.js\n@@ -10,9 +10,8 @@ let SOCKET_TIMEOUT = 1000;   //Setting 1s as max acceptable timeout\n function testSync(host, port, connectTimeout) {\n     const nodeBinary = process.execPath;\n     const scriptPath = path.join(__dirname, \"./scripts/connection-tester\");\n-    const cmd = util.format('\"%s\" \"%s\" %s %s %s', nodeBinary, scriptPath, host, port, connectTimeout);\n-\n-    const shellOut = shell.execSync(cmd).toString();\n+    const args = [scriptPath, host, port, connectTimeout];\n+    const shellOut = shell.execFileSync(nodeBinary, args).toString();\n \n     const output = {\n         success: false,\n"}
{"cve":"CVE-2020-15084:0708", "fix_patch": "diff --git a/lib/index.js b/lib/index.js\nindex f5da77f..c4aeca4 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -17,7 +17,7 @@ function wrapStaticSecretInCallback(secret){\n }\n \n module.exports = function(options) {\n-  if (!options || !options.secret) throw new Error('secret should be set');\n+  if (!options || !options.secret || !options.algorithms) throw new Error('secret and algorithms should be set');\n \n   var secretCallback = options.secret;\n \n"}
{"cve":"CVE-2022-2421:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/binary.js b/binary.js\nindex 3e2347d..a884f84 100644\n--- a/binary.js\n+++ b/binary.js\n@@ -70,13 +70,17 @@ exports.reconstructPacket = function(packet, buffers) {\n function _reconstructPacket(data, buffers) {\n   if (!data) return data;\n \n-  if (data && data._placeholder) {\n-    return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n+  if (typeof data === 'object' && data !== null && data._placeholder) {\n+    // Validate placeholder structure and buffer index\n+    if (typeof data.num !== 'number' || data.num < 0 || data.num >= buffers.length) {\n+      throw new Error('Invalid placeholder buffer index: ' + data.num);\n+    }\n+    return buffers[data.num];\n   } else if (isArray(data)) {\n     for (var i = 0; i < data.length; i++) {\n       data[i] = _reconstructPacket(data[i], buffers);\n     }\n-  } else if (typeof data === 'object') {\n+  } else if (typeof data === 'object' && data !== null) {\n     for (var key in data) {\n       data[key] = _reconstructPacket(data[key], buffers);\n     }\n"}
{"cve":"CVE-2022-29822:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex ad1d760..085eaa2 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -88,6 +88,12 @@ class Service extends AdapterService {\n \n       const converted = Object.keys(query).reduce((result, prop) => {\n         const value = query[prop];\n+        \n+        // Only allow whitelisted properties to prevent SQL injection\n+        if (!whitelist.includes(prop)) {\n+          return result;\n+        }\n+        \n         const key = operators[prop] ? operators[prop] : prop;\n \n         result[key] = convertOperators(value);\n"}
{"cve":"CVE-2023-28155:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/redirect.js b/lib/redirect.js\nindex 500252c..941dde1 100644\n--- a/lib/redirect.js\n+++ b/lib/redirect.js\n@@ -114,7 +114,7 @@ Redirect.prototype.onResponse = function (response, callback) {\n \n     // handle the case where we change protocol from https to http or vice versa\n     if (request.uri.protocol !== uriPrev.protocol) {\n-      delete request.agent\n+      return callback(new Error('Cross-protocol redirects are not allowed'));\n     }\n \n     self.redirects.push({ statusCode: response.statusCode, redirectUri: redirectTo })\n"}
{"cve":"CVE-2022-2900:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex b806431..7d482e1 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -59,12 +59,22 @@ const parseUrl = (url, normalize = false) => {\n     if (parsed.protocol === \"file\") {\n         const matched  = parsed.href.match(GIT_RE)\n         if (matched) {\n-            parsed.protocols = [\"ssh\"]\n-            parsed.protocol = \"ssh\"\n-            parsed.resource = matched[4]\n-            parsed.host = matched[4]\n-            parsed.user = \"git\"\n-            parsed.pathname = `/${matched[6]}`\n+            const resource = matched[4];\n+            // Validate resource to prevent SSRF (CVE-2022-2900)\n+            const isIpAddress = /^(?:[0-9]{1,3}\\.){3}[0-9]{1,3}$/.test(resource);\n+            const isLocalhost = resource.includes('localhost');\n+            \n+            if (isIpAddress || isLocalhost) {\n+                // Reject conversion for IP addresses and localhost to prevent SSRF\n+                return parsed;\n+            }\n+            \n+            parsed.protocols = [\"ssh\"];\n+            parsed.protocol = \"ssh\";\n+            parsed.resource = resource;\n+            parsed.host = resource;\n+            parsed.user = \"git\";\n+            parsed.pathname = `/${matched[6]}`;\n         }\n     }\n \n"}
{"cve":"CVE-2018-3778:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/client.js b/lib/client.js\nindex 644589d..b30c822 100644\n--- a/lib/client.js\n+++ b/lib/client.js\n@@ -242,14 +242,18 @@ Client.prototype.close = function (done) {\n \n   function finish () {\n     if (!that.disconnected && that.will) {\n-      that.broker.publish(that.will, that, function (err) {\n-        if (!err) {\n-          that.broker.persistence.delWill({\n-            id: that.id,\n-            brokerId: that.broker.id\n-          }, nop)\n-        }\n-      })\n+      // Check authorization before publishing LWT\n+      var authorized = that.broker.authorizeForward(that, that.will);\n+      if (authorized) {\n+        that.broker.publish(that.will, that, function (err) {\n+          if (!err) {\n+            that.broker.persistence.delWill({\n+              id: that.id,\n+              brokerId: that.broker.id\n+            }, nop)\n+          }\n+        })\n+      }\n       that.will = null // this function might be called twice\n     }\n \n"}
{"cve":"CVE-2022-0686:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex d808b13..6a84c7b 100644\n--- a/index.js\n+++ b/index.js\n@@ -539,18 +539,6 @@ function toString(stringify) {\n   } else if (url.password) {\n     result += ':'+ url.password;\n     result += '@';\n-  } else if (\n-    url.protocol !== 'file:' &&\n-    isSpecial(url.protocol) &&\n-    !url.host &&\n-    url.pathname !== '/'\n-  ) {\n-    //\n-    // Add back the empty userinfo, otherwise the original invalid URL\n-    // might be transformed into a valid one with `url.pathname` as host.\n-    //\n-    result += '@';\n-  }\n \n   result += url.host + url.pathname;\n \n"}
{"cve":"CVE-2024-30260:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/handler/redirect-handler.js b/lib/handler/redirect-handler.js\nindex 368ef520..7b1c9c5b 100644\n--- a/lib/handler/redirect-handler.js\n+++ b/lib/handler/redirect-handler.js\n@@ -203,7 +203,7 @@ function shouldRemoveHeader (header, removeContent, unknownOrigin) {\n   }\n   if (unknownOrigin && (header.length === 13 || header.length === 6)) {\n     const name = util.headerNameToString(header)\n-    return name === 'authorization' || name === 'cookie'\n+    return name === 'authorization' || name === 'proxy-authorization' || name === 'cookie'\n   }\n   return false\n }\n"}
{"cve":"CVE-2025-23221:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/webfinger/lookup.ts b/src/webfinger/lookup.ts\nindex 45952a3..c15234c 100644\n--- a/src/webfinger/lookup.ts\n+++ b/src/webfinger/lookup.ts\n@@ -15,16 +15,25 @@ export async function lookupWebFinger(\n   resource: URL | string,\n ): Promise<ResourceDescriptor | null> {\n   if (typeof resource === \"string\") resource = new URL(resource);\n-  let protocol = \"https:\";\n+  const protocol = \"https:\"; // Force HTTPS only\n   let server: string;\n+  const ALLOWED_PORTS = new Set([443]);\n+  const VALID_HOST_REGEX = /^[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n   if (resource.protocol === \"acct:\") {\n     const atPos = resource.pathname.lastIndexOf(\"@\");\n     if (atPos < 0) return null;\n     server = resource.pathname.substring(atPos + 1);\n     if (server === \"\") return null;\n+  if (!VALID_HOST_REGEX.test(server.split(':')[0]) || (server.includes(':') && !ALLOWED_PORTS.has(parseInt(server.split(':')[1])))) {\n+    logger.error(\"Invalid host or port in WebFinger request: {server}\", { server });\n+    return null;\n+  }\n   } else {\n-    protocol = resource.protocol;\n     server = resource.host;\n+  if (!VALID_HOST_REGEX.test(server.split(':')[0]) || (server.includes(':') && !ALLOWED_PORTS.has(parseInt(server.split(':')[1])))) {\n+    logger.error(\"Invalid host or port in WebFinger request: {server}\", { server });\n+    return null;\n+  }\n   }\n   let url = new URL(`${protocol}//${server}/.well-known/webfinger`);\n   url.searchParams.set(\"resource\", resource.href);\n"}
{"cve":"CVE-2022-0512:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 702308b..5205864 100644\n--- a/index.js\n+++ b/index.js\n@@ -287,7 +287,7 @@ function Url(address, location, parser) {\n         extracted.slashesCount < 2 ||\n         !isSpecial(url.protocol)))\n   ) {\n-    instructions[3] = [/(.*)/, 'pathname'];\n+    instructions[3] = [/([^?#]*)/, 'pathname'];\n   }\n \n   for (; i < instructions.length; i++) {\n"}
{"cve":"CVE-2022-0639:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 517b6b6..d32d70f 100644\n--- a/index.js\n+++ b/index.js\n@@ -536,9 +536,6 @@ function toString(stringify) {\n     result += url.username;\n     if (url.password) result += ':'+ url.password;\n     result += '@';\n-  } else if (url.password) {\n-    result += ':'+ url.password;\n-    result += '@';\n   }\n \n   result += url.host + url.pathname;\n"}
{"cve":"CVE-2021-23387:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex e7ea1ab..ddc1e34 100644\n--- a/index.js\n+++ b/index.js\n@@ -31,6 +31,7 @@ function createTrailing (_options, _next) {\n     } else {\n       url.pathname = url.pathname.slice(0, -1)\n     }\n+    url.pathname = url.pathname.replace(/^\\/+/, '/');\n \n     res.statusCode = status\n     res.setHeader('Location', u.format(url))\n"}
{"cve":"CVE-2018-3734:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 5fcd266..80896c7 100644\n--- a/index.js\n+++ b/index.js\n@@ -50,10 +50,17 @@ module.exports.listen = function (port, cb) {\n             res.setHeader(\"Access-Control-Allow-Headers\", \"X-Requested-With,content-type\");\n         }\n         let pathname = url.parse(req.url).pathname;\n-        let localPath = path.join(options.folder, pathname);\n+        // Sanitize path to prevent path traversal\n+        let sanitizedPath = path.normalize(pathname).replace(/^(\\.\\.\\/|\\\\)/, '');\n+        let localPath = path.join(options.folder, sanitizedPath);\n+        // Check if the resolved path is within the allowed directory\n+        let resolvedLocalPath = path.resolve(localPath);\n+        if (!resolvedLocalPath.startsWith(options.folder)) {\n+            return errorPage(res, 403, \"Access denied\");\n+        }\n         if (path.extname(localPath) === \"\") {\n             //Add the index file to the local path\n-            localPath = path.join(localPath, \"./\" + path.basename(options.index));\n+            localPath = path.join(localPath, path.basename(options.index));\n         }\n \n         //Reponse finish event\n"}
{"cve":"CVE-2020-8132:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 4fa6231..bb9e294 100644\n--- a/index.js\n+++ b/index.js\n@@ -6,6 +6,7 @@ var path = require(\"path\");\n var fs   = require(\"fs\");\n var util = require(\"util\");\n var exec = require(\"child_process\").exec;\n+var execFile = require(\"child_process\").execFile;\n \n function PDFImage(pdfFilePath, options) {\n   if (!options) options = {};\n@@ -23,10 +24,7 @@ function PDFImage(pdfFilePath, options) {\n \n PDFImage.prototype = {\n   constructGetInfoCommand: function () {\n-    return util.format(\n-      \"pdfinfo \\\"%s\\\"\",\n-      this.pdfFilePath\n-    );\n+    return ['pdfinfo', this.pdfFilePath];\n   },\n   parseGetInfoCommandOutput: function (output) {\n     var info = {};\n@@ -41,7 +39,7 @@ PDFImage.prototype = {\n     var self = this;\n     var getInfoCommand = this.constructGetInfoCommand();\n     var promise = new Promise(function (resolve, reject) {\n-      exec(getInfoCommand, function (err, stdout, stderr) {\n+      execFile(getInfoCommand[0], getInfoCommand.slice(1), function (err, stdout, stderr) {\n         if (err) {\n           return reject({\n             message: \"Failed to get PDF'S information\",\n@@ -82,15 +80,26 @@ PDFImage.prototype = {\n     this.convertExtension = convertExtension || \"png\";\n   },\n   constructConvertCommandForPage: function (pageNumber) {\n-    var pdfFilePath = this.pdfFilePath;\n-    var outputImagePath = this.getOutputImagePathForPage(pageNumber);\n-    var convertOptionsString = this.constructConvertOptions();\n-    return util.format(\n-      \"%s %s\\\"%s[%d]\\\" \\\"%s\\\"\",\n-      this.useGM ? \"gm convert\" : \"convert\",\n-      convertOptionsString ? convertOptionsString + \" \" : \"\",\n-      pdfFilePath, pageNumber, outputImagePath\n-    );\n+    var args = [];\n+    if (this.useGM) {\n+      args.push('gm', 'convert');\n+    } else {\n+      args.push('convert');\n+    }\n+\n+    // Add convert options\n+    Object.keys(this.convertOptions).sort().forEach(function (optionName) {\n+      if (this.convertOptions[optionName] !== null) {\n+        args.push(optionName, this.convertOptions[optionName]);\n+      } else {\n+        args.push(optionName);\n+      }\n+    }, this);\n+\n+    // Add input and output paths\n+    args.push(this.pdfFilePath + '[' + pageNumber + ']', this.getOutputImagePathForPage(pageNumber));\n+\n+    return args;\n   },\n   constructCombineCommandForFile: function (imagePaths) {\n     return util.format(\n@@ -167,7 +176,7 @@ PDFImage.prototype = {\n \n     var promise = new Promise(function (resolve, reject) {\n       function convertPageToImage() {\n-        exec(convertCommand, function (err, stdout, stderr) {\n+        execFile(convertCommand[0], convertCommand.slice(1), function (err, stdout, stderr) {\n           if (err) {\n             return reject({\n               message: \"Failed to convert page to image\",\n"}
{"cve":"CVE-2018-3785:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 38d70b1..9cd53b1 100644\n--- a/index.js\n+++ b/index.js\n@@ -12,7 +12,7 @@ function makeDefault(str) {\n }\n \n module.exports = function (msg, silent) {\n-\tvar arg = '';\n+\tconst args = ['commit'];\n \n \tmsg = makeDefault(msg);\n \n@@ -25,16 +25,17 @@ module.exports = function (msg, silent) {\n \t\t\tmsg.forEach(function (m) {\n \t\t\t\tm = makeDefault(m);\n \n-\t\t\t\targ += '-m\"' + m + '\" ';\n+\t\t\t\targs.push('-m', m);\n \t\t\t});\n \t\t} else {\n-\t\t\targ = '-m\"' + defaultMsg + '\"';\n+\t\t\targs.push('-m', defaultMsg);\n \t\t}\n \t} else {\n-\t\targ = '-m\"' + msg + '\"';\n+\t\targs.push('-m', msg);\n \t}\n \n-\tshell.exec('git commit ' + arg + ' --allow-empty --no-gpg-sign', {\n+\targs.push('--allow-empty', '--no-gpg-sign');\n+shell.exec(['git'].concat(args), {\n \t\tsilent: silent\n \t});\n };\n"}
{"cve":"CVE-2017-16042:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/growl.js b/lib/growl.js\nindex 719b5af..f932f32 100644\n--- a/lib/growl.js\n+++ b/lib/growl.js\n@@ -9,7 +9,9 @@ var exec = require('child_process').exec\n   , path = require('path')\n   , exists = fs.existsSync || path.existsSync\n   , os = require('os')\n-  , quote = JSON.stringify\n+  , shellEscape = function(str) {\n+    return \"'\" + (str + '').replace(/'/g, \"'\\\\''\") + \"'\";\n+  }, quote = shellEscape\n   , cmd;\n \n function which(name) {\n@@ -213,7 +215,7 @@ function growl(msg, options, fn) {\n     var priority = options.priority + '';\n     var checkindexOf = cmd.priority.range.indexOf(priority);\n     if (~cmd.priority.range.indexOf(priority)) {\n-      args.push(cmd.priority, options.priority);\n+      args.push(cmd.priority.cmd, quote(options.priority));\n     }\n   }\n \n@@ -230,14 +232,13 @@ function growl(msg, options, fn) {\n   switch(cmd.type) {\n     case 'Darwin-Growl':\n       args.push(cmd.msg);\n-      args.push(quote(msg).replace(/\\\\n/g, '\\n'));\n+      args.push(quote(msg));\n       if (options.title) args.push(quote(options.title));\n       break;\n     case 'Darwin-NotificationCenter':\n       args.push(cmd.msg);\n       var stringifiedMsg = quote(msg);\n-      var escapedMsg = stringifiedMsg.replace(/\\\\n/g, '\\n');\n-      args.push(escapedMsg);\n+      args.push(quote(msg));\n       if (options.title) {\n         args.push(cmd.title);\n         args.push(quote(options.title));\n@@ -253,7 +254,7 @@ function growl(msg, options, fn) {\n       break;\n     case 'Linux-Growl':\n       args.push(cmd.msg);\n-      args.push(quote(msg).replace(/\\\\n/g, '\\n'));\n+      args.push(quote(msg));\n       if (options.title) args.push(quote(options.title));\n       if (cmd.host) {\n         args.push(cmd.host.cmd, cmd.host.hostname)\n@@ -263,13 +264,13 @@ function growl(msg, options, fn) {\n       if (options.title) {\n         args.push(quote(options.title));\n         args.push(cmd.msg);\n-        args.push(quote(msg).replace(/\\\\n/g, '\\n'));\n+        args.push(quote(msg));\n       } else {\n-        args.push(quote(msg).replace(/\\\\n/g, '\\n'));\n+        args.push(quote(msg));\n       }\n       break;\n     case 'Windows':\n-      args.push(quote(msg).replace(/\\\\n/g, '\\n'));\n+      args.push(quote(msg));\n       if (options.title) args.push(cmd.title + quote(options.title));\n       if (options.url) args.push(cmd.url + quote(options.url));\n       break;\n"}
{"cve":"CVE-2022-24794:0708", "fix_patch": "diff --git a/lib/context.js b/lib/context.js\nindex c95e363..95cc6da 100644\n--- a/lib/context.js\n+++ b/lib/context.js\n@@ -187,7 +187,8 @@ class ResponseContext {\n       returnTo = options.returnTo;\n       debug('req.oidc.login() called with returnTo: %s', returnTo);\n     } else if (req.method === 'GET' && req.originalUrl) {\n-      returnTo = req.originalUrl;\n+      const parsedUrl = url.parse(req.originalUrl);\n+      returnTo = parsedUrl.pathname + (parsedUrl.search || \"\");\n       debug('req.oidc.login() without returnTo, using: %s', returnTo);\n     }\n \n"}
{"cve":"CVE-2022-0436:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/grunt/file.js b/lib/grunt/file.js\nindex 7e0e2fb..b10fe09 100644\n--- a/lib/grunt/file.js\n+++ b/lib/grunt/file.js\n@@ -299,7 +299,13 @@ file.copy = function copy(srcpath, destpath, options) {\n     file.mkdir(destpath);\n     // Iterate over all sub-files/dirs, recursing.\n     fs.readdirSync(srcpath).forEach(function(filepath) {\n-      copy(path.join(srcpath, filepath), path.join(destpath, filepath), options);\n+      var resolvedSrcDir = path.resolve(srcpath);\n+      var resolvedSrcFile = path.resolve(srcpath, filepath);\n+      if (!resolvedSrcFile.startsWith(resolvedSrcDir)) {\n+        grunt.log.warn('Skipping invalid path traversal attempt: ' + filepath);\n+        return;\n+      }\n+      copy(resolvedSrcFile, path.join(destpath, filepath), options);\n     });\n   } else {\n     // Copy a single file.\n"}
{"cve":"CVE-2021-32803:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/unpack.js b/lib/unpack.js\nindex 1d86c18..80facec 100644\n--- a/lib/unpack.js\n+++ b/lib/unpack.js\n@@ -417,21 +417,28 @@ class Unpack extends Parser {\n     this[MKDIR](path.dirname(entry.absolute), this.dmode, er => {\n       if (er)\n         return this[ONERROR](er, entry)\n-      fs.lstat(entry.absolute, (er, st) => {\n-        if (st && (this.keep || this.newer && st.mtime > entry.mtime))\n-          this[SKIP](entry)\n-        else if (er || this[ISREUSABLE](entry, st))\n-          this[MAKEFS](null, entry)\n-        else if (st.isDirectory()) {\n-          if (entry.type === 'Directory') {\n-            if (!entry.mode || (st.mode & 0o7777) === entry.mode)\n-              this[MAKEFS](null, entry)\n-            else\n-              fs.chmod(entry.absolute, entry.mode, er => this[MAKEFS](er, entry))\n+      const parentDir = path.dirname(entry.absolute)\n+      fs.lstat(parentDir, (er, st) => {\n+        if (er)\n+          return this[ONERROR](er, entry)\n+        if (st.isSymbolicLink())\n+          return this[ONERROR](new Error(`Unsafe symlink detected in parent directory: ${parentDir}`), entry)\n+        fs.lstat(entry.absolute, (er, st) => {\n+          if (st && (this.keep || this.newer && st.mtime > entry.mtime))\n+            this[SKIP](entry)\n+          else if (er || this[ISREUSABLE](entry, st))\n+            this[MAKEFS](null, entry)\n+          else if (st.isDirectory()) {\n+            if (entry.type === 'Directory') {\n+              if (!entry.mode || (st.mode & 0o7777) === entry.mode)\n+                this[MAKEFS](null, entry)\n+              else\n+                fs.chmod(entry.absolute, entry.mode, er => this[MAKEFS](er, entry))\n+            } else\n+              fs.rmdir(entry.absolute, er => this[MAKEFS](er, entry))\n           } else\n-            fs.rmdir(entry.absolute, er => this[MAKEFS](er, entry))\n-        } else\n-          unlinkFile(entry.absolute, er => this[MAKEFS](er, entry))\n+            unlinkFile(entry.absolute, er => this[MAKEFS](er, entry))\n+        })\n       })\n     })\n   }\n@@ -479,6 +486,10 @@ class UnpackSync extends Unpack {\n     if (er)\n       return this[ONERROR](er, entry)\n     try {\n+      const parentDir = path.dirname(entry.absolute)\n+      const parentSt = fs.lstatSync(parentDir)\n+      if (parentSt.isSymbolicLink())\n+        return this[ONERROR](new Error(`Unsafe symlink detected in parent directory: ${parentDir}`), entry)\n       const st = fs.lstatSync(entry.absolute)\n       if (this.keep || this.newer && st.mtime > entry.mtime)\n         return this[SKIP](entry)\n"}
{"cve":"CVE-2022-0235:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\n"}
{"cve":"CVE-2024-29041:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/response.js b/lib/response.js\nindex fede486c..9ba7fb39 100644\n--- a/lib/response.js\n+++ b/lib/response.js\n@@ -911,6 +911,12 @@ res.location = function location(url) {\n     loc = this.req.get('Referrer') || '/';\n   }\n \n+  // Validate and sanitize the location to prevent open redirect\n+  if (!isAbsolute(loc)) {\n+    // Ensure the path is relative and starts with a single slash\n+    loc = '/' + loc.replace(/^\\/+/, '');\n+  }\n+\n   // set location\n   return this.set('Location', encodeUrl(loc));\n };\n"}
{"cve":"CVE-2021-3664:0708", "fix_patch": ""}
{"cve":"CVE-2022-0155:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/index.js b/index.js\nindex 6f0c238..e2ebe91 100644\n--- a/index.js\n+++ b/index.js\n@@ -394,7 +394,17 @@ RedirectableRequest.prototype._processResponse = function (response) {\n \n     // Drop the Authorization header if redirecting to another domain\n     if (!(redirectUrlParts.host === currentHost || isSubdomainOf(redirectUrlParts.host, currentHost))) {\n-      removeMatchingHeaders(/^authorization$/i, this._options.headers);\n+      const sensitiveHeaders = [\n+  /^authorization$/i,\n+  /^cookie$/i,\n+  /^set-cookie$/i,\n+  /^proxy-authorization$/i,\n+  /^www-authenticate$/i\n+];\n+\n+sensitiveHeaders.forEach(headerRegex => {\n+  removeMatchingHeaders(headerRegex, this._options.headers);\n+});\n     }\n \n     // Evaluate the beforeRedirect callback\n@@ -560,8 +570,27 @@ function abortRequest(request) {\n }\n \n function isSubdomainOf(subdomain, domain) {\n-  const dot = subdomain.length - domain.length - 1;\n-  return dot > 0 && subdomain[dot] === \".\" && subdomain.endsWith(domain);\n+  // Normalize to lowercase\n+  subdomain = subdomain.toLowerCase();\n+  domain = domain.toLowerCase();\n+  \n+  // Split domains and remove empty parts\n+  const subdomainParts = subdomain.split('.').filter(part => part);\n+  const domainParts = domain.split('.').filter(part => part);\n+  \n+  // Domain cannot be a subdomain of itself\n+  if (subdomainParts.length <= domainParts.length) {\n+    return false;\n+  }\n+  \n+  // Check if the domain parts match the end of the subdomain parts\n+  for (let i = 0; i < domainParts.length; i++) {\n+    if (subdomainParts[subdomainParts.length - domainParts.length + i] !== domainParts[i]) {\n+      return false;\n+    }\n+  }\n+  \n+  return true;\n }\n \n // Exports\n"}
{"cve":"CVE-2021-46561:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 00000000..5227fa9a\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/controller/org.controller/org.controller.js b/src/controller/org.controller/org.controller.js\nindex 0673f06b..fb3b0801 100644\n--- a/src/controller/org.controller/org.controller.js\n+++ b/src/controller/org.controller/org.controller.js\n@@ -532,7 +532,7 @@ async function updateUser (req, res, next) {\n     })\n \n     // updating user's roles and org_uuid is only allowed for secretariats and org admins\n-    if (changesRequirePrivilegedRole && !(isAdmin || isSecretariat)) {\n+    if (changesRequirePrivilegedRole && !isSecretariat) {\n       logger.info({ uuid: req.ctx.uuid, message: 'The user could not be updated because ' + requesterUsername + ' user is not Org Admin or Secretariat to modify these fields.' })\n       return res.status(403).json(error.notOrgAdminOrSecretariat())\n     }\n"}
{"cve":"CVE-2022-0722:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex 31b2a04..aa80d03 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -45,6 +45,7 @@ function parseUrl(url, normalize = false) {\n         url = normalizeUrl(url, normalize)\n     }\n     const parsed = parsePath(url)\n+    delete parsed.user;\n     return parsed;\n }\n \n"}
{"cve":"CVE-2020-7649:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/filters/index.js b/lib/filters/index.js\nindex 1e27249..0ad5e59 100644\n--- a/lib/filters/index.js\n+++ b/lib/filters/index.js\n@@ -1,4 +1,5 @@\n const minimatch = require('minimatch');\n+const path = require('path');\n const pathRegexp = require('path-to-regexp');\n const qs = require('qs');\n const undefsafe = require('undefsafe');\n@@ -32,7 +33,7 @@ module.exports = ruleSource => {\n   // array of entries with\n   const tests = rules.map(entry => {\n     const keys = [];\n-    let { method, origin, path, valid, stream } = entry;\n+    let { method, origin, entryPath, valid, stream } = entry;\n     method = (method || 'get').toLowerCase();\n     valid = valid || [];\n \n@@ -44,7 +45,7 @@ module.exports = ruleSource => {\n     const fromConfig = {};\n \n     // slightly bespoke version of replace-vars.js\n-    path = (path || '').replace(/(\\${.*?})/g, (_, match) => {\n+    entryPath = (entryPath || '').replace(/(\\${.*?})/g, (_, match) => {\n       const key = match.slice(2, -1); // ditch the wrappers\n       fromConfig[key] = config[key] || '';\n       return ':' + key;\n@@ -52,12 +53,12 @@ module.exports = ruleSource => {\n \n     origin = replace(origin, config);\n \n-    if (path[0] !== '/') {\n-      path = '/' + path;\n+    if (entryPath[0] !== '/') {\n+      entryPath = '/' + entryPath;\n     }\n \n-    logger.info({ method, path }, 'adding new filter rule');\n-    const regexp = pathRegexp(path, keys);\n+    logger.info({ method, path: entryPath }, 'adding new filter rule');\n+    const regexp = pathRegexp(entryPath, keys);\n \n     return (req) => {\n       // check the request method\n@@ -71,7 +72,10 @@ module.exports = ruleSource => {\n       // query params might contain additional \"?\"s, only split on the 1st one\n       const parts = mainURI.split('?');\n       let [url, querystring] = [parts[0], parts.slice(1).join('?')];\n-      const res = regexp.exec(url);\n+      // Sanitize path to prevent directory traversal\n+      const sanitizedUrl = path.normalize(url).replace(/^(\\.\\.(\\/|\\\\|$))+/, '');\n+      const res = regexp.exec(sanitizedUrl);\n+      url = sanitizedUrl;\n       if (!res) {\n         // no url match\n         return false;\n@@ -81,7 +85,9 @@ module.exports = ruleSource => {\n       for (let i = 1; i < res.length; i++) {\n         const val = fromConfig[keys[i - 1].name];\n         if (val) {\n-          url = url.replace(res[i], val);\n+          // Ensure replacement doesn't introduce path traversal\n+          const sanitizedVal = path.normalize(val).replace(/^(\\.\\.(\\/|\\\\|$))+/, '');\n+          url = url.replace(res[i], sanitizedVal);\n         }\n       }\n \ndiff --git a/test/unit/filters.test.js b/test/unit/filters.test.js\nindex 00131c8..0eaed24 100644\n--- a/test/unit/filters.test.js\n+++ b/test/unit/filters.test.js\n@@ -42,6 +42,26 @@ test('Filter on URL', t => {\n     t.end();\n   });\n \n+  t.test('should sanitize path traversal sequences in URL', (t) => {\n+    const filter = Filters([{\n+      method: 'get',\n+      path: '/:file',\n+      origin: 'http://example.com'\n+    }]);\n+\n+    const req = {\n+      method: 'GET',\n+      url: '/../../etc/passwd'\n+    };\n+\n+    filter(req, (err, res) => {\n+      t.error(err);\n+      t.equal(res.url, 'http://example.com/etc/passwd', 'removes path traversal sequences');\n+      t.end();\n+    });\n+    t.end();\n+  });\n+\n   t.end();\n });\n \ndiff --git a/test/unit/path-sanitization.test.js b/test/unit/path-sanitization.test.js\nnew file mode 100644\nindex 0000000..1af722c\n--- /dev/null\n+++ b/test/unit/path-sanitization.test.js\n@@ -0,0 +1,45 @@\n+const test = require('tap').test;\n+const Filters = require('../../lib/filters');\n+\n+test('Path traversal sanitization', t => {\n+  t.test('should sanitize path traversal sequences in URL', (t) => {\n+    const filter = Filters([{\n+      method: 'get',\n+      path: '/:file',\n+      origin: 'http://example.com'\n+    }]);\n+\n+    const req = {\n+      method: 'GET',\n+      url: '/../../etc/passwd'\n+    };\n+\n+    filter(req, (err, res) => {\n+      t.error(err);\n+      t.equal(res.url, 'http://example.com/etc/passwd', 'removes path traversal sequences');\n+      t.end();\n+    });\n+  });\n+\n+  t.test('should sanitize path traversal in replacement values', (t) => {\n+    const filter = Filters([{\n+      method: 'get',\n+      path: '/${file}',\n+      origin: 'http://example.com'\n+    }]);\n+\n+    process.env.file = '../../secret';\n+    const req = {\n+      method: 'GET',\n+      url: '/anything'\n+    };\n+\n+    filter(req, (err, res) => {\n+      t.error(err);\n+      t.equal(res.url, 'http://example.com/secret', 'sanitizes replacement value');\n+      t.end();\n+    });\n+  });\n+\n+  t.end();\n+});\n"}
{"cve":"CVE-2020-26299:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/src/fs.js b/src/fs.js\nindex 3226d2e..3954f71 100644\n--- a/src/fs.js\n+++ b/src/fs.js\n@@ -29,7 +29,12 @@ class FileSystem {\n \n     const fsPath = (() => {\n       const resolvedPath = nodePath.join(this.root, clientPath);\n-      return nodePath.resolve(nodePath.normalize(nodePath.join(resolvedPath)));\n+      const normalizedPath = nodePath.normalize(nodePath.join(resolvedPath));\n+      const resolved = nodePath.resolve(normalizedPath);\n+      if (!resolved.startsWith(this.root)) {\n+        throw new errors.FileSystemError('Path traversal attempt');\n+      }\n+      return resolved;\n     })();\n \n     return {\n"}
{"cve":"CVE-2021-37712:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/normalize-windows-path.js b/lib/normalize-windows-path.js\nindex eb13ba0..a3f1062 100644\n--- a/lib/normalize-windows-path.js\n+++ b/lib/normalize-windows-path.js\n@@ -3,6 +3,7 @@\n // so, on windows, and only on windows, we replace all \\ chars with /,\n // so that we can use / as our one and only directory separator char.\n \n+const fs = require('fs');\n const platform = process.env.TESTING_TAR_FAKE_PLATFORM || process.platform\n module.exports = platform !== 'win32' ? p => p\n-  : p => p && p.replace(/\\\\/g, '/')\n+  : p => { if (!p) return p; const normalized = p.replace(/\\\\/g, '/'); try { return fs.realpathSync(normalized, { encoding: 'utf8' }); } catch (e) { return normalized; } }\ndiff --git a/lib/path-reservations.js b/lib/path-reservations.js\nindex 48c750e..5130558 100644\n--- a/lib/path-reservations.js\n+++ b/lib/path-reservations.js\n@@ -6,7 +6,8 @@\n // Used by async unpack to avoid clobbering paths in use,\n // while still allowing maximal safe parallelization.\n \n-const assert = require('assert')\n+const assert = require('assert');\n+const fs = require('fs')\n const normPath = require('./normalize-windows-path.js')\n const { join } = require('path')\n \n@@ -99,7 +100,15 @@ module.exports = () => {\n   }\n \n   const reserve = (paths, fn) => {\n-    paths = paths.map(p => normPath(join(p)).toLowerCase())\n+    paths = paths.map(p => {\n+  const joined = join(p);\n+  const normalized = normPath(joined).normalize('NFC').toLowerCase();\n+  try {\n+    return fs.realpathSync(normalized);\n+  } catch (e) {\n+    return normalized;\n+  }\n+})\n     const dirs = new Set(\n       paths.map(path => getDirs(path)).reduce((a, b) => a.concat(b))\n     )\n"}
{"cve":"CVE-2021-37713:0708", "fix_patch": ""}
{"cve":"CVE-2021-32804:0708", "fix_patch": "diff --git a/lib/write-entry.js b/lib/write-entry.js\nindex 1d0b746..cb0bd77 100644\n--- a/lib/write-entry.js\n+++ b/lib/write-entry.js\n@@ -56,7 +56,7 @@ const WriteEntry = warner(class WriteEntry extends MiniPass {\n       // absolutes on posix are also absolutes on win32\n       // so we only need to test this one to get both\n       const parsed = path.win32.parse(p)\n-      this.path = p.substr(parsed.root.length)\n+      this.path = p.replace(/^[\\\\/]+/, '')\n       pathWarn = parsed.root\n     }\n \n"}
{"cve":"CVE-2017-16025:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/socket.js b/lib/socket.js\nindex 261156e..95c45cd 100755\n--- a/lib/socket.js\n+++ b/lib/socket.js\n@@ -538,7 +538,7 @@ internals.Socket.prototype._authenticate = function () {\n     }\n \n     this._listener._connection.states.parse(cookies, (ignoreErr, state, failed) => {\n-\n+        if (failed || !state) return;\n         const auth = state[config.cookie];\n         if (auth) {\n             this.auth._error = this._setCredentials(auth.credentials, auth.artifacts);\n"}
{"cve":"CVE-2021-41246:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/middleware/auth.js b/middleware/auth.js\nindex c13a949..0c028ad 100644\n--- a/middleware/auth.js\n+++ b/middleware/auth.js\n@@ -130,6 +130,13 @@ const auth = function (params) {\n           }\n \n           Object.assign(req[config.session.name], session);\n+          // Regenerate session to prevent session fixation\n+          await new Promise((resolve, reject) => {\n+            req[config.session.name].regenerate((err) => {\n+              if (err) reject(err);\n+              else resolve();\n+            });\n+          });\n           attemptSilentLogin.resumeSilentLogin(req, res);\n \n           next();\n"}
{"cve":"CVE-2015-3295:0708", "fix_patch": "diff --git a/.claude/settings.json b/.claude/settings.json\nnew file mode 100644\nindex 0000000..5227fa9\n--- /dev/null\n+++ b/.claude/settings.json\n@@ -0,0 +1,18 @@\n+{\n+  \"permissions\": {\n+    \"allow\": [\n+      \"Bash(*)\",\n+      \"text_editor(*)\",\n+      \"Read(*)\",\n+      \"Grep(*)\",\n+      \"Web Fetch(*)\",\n+      \"Todo(*)\",\n+      \"Memory(*)\"\n+    ],\n+    \"deny\": []\n+  },\n+  \"env\": {\n+    \"CLAUDE_CODE_AUTO_CONNECT_IDE\": \"false\",\n+    \"DISABLE_INTERLEAVED_THINKING\": \"true\"\n+  }\n+}\n\\ No newline at end of file\ndiff --git a/lib/index.js b/lib/index.js\nindex abc1525..8743ba4 100644\n--- a/lib/index.js\n+++ b/lib/index.js\n@@ -21,7 +21,7 @@ var config = {\n };\n \n \n-var BAD_PROTOCOLS    = [ 'vbscript', 'javascript', 'file' ];\n+var BAD_PROTOCOLS    = [ 'vbscript', 'javascript', 'file', 'data' ];\n \n function validateLink(url) {\n   // url should be normalized at this point, and existing entities are decoded\n"}
